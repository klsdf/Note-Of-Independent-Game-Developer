

# SOLIDè®¾è®¡åŸåˆ™

## å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principle, SRPï¼‰


ä¸€ä¸ªç±»åº”è¯¥**åªæœ‰ä¸€ä¸ªåŸå› å¯ä»¥å¼•èµ·å®ƒçš„å˜åŒ–**ã€‚

**âŒ è¿å SRP çš„ä¾‹å­**ï¼ˆä¸€ä¸ª `Report` ç±»è´Ÿè´£**æ•°æ®å¤„ç†å’Œæ–‡ä»¶å†™å…¥**ï¼‰ï¼š

```c#
public class Report
{
    public void GenerateReport() { Console.WriteLine("ç”ŸæˆæŠ¥å‘Š"); }
    public void SaveToFile() { Console.WriteLine("ä¿å­˜åˆ°æ–‡ä»¶"); }
}
```


```c#
public class ReportGenerator
{
    public void Generate() { Console.WriteLine("ç”ŸæˆæŠ¥å‘Š"); }
}

public class ReportSaver
{
    public void Save(string filePath) { Console.WriteLine($"ä¿å­˜åˆ° {filePath}"); }
}

```





## å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOpen/Closed Principle, OCPï¼‰

**åŸåˆ™**ï¼š**å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­**ã€‚å³**å¯ä»¥æ‰©å±•åŠŸèƒ½ï¼Œä½†ä¸è¦ä¿®æ”¹å·²æœ‰ä»£ç **ã€‚


âŒ è¿å OCPï¼ˆæ¯æ¬¡å¢åŠ æ–°å½¢çŠ¶ï¼Œéƒ½è¦ä¿®æ”¹ `AreaCalculator`ï¼‰
```c#
public class AreaCalculator
{
    public double CalculateArea(object shape)
    {
        if (shape is Circle circle) return Math.PI * circle.Radius * circle.Radius;
        if (shape is Rectangle rect) return rect.Width * rect.Height;
        return 0;
    }
}

```



ğŸ‘‰ **æ–°å½¢çŠ¶åªéœ€å®ç° `IShape`ï¼Œæ— éœ€ä¿®æ”¹ `AreaCalculator`ï¼Œç¬¦åˆ OCP**ã€‚
```c#
public interface IShape { double GetArea(); }

public class Circle : IShape
{
    public double Radius { get; set; }
    public double GetArea() => Math.PI * Radius * Radius;
}

public class Rectangle : IShape
{
    public double Width { get; set; }
    public double Height { get; set; }
    public double GetArea() => Width * Height;
}

public class AreaCalculator
{
    public double CalculateArea(IShape shape) => shape.GetArea();
}

```







## é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principle, LSPï¼‰

**åŸåˆ™**ï¼šå­ç±»å¿…é¡»**å®Œå…¨å’Œå®‰å…¨**æ›¿æ¢çˆ¶ç±»ï¼Œè€Œä¸å‘ç”Ÿæ„æ–™ä¹‹å¤–çš„æƒ…å†µã€‚


âŒ è¿å LSPï¼ˆ`Penguin` ä¸èƒ½é£ï¼Œä½†ç»§æ‰¿ `Bird`ï¼Œå¯¼è‡´ `Fly()` æ–¹æ³•æ— æ„ä¹‰ï¼‰

```c#
public class Bird
{
    public virtual void Fly() { Console.WriteLine("é¸Ÿåœ¨é£ç¿”"); }
}

public class Sparrow : Bird { } // å¯ä»¥é£

public class Penguin : Bird
{
    public override void Fly() { throw new Exception("ä¼é¹…ä¸ä¼šé£"); } // âŒ è¿èƒŒ LSP
}

```


âœ… éµå®ˆ LSPï¼ˆæŠ½è±¡å‡º `IFlyingBird` å’Œ `INonFlyingBird`ï¼‰
```c#
public interface IFlyingBird { void Fly(); }
public interface INonFlyingBird { }

public class Sparrow : IFlyingBird
{
    public void Fly() { Console.WriteLine("éº»é›€åœ¨é£ç¿”"); }
}

public class Penguin : INonFlyingBird { } // ä¼é¹…ä¸å®ç° `Fly`

```




## æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principle, ISPï¼‰

**åŸåˆ™**ï¼š**ä¸å¼ºè¿«ç±»å®ç°å®ƒä¸éœ€è¦çš„æ¥å£**ï¼Œå³é¿å…**å¤§è€Œå…¨çš„æ¥å£**ã€‚


âŒ è¿å ISPï¼ˆæ‰€æœ‰åŠ¨ç‰©éƒ½å¿…é¡»å®ç° `Swim`ï¼Œä½†ç‹—ä¸ä¼šæ¸¸æ³³ï¼‰

```c#
public interface IAnimal
{
    void Run();
    void Swim(); // âŒ ç‹—ä¸ä¼šæ¸¸æ³³ï¼Œä½†è¢«å¼ºåˆ¶å®ç°
}

public class Dog : IAnimal
{
    public void Run() { Console.WriteLine("ç‹—åœ¨è·‘"); }
    public void Swim() { throw new Exception("ç‹—ä¸ä¼šæ¸¸æ³³"); } // âŒ è¿èƒŒ ISP
}

```

âœ… éµå®ˆ ISPï¼ˆæ‹†åˆ† `IAnimal` ä¸ºå¤šä¸ªå°æ¥å£ï¼‰

```c#
public interface IRunnable { void Run(); }
public interface ISwimmable { void Swim(); }

public class Dog : IRunnable
{
    public void Run() { Console.WriteLine("ç‹—åœ¨è·‘"); }
}
public class Fish : ISwimmable
{
    public void Swim() { Console.WriteLine("é±¼åœ¨æ¸¸æ³³"); }
}

```
ğŸ‘‰ **æ¥å£æ‹†åˆ†ï¼Œä½¿å¾—ç±»**åªéœ€å®ç°**è‡ªå·±éœ€è¦çš„åŠŸèƒ½ï¼Œé¿å…å†—ä½™ä»£ç ã€‚**





C# å®˜æ–¹çš„ `IList<T>` å°±æ˜¯ä¸€ä¸ª**è¿å ISP çš„å…¸å‹ä¾‹å­**ï¼Œå› ä¸ºå®ƒç»§æ‰¿è‡ª `ICollection<T>` å’Œ `IEnumerable<T>`ï¼Œä½†å…¶ä¸­çš„æ–¹æ³•**å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µ**ï¼Œå¯¼è‡´ä¸€äº›æ•°æ®ç»“æ„å¿…é¡»å®ç°ä¸å¿…è¦çš„æ–¹æ³•ã€‚



```c#
using System;
using System.Collections.Generic;

class Program
{
    private static void AddToList(IList<int> list)
    {
        list.Add(1);  // è¿™é‡Œå‡è®¾ list èƒ½å¤Ÿæ·»åŠ å…ƒç´ 
    }

    static void Main(string[] args)
    {
        var list = new List<int>();
        AddToList(list);  // âœ… List<int> å¯ä»¥ä½œä¸º IList<int> ä¼ é€’

        var array = new int[5]; 
        AddToList(array); // âŒ æŠ›å‡ºå¼‚å¸¸

        Console.ReadKey();
    }
}

```

å› ä¸ºæ•°ç»„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜é•¿åº¦çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥è™½ç„¶å®ƒå®ç°äº†IListæ¥å£ï¼Œä½†æ˜¯å†…éƒ¨åœ¨Addä¸­æŠ›å‡ºå¼‚å¸¸äº†ã€‚

```c#
int IList.Add(object value)
{
throw new NotsupportedException(Environment,GetResourcestring("Notsupported Fixedsizecollection")):
}
```


åœ¨ C# ä¸­ï¼Œ`æ•°ç»„ï¼ˆint[]ï¼‰` **ç¡®å®å®ç°äº†** `IList<int>`ï¼Œä½†å®ƒ**ä¸æ”¯æŒæ·»åŠ å’Œåˆ é™¤æ“ä½œ**ï¼Œå› ä¸ºæ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥c#å®˜æ–¹å¼ºè¿«æ•°ç»„å®ç°äº†å®ƒä¸åº”è¯¥å®ç°çš„æ¥å£ï¼Œè¿åäº†æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰



## ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principle, DIPï¼‰


**åŸåˆ™**ï¼š

1. **é«˜å±‚æ¨¡å—ï¼ˆå¦‚ `Game` ç±»ï¼‰ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆå¦‚ `Bow`ã€`Sword`ï¼‰ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡**ã€‚
2. **ç»†èŠ‚ï¼ˆå…·ä½“å®ç°ï¼‰åº”è¯¥ä¾èµ–æŠ½è±¡ï¼ˆæ¥å£ï¼‰ï¼Œè€Œä¸æ˜¯ç›¸å**ã€‚


ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰è¯´ç™½äº†å°±æ˜¯ä¸å»ºè®®è®©ç±»å»è‡ªå·±ç”Ÿæˆå…¶å®ƒç±»çš„å¯¹è±¡ï¼Œå¯¼è‡´äº†é«˜è€¦åˆã€‚è€Œæ˜¯åº”è¯¥ä¼ è¿›æ¥å…¶å®ƒç±»çš„å®ç°äº†æ‰€éœ€æ¥å£çš„å¯¹è±¡ã€‚



âŒ åä¾‹ï¼šè¿å DIP
æ¸¸æˆè§’è‰²ä¾èµ–å…·ä½“æ­¦å™¨ç±»

```c#
public class Sword
{
    public void Attack() { Console.WriteLine("æŒ¥èˆå‰‘æ”»å‡»ï¼"); }
}

public class Archer
{
    private Sword _sword = new Sword(); // âŒ ç›´æ¥ä¾èµ–å…·ä½“å®ç°

    public void Attack()
    {
        _sword.Attack();
    }
}

```



```c#
public interface IWeapon
{
    void Attack();
}

public class Sword : IWeapon
{
    public void Attack() { Console.WriteLine("æŒ¥èˆå‰‘æ”»å‡»ï¼"); }
}

public class Bow : IWeapon
{
    public void Attack() { Console.WriteLine("å°„ç®­æ”»å‡»ï¼"); }
}

public class Archer
{
    private IWeapon _weapon; // âœ… ä¾èµ–æŠ½è±¡ï¼Œä¸ä¾èµ–å…·ä½“å®ç°

    public Archer(IWeapon weapon) // âœ… é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    {
        _weapon = weapon;
    }

    public void Attack()
    {
        _weapon.Attack();
    }
}

```








# åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰

åˆ›å»ºå‹æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯**æ§åˆ¶å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹**ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿæ›´åŠ çµæ´»ã€å¯æ‰©å±•ï¼Œé¿å…ç›´æ¥ä½¿ç”¨ `new` å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡ã€‚å®ƒå°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹æŠ½è±¡åŒ–ï¼Œå¹¶å°†å…¶ä¸å®¢æˆ·ç«¯ä»£ç åˆ†ç¦»ã€‚


## å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰

### ç®€å•å·¥å‚æ¨¡å¼

ä¸€ä¸ªå·¥å‚è´Ÿè´£ç”Ÿæˆæ‰€æœ‰äº§å“

- **è¿åå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ï¼šæ¯æ¬¡æ–°å¢äº§å“ï¼Œéƒ½è¦ä¿®æ”¹å·¥å‚çš„ `switch` æˆ– `if-else` è¯­å¥ã€‚
- **å•ä¸€å·¥å‚ç±»å¯èƒ½å˜å¾—è‡ƒè‚¿**ï¼Œå¦‚æœäº§å“è¶Šæ¥è¶Šå¤šï¼Œç»´æŠ¤å›°éš¾ã€‚

```c#
public interface IEnemy { void Attack(); }

public class Goblin : IEnemy { public void Attack() => Debug.Log("Goblin Attack!"); }
public class Orc : IEnemy { public void Attack() => Debug.Log("Orc Attack!"); }

public class SimpleEnemyFactory
{
    public static IEnemy CreateEnemy(string type)
    {
        switch (type)
        {
            case "Goblin": return new Goblin();
            case "Orc": return new Orc();
            default: throw new ArgumentException("Invalid type");
        }
    }
}

// å®¢æˆ·ç«¯è°ƒç”¨ï¼š
IEnemy enemy = SimpleEnemyFactory.CreateEnemy("Goblin");
enemy.Attack();

```

### å·¥å‚æ¨¡å¼

æ¯ä¸ªå·¥å‚ç”Ÿäº§è‡ªå·±çš„äº§å“

- æ¯ä¸ªäº§å“æœ‰**è‡ªå·±çš„å·¥å‚**ï¼Œé¿å…äº† `switch` è¯­å¥ã€‚
- **é€‚ç”¨äºå¯¹è±¡ç±»å‹è¾ƒå¤šçš„æƒ…å†µ**ï¼Œç¬¦åˆ**å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ã€‚
- **ä½†ç±»çš„æ•°é‡å¢åŠ **ï¼Œæ¯æ–°å¢ä¸€ä¸ªäº§å“ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥å‚ç±»ã€‚


```c#
// äº§å“æ¥å£
public interface IEnemy { void Attack(); }

// å…·ä½“äº§å“
public class Goblin : IEnemy { public void Attack() => Debug.Log("Goblin Attack!"); }
public class Orc : IEnemy { public void Attack() => Debug.Log("Orc Attack!"); }

// æŠ½è±¡å·¥å‚
public abstract class EnemyFactory { public abstract IEnemy CreateEnemy(); }

// å…·ä½“å·¥å‚ï¼ˆæ¯ä¸ªå·¥å‚åˆ›å»ºä¸€ç§æ•Œäººï¼‰
public class GoblinFactory : EnemyFactory { public override IEnemy CreateEnemy() => new Goblin(); }
public class OrcFactory : EnemyFactory { public override IEnemy CreateEnemy() => new Orc(); }

// å®¢æˆ·ç«¯ä»£ç ï¼š
EnemyFactory factory = new GoblinFactory();
IEnemy enemy = factory.CreateEnemy();
enemy.Attack();

```


## æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰

ä¸€ä¸ªå·¥å‚å¯ä»¥ç”Ÿäº§å¤šä¸ªäº§å“ï¼Œè¿™äº›äº§å“ä¹Ÿæœ‰ä¸€å®šçš„è”ç³»ï¼Œä¹Ÿå°±æ˜¯äº§å“æ—ã€‚


```c#
// äº§å“æ¥å£
public interface IWeapon { void Attack(); }
public interface IArmor { void Defend(); }

// å…·ä½“äº§å“ï¼ˆç²¾çµæ—è£…å¤‡ï¼‰
public class ElfWeapon : IWeapon { public void Attack() => Debug.Log("Elf Weapon Attack!"); }
public class ElfArmor : IArmor { public void Defend() => Debug.Log("Elf Armor Defense!"); }

// å…·ä½“äº§å“ï¼ˆå…½äººæ—è£…å¤‡ï¼‰
public class OrcWeapon : IWeapon { public void Attack() => Debug.Log("Orc Weapon Attack!"); }
public class OrcArmor : IArmor { public void Defend() => Debug.Log("Orc Armor Defense!"); }

// æŠ½è±¡å·¥å‚ï¼ˆå®šä¹‰äº§å“æ—ï¼‰
public abstract class EquipmentFactory
{
    public abstract IWeapon CreateWeapon();
    public abstract IArmor CreateArmor();
}

// å…·ä½“å·¥å‚ï¼ˆç²¾çµæ—å·¥å‚ï¼‰
public class ElfEquipmentFactory : EquipmentFactory
{
    public override IWeapon CreateWeapon() => new ElfWeapon();
    public override IArmor CreateArmor() => new ElfArmor();
}

// å…·ä½“å·¥å‚ï¼ˆå…½äººæ—å·¥å‚ï¼‰
public class OrcEquipmentFactory : EquipmentFactory
{
    public override IWeapon CreateWeapon() => new OrcWeapon();
    public override IArmor CreateArmor() => new OrcArmor();
}

// å®¢æˆ·ç«¯ä»£ç 
EquipmentFactory factory = new ElfEquipmentFactory();
IWeapon weapon = factory.CreateWeapon();
IArmor armor = factory.CreateArmor();
weapon.Attack();
armor.Defend();

```


## å»ºé€ è€…ï¼ˆBuilderï¼‰

å…è®¸**åˆ†æ­¥éª¤åˆ›å»ºå¤æ‚å¯¹è±¡**ï¼Œå¹¶å…è®¸æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹ç”Ÿäº§ä¸åŒçš„å¯¹è±¡ã€‚è¿™ä¸ªåœ¨node drawä¸­ç”¨çš„å¾ˆå¤šï¼Œä¸»è¦ä¸ºäº†è®©æ„é€ å‡½æ•°è¿‡äºå¤æ‚ã€‚æœ‰äº›å¯¹è±¡çš„æŸäº›å±æ€§å¯ä»¥ç¼ºçœï¼Œæœ‰äº›ä¸å¯ä»¥ã€‚è‹¥ç”¨æ„é€ å‡½æ•°é‡è½½å¯èƒ½ä¼šå¤æ‚åº¦çˆ†ç‚¸ã€‚

```c#

//ä¼ ç»Ÿæ¨¡å¼
public class Character
{
    public string Name;
    public int Health;
    public int Attack;
    public int Defense;

    public Character(string name, int health, int attack, int defense)
    {
        Name = name;
        Health = health;
        Attack = attack;
        Defense = defense;
    }
}

// åˆ›å»ºè§’è‰²
Character hero = new Character("Warrior", 100, 50, 30);

```



```c#
public class Character
{
    public string Name;
    public int Health;
    public int Attack;
    public int Defense;

    public Character SetName(string name) { this.Name = name; return this; }
    public Character SetHealth(int health) { this.Health = health; return this; }
    public Character SetAttack(int attack) { this.Attack = attack; return this; }
    public Character SetDefense(int defense) { this.Defense = defense; return this; }

    public void ShowInfo()
    {
        Debug.Log($"è§’è‰²ï¼š{Name} | ç”Ÿå‘½ï¼š{Health} | æ”»å‡»ï¼š{Attack} | é˜²å¾¡ï¼š{Defense}");
    }
}

// è¿™æ ·åˆ›å»ºè§’è‰²æ›´åŠ ç›´è§‚ï¼š
Character warrior = new Character()
    .SetName("Warrior")
    .SetHealth(100)
    .SetAttack(50)
    .SetDefense(30);
    
warrior.ShowInfo();
```



## å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰




ç”¨æ¥å¤„ç†DontDestroyOnLoad

```c#
public class GameManager : MonoBehaviour
{
	private static GameManager _instance;   // å•ä¾‹
	public GameManager GameManagerInstance
    {
        get { return _instance; }
    }
    void Awake()
    {
        if (_instance != null)
        {
        	//è¿™é‡Œä¸€å®šè¦æ˜¯é”€æ¯this.gameObject
            Destroy(this.gameObject);
            return;
        }
        //è¿™å¥è¯åªæ‰§è¡Œä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡ä¸Šé¢returnäº†
        _instance = this;
    }
}

```



ä¸ç»§æ‰¿monoçš„

```c#
public class Test 
{


    private static Test _instance;
    //å•ä¾‹æ¨¡å¼
    public static Test Instance
    {
        get
         {
            if (_instance == null) {
                _instance = new Test();
            }
            return _instance;

        }
    }
}
```



ç»§æ‰¿monoçš„

```c#
public class UIController:MonoBehaviour
{

    public static UIController Instance;
 

    private void Awake()
    {
        Instance = this;
    }

    public void changeRestBalls()
    {

    }
}
```

è™½ç„¶ç›´æ¥åœ¨awakeä¸­å†™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚é‚£å°±æ˜¯awakeçš„è°ƒç”¨é¡ºåºæ˜¯ä¸ä¸€å®šçš„ï¼Œåœ¨è„šæœ¬ä¸­ï¼Œå¦‚æœawakeæ—¶å‡ºç°äº†å•ä¾‹äº’ç›¸è°ƒç”¨çš„æƒ…å†µï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å…¶ä»–çš„å•ä¾‹è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå› æ­¤å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œæ”¹è¿›ã€‚



```c#
static Test instance;
public static Test Instance
{
    get
    {
        if(instance == null)
        {
            instance = FindObjectOfType<Test>();
           
        }
         return instance;
    }
}
```




## åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰

**åŸå‹æ¨¡å¼** æ˜¯ä¸€ç§**åˆ›å»ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**å…‹éš†ï¼ˆå¤åˆ¶ï¼‰å¯¹è±¡**ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½ `new` ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚  
å½“å¯¹è±¡çš„åˆ›å»ºæˆæœ¬è¾ƒé«˜ï¼Œæˆ–è€…éœ€è¦å¤§é‡ç›¸ä¼¼çš„å¯¹è±¡æ—¶ï¼ŒåŸå‹æ¨¡å¼èƒ½æé«˜æ€§èƒ½å¹¶å‡å°‘é‡å¤ä»£ç ã€‚

Unity æä¾›çš„ **`Instantiate`** æ–¹æ³•æœ¬è´¨ä¸Šå°±æ˜¯**åŸå‹æ¨¡å¼**çš„å®ç°ï¼š
 

```c#
using System;
using UnityEngine;

// 1. å®šä¹‰åŸå‹æ¥å£
public interface IPrototype<T>
{
    T Clone(); // å…‹éš†æ–¹æ³•
}

// 2. å…·ä½“åŸå‹ç±»
[Serializable] // è®© Unity èƒ½åºåˆ—åŒ–
public class Enemy : IPrototype<Enemy>
{
    public string Name;
    public int Health;
    public float Speed;

    public Enemy(string name, int health, float speed)
    {
        Name = name;
        Health = health;
        Speed = speed;
    }

    // 3. å®ç°å…‹éš†æ–¹æ³•ï¼ˆæµ…æ‹·è´ï¼‰
    public Enemy Clone()
    {
        return (Enemy)this.MemberwiseClone();
    }

    public void ShowInfo()
    {
        Debug.Log($"Enemy: {Name}, HP: {Health}, Speed: {Speed}");
    }
}

// 4. å®¢æˆ·ç«¯ä»£ç 
public class GameManager : MonoBehaviour
{
    void Start()
    {
        // åˆ›å»ºåŸå‹å¯¹è±¡
        Enemy originalEnemy = new Enemy("Orc", 100, 2.5f);
        originalEnemy.ShowInfo();

        // å…‹éš†æ•Œäºº
        Enemy clonedEnemy = originalEnemy.Clone();
        clonedEnemy.Name = "Goblin"; // ä¿®æ”¹å…‹éš†ä½“çš„å±æ€§
        clonedEnemy.Health = 50;
        clonedEnemy.ShowInfo();
    }
}
```



# ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰

ç»“æ„å‹æ¨¡å¼ä¸»è¦è§£å†³**ç±»æˆ–å¯¹è±¡ä¹‹é—´çš„å…³ç³»**ï¼Œå¦‚ä½•é€šè¿‡ç»„åˆå’Œç»§æ‰¿æ¥æ„å»ºæ›´å¤§çš„ç»“æ„ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†å°çš„æ¨¡å—ç»„åˆæˆæ›´å¤æ‚çš„ç»“æ„ï¼Œä»è€Œè®©ç³»ç»Ÿæ›´åŠ çµæ´»ä¸”æ˜“äºç»´æŠ¤ã€‚


## é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰

å‡è®¾ä½ æ­£åœ¨åˆ¶ä½œä¸€æ¬¾æ¸¸æˆï¼Œè€ç‰ˆæœ¬çš„æ•Œäºº `OldEnemy` ä½¿ç”¨ `AttackOld()`ï¼Œä½†æ–°ç‰ˆç³»ç»Ÿè¦æ±‚æ‰€æœ‰æ•Œäººéƒ½ä½¿ç”¨ `IAttack.Attack()`ã€‚

**ğŸ›‘ é—®é¢˜ï¼š** ä¸èƒ½ä¿®æ”¹ `OldEnemy`ï¼Œä½†ä½ ä»ç„¶å¸Œæœ›å®ƒèƒ½åœ¨æ–°ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚

æˆ–è€…å•çº¯é€‚é…å„ä¸ªapi

- æœ¬è´¨ä¸Šå°±æ˜¯æä¸€ä¸ªæ–°é€šç”¨çš„æ¥å£ï¼Œè®©ä¸€ä¸ªè£…é¥°å™¨ç±»å®ç°è¿™ä¸ªæ¥å£ã€‚ç„¶åï¼ŒæŠŠå…¶å®ƒéœ€è¦é€‚é…çš„å¯¹è±¡ä¼ åˆ°è£…é¥°å™¨ç±»çš„æ„é€ å‡½æ•°é‡Œé¢å°±å®Œäº‹äº†ã€‚
- aiä¸­ç”¨çš„å¾ˆå¤š


```c#

// å®šä¹‰é€šç”¨çš„ AI æ¥å£
public interface IAIAdapter
{
    string GetResponse(string input);
}


// å‡è®¾ OpenAI çš„ API åªèƒ½é€šè¿‡ SendToOpenAI(string prompt) å‘é€è¯·æ±‚
public class OpenAI
{
    public string SendToOpenAI(string prompt)
    {
        return $"[OpenAI]: {prompt} çš„å›å¤";
    }
}

// OpenAI é€‚é…å™¨ï¼Œå®ç° IAIAdapter æ¥å£
public class OpenAIAdapter : IAIAdapter
{
    private OpenAI openAI;

    public OpenAIAdapter(OpenAI openAI)
    {
        this.openAI = openAI;
    }

    public string GetResponse(string input)
    {
        return openAI.SendToOpenAI(input);
    }
}






// Google AI éœ€è¦è°ƒç”¨ GoogleRequest(string query)
public class GoogleAI
{
    public string GoogleRequest(string query)
    {
        return $"[Google AI]: {query} çš„å›å¤";
    }
}

// Google AI é€‚é…å™¨
public class GoogleAIAdapter : IAIAdapter
{
    private GoogleAI googleAI;

    public GoogleAIAdapter(GoogleAI googleAI)
    {
        this.googleAI = googleAI;
    }

    public string GetResponse(string input)
    {
        return googleAI.GoogleRequest(input);
    }
}


```


å®¢æˆ·ç«¯ä»£ç 

```c#
public class AIManager
{
    private IAIAdapter aiAdapter;

    public AIManager(IAIAdapter aiAdapter)
    {
        this.aiAdapter = aiAdapter;
    }

    public void Chat(string input)
    {
        string response = aiAdapter.GetResponse(input);
        Debug.Log(response);
    }
}

// æµ‹è¯•ä»£ç 
public class Program
{
    public static void Main()
    {
        // ä½¿ç”¨ OpenAI
        IAIAdapter openAI = new OpenAIAdapter(new OpenAI());
        AIManager aiManager1 = new AIManager(openAI);
        aiManager1.Chat("ä½ å¥½");

        // ä½¿ç”¨ Google AI
        IAIAdapter googleAI = new GoogleAIAdapter(new GoogleAI());
        AIManager aiManager2 = new AIManager(googleAI);
        aiManager2.Chat("ä½ å¥½");
    }
}


```




## æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰


- **å°†ä¸åŒç»´åº¦çš„å˜åŒ–åˆ†ç¦»**ï¼Œé¿å…ç±»çš„å±‚çº§çˆ†ç‚¸ã€‚
- **ç”¨ç»„åˆä»£æ›¿ç»§æ‰¿**ï¼Œé™ä½è€¦åˆåº¦ï¼Œæé«˜çµæ´»æ€§ã€‚
- **é€‚ç”¨äºå¤šä¸ªç»´åº¦æ‰©å±•çš„å¯¹è±¡æ¨¡å‹**ã€‚
- æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ„é€ å‡½æ•°é‡Œé¢å¯ä»¥newä¸€äº›ç»„ä»¶è¿‡æ¥ï¼Œåœ¨åˆ›é€ æ—¶æ¥åŠ¨æ€æ„æˆè¿™ä¸ªå¯¹è±¡ã€‚





è¿˜æ˜¯ç»å…¸çš„ã€Šåˆæˆæ”¾ç½®å¤§ä¹±æ–—ã€‹ï¼Œå…ˆå¼€å§‹æä¸€ä¸ªå£«å…µæŠ½è±¡ç±»ï¼Œç„¶åæœ‰äº†å‰‘å£«ï¼Œé­”æ³•å¸ˆå’Œç‰§å¸ˆã€‚å‰‘å£«æ´¾ç”Ÿäº†éª‘å£«ï¼Œä½†æ˜¯ç°åœ¨å†å‡ºä¸€ä¸ªåŒ»é™¢éª‘å£«å°±éº»çƒ¦äº†ã€‚å› ä¸ºä¸èƒ½å¤šç»§æ‰¿ï¼Œåªèƒ½å¤šå†™ä¸€ä¸ªåŒ»é™¢éª‘å£«çš„ç±»ã€‚è€Œéª‘å£«ä¸è¿‡æ˜¯è®©å£«å…µçš„é€Ÿåº¦å˜åŒ–ã€‚é­”æ³•å¸ˆå’Œç‰§å¸ˆæœ¬è´¨ä¸Šæ˜¯è¿œç¨‹æ”»å‡»æ•Œäººæˆ–è‡ªå·±äººï¼ˆåªä¸è¿‡ç‰§å¸ˆçš„æ”»å‡»ä¼¤å®³æ˜¯è´Ÿæ•°ï¼‰



```c#
// å£«å…µåŸºç±»ï¼Œæ¡¥æ¥"ç§»åŠ¨æ–¹å¼"å’Œ"æ”»å‡»æ–¹å¼"
public abstract class Soldier
{
    protected IMovement movement;  // ç§»åŠ¨æ–¹å¼ï¼ˆæ­¥è¡Œã€éª‘é©¬ï¼‰
    protected IAttack attack;      // æ”»å‡»æ–¹å¼ï¼ˆè¿‘æˆ˜ã€è¿œç¨‹ã€æ²»ç–—ï¼‰

    public Soldier(IMovement movement, IAttack attack)
    {
        this.movement = movement;
        this.attack = attack;
    }

    public void Move() => movement.Move();
    public void Attack() => attack.Execute();
}


// ç§»åŠ¨æ–¹å¼æ¥å£ï¼ˆImplementor 1ï¼‰
public interface IMovement
{
    void Move();
}

// æ­¥è¡Œ
public class Walk : IMovement
{
    public void Move() => Debug.Log("æ­¥è¡Œå‰è¿›");
}

// éª‘é©¬
public class HorseRide : IMovement
{
    public void Move() => Debug.Log("éª‘é©¬å†²é”‹");
}




// æ”»å‡»æ–¹å¼æ¥å£ï¼ˆImplementor 2ï¼‰
public interface IAttack
{
    void Execute();
}

// è¿‘æˆ˜æ”»å‡»
public class MeleeAttack : IAttack
{
    public void Execute() => Debug.Log("è¿›è¡Œè¿‘æˆ˜æ”»å‡»ï¼");
}

// è¿œç¨‹é­”æ³•æ”»å‡»
public class MagicAttack : IAttack
{
    public void Execute() => Debug.Log("æ–½æ”¾è¿œç¨‹é­”æ³•ï¼");
}

// æ²»ç–—ï¼ˆè¿œç¨‹æ”»å‡»å·±æ–¹ï¼Œä¼¤å®³æ˜¯è´Ÿæ•°ï¼‰
public class HealAttack : IAttack
{
    public void Execute() => Debug.Log("é‡Šæ”¾æ²»ç–—æœ¯ï¼ï¼ˆæ”»å‡»è‡ªå·±äººï¼Œä¼¤å®³æ˜¯è´Ÿæ•°ï¼‰");
}



// å‰‘å£«ï¼ˆå¯ä»¥é€‰æ‹©ä»»æ„æ”»å‡»æ–¹å¼ï¼‰
public class Swordsman : Soldier
{
    public Swordsman(IMovement movement, IAttack attack) 
        : base(movement, attack) { }
}






```



```c#
public class Game
{
    public static void Main()
    {
        // å‰‘å£«ï¼ˆæ­¥è¡Œ + è¿‘æˆ˜ï¼‰
        Soldier swordsman = new Swordsman(new Walk(), new MeleeAttack());
        swordsman.Move();
        swordsman.Attack();

        // éª‘å£«ï¼ˆå‰‘å£« + éª‘é©¬ + è¿‘æˆ˜ï¼‰
        Soldier knight = new Swordsman(new HorseRide(), new MeleeAttack());
        knight.Move();
        knight.Attack();

        // é­”æ³•å‰‘å£«ï¼ˆå‰‘å£« + éª‘é©¬ + è¿œç¨‹é­”æ³•æ”»å‡»ï¼‰
        Soldier magicKnight = new Swordsman(new HorseRide(), new MagicAttack());
        magicKnight.Move();
        magicKnight.Attack();
    }
}
```




## ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰


- å½“é€»è¾‘çš„ç»“æ„æ˜¯æ ‘å½¢ç»“æ„çš„æ—¶å€™å¾ˆé€‚åˆç”¨ç»„åˆæ¨¡å¼ã€‚æ¯”å¦‚äººå£æ™®æŸ¥ï¼Œé¦–å…ˆéœ€è¦è°ƒç”¨å„ä¸ªä¹¡é•‡çš„ç»Ÿè®¡æ¥å£ï¼Œç„¶åæŠŠä¹¡é•‡ç»„åˆæˆçœå¸‚ï¼Œè°ƒç”¨çœå¸‚çš„æ¥å£ã€‚è€Œè¿™äº›ä¹¡é•‡å’Œçœå¸‚éƒ½æ˜¯å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‘çš„ã€‚æ¯ä¸ªæå¹²çš„æ¥å£éƒ½æ˜¯ä¸€æ ·çš„ã€‚
- å¯ä»¥è®©å•ä¸ªå¯¹è±¡å’Œå®¹å™¨ï¼ˆä¸€å †å¯¹è±¡ï¼‰ä½¿ç”¨ç›¸åŒçš„æ¥å£ï¼Œè®©â€œæ•´ä½“â€å’Œâ€œéƒ¨åˆ†â€å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼æ“ä½œã€‚


åœ¨è¿™é‡Œï¼Œä¸€ä¸ªæ™®é€šæ•Œäººå’Œå†›é˜Ÿï¼Œéƒ½æ‹¥æœ‰ç›¸åŒçš„attackæ¥å£ã€‚åœ¨è®¾è®¡æˆ˜æ–—çš„æ—¶å€™ï¼Œæˆ‘åªç”¨è€ƒè™‘å†›é˜Ÿçš„attackå³å¯ã€‚å†›é˜Ÿè´Ÿè´£å¤„ç†ä¸‹çº§å¶å­èŠ‚ç‚¹çš„attacké€»è¾‘ã€‚
```c#
// ç»„ä»¶åŸºç±»ï¼ˆç»„åˆæ¨¡å¼çš„æ ¸å¿ƒï¼‰
public abstract class Enemy
{
    public abstract void Attack();
}

// å¶å­èŠ‚ç‚¹ï¼ˆå•ä¸ªæ•Œäººï¼‰
public class Soldier : Enemy
{
    public override void Attack()
    {
        Debug.Log("å£«å…µå‘èµ·æ”»å‡»ï¼");
    }
}

// ç»„åˆèŠ‚ç‚¹ï¼ˆå¤šä¸ªæ•Œäººç»„æˆçš„é˜Ÿä¼ï¼‰
public class Army : Enemy
{
    private List<Enemy> enemies = new List<Enemy>();

    public void Add(Enemy enemy)
    {
        enemies.Add(enemy);
    }

    public void Remove(Enemy enemy)
    {
        enemies.Remove(enemy);
    }

    public override void Attack()
    {
        Debug.Log("å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼");
        foreach (var enemy in enemies)
        {
            enemy.Attack();
        }
    }
}

```



```c#
public static void Main()
{
    Soldier soldier1 = new Soldier();
    Soldier soldier2 = new Soldier();
    
    Army smallArmy = new Army();
    smallArmy.Add(soldier1);
    smallArmy.Add(soldier2);

    Army bigArmy = new Army();
    bigArmy.Add(smallArmy);
    bigArmy.Add(new Soldier());

    Debug.Log("å•ä¸ªå£«å…µæ”»å‡»ï¼š");
    soldier1.Attack();

    Debug.Log("å°å‹å†›é˜Ÿæ”»å‡»ï¼š");
    smallArmy.Attack();

    Debug.Log("å¤§å‹å†›å›¢æ”»å‡»ï¼š");
    bigArmy.Attack();
}

/*
å•ä¸ªå£«å…µæ”»å‡»ï¼š
å£«å…µå‘èµ·æ”»å‡»ï¼
å°å‹å†›é˜Ÿæ”»å‡»ï¼š
å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å¤§å‹å†›å›¢æ”»å‡»ï¼š
å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼
å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
*/
```







## è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰


- å’Œé€‚é…å™¨æ¨¡å¼æœ‰ç‚¹ç›¸ä¼¼ï¼Œéƒ½æ˜¯å¯¹æ¥å£è¿›è¡Œäº†åŒ…è£…
- ä½†æ˜¯**ç»„åˆå¤šä¸ªè£…é¥°å™¨**æ¥ä¸ºå¯¹è±¡å¢åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚ä¸€ä¸ªé€‚é…å™¨æ˜¯ä¸å¯ä»¥å†å ä¸€ä¸ªä¸€æ ·çš„é€‚é…å™¨çš„


```c#
// è§’è‰²æ¥å£
public interface ICharacter
{
    void Attack();
    int GetAttackPower();
}

// åŸºæœ¬è§’è‰²ç±»ï¼šæ”»å‡»åŠ›ä¸º 10
public class BasicCharacter : ICharacter
{
    private int attackPower = 10;

    public void Attack()
    {
        Debug.Log("è§’è‰²å‘åŠ¨æ”»å‡»ï¼");
    }

    public int GetAttackPower()
    {
        return attackPower;
    }
}

```


è£…é¥°å™¨åŸºç±»ï¼Œè£…é¥°å™¨ä¸€å®šæ˜¯å’Œè£…é¥°çš„ç‰©ä½“å®ç°åŒä¸€å¥—æ¥å£ï¼Œæ‰èƒ½ä¿è¯ç›¸åŒçš„apiã€‚è¦ä¸ç„¶è°ƒç”¨çš„apiä¸ä¸€æ ·å°±ç®—ä¸ä¸Šè£…é¥°å™¨äº†ã€‚


**éœ€è¦è£…é¥°è°å°±æŠŠè°ææˆæ¥å£ï¼Œç„¶åå®ç°è°ï¼Œè£…é¥°å™¨é‡Œé¢ä¼ å…¥è°ï¼ï¼ï¼**


è€Œä¸”è£…é¥°å™¨çš„æ„é€ å‡½æ•°é‡Œé¢ä¸€å®šè¦ä¼ å…¥ä¸€ä¸ªè£…é¥°çš„ç‰©ä½“çš„æ¥å£ï¼Œè¿™æ ·æ‰èƒ½å»è£…é¥°å®ƒã€‚
å½“ç„¶äº†ï¼Œjsçš„è¯ç›´æ¥ç”¨å‡½æ•°æŒ‡é’ˆæ¥èµ‹å€¼å°±å®Œäº‹äº†ã€‚




```c#
// è£…é¥°å™¨åŸºç±»ï¼Œç»§æ‰¿è‡ª ICharacterï¼Œæ‰€æœ‰è£…é¥°å™¨éƒ½ä»è¿™ä¸ªç±»æ´¾ç”Ÿ
public abstract class CharacterDecorator : ICharacter
{
    protected ICharacter _character;

    public CharacterDecorator(ICharacter character)
    {
        _character = character;
    }

    public virtual void Attack()
    {
        _character.Attack();
    }

    public virtual int GetAttackPower()
    {
        return _character.GetAttackPower();
    }
}

```


è£…é¥°å™¨é¦–å…ˆç”¨äº†ä¼ è¿›æ¥çš„å€¼ï¼Œç„¶åå…ˆè°ƒç”¨äº†ä¸€æ³¢ï¼Œä¹‹ååŠ ç‚¹è‡ªå·±çš„ä¸œè¥¿ã€‚è£…é¥°å™¨åŠ åŸºç±»ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸€è‡´æ€§ã€‚ä¹Ÿå¯ä»¥ç›´æ¥å®ç°ICharacterã€‚
è™½ç„¶**è£…é¥°å™¨æ¨¡å¼ä¸å¼ºåˆ¶è¦æ±‚æœ‰åŸºç±»**ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ**å¼•å…¥ä¸€ä¸ªåŸºç±»æˆ–æ¥å£èƒ½å¤Ÿå¸¦æ¥æ›´å¥½çš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§**ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ**å¤§å¤šæ•°è£…é¥°å™¨æ¨¡å¼çš„å®ç°éƒ½ä¼šæœ‰ä¸€ä¸ªåŸºç±»**ã€‚

```c#
// æ­¦å™¨è£…é¥°å™¨ï¼šå¢åŠ æ”»å‡»åŠ›
public class WeaponDecorator : CharacterDecorator
{
    private int additionalAttackPower;

    public WeaponDecorator(ICharacter character, int additionalAttackPower)
        : base(character)
    {
        this.additionalAttackPower = additionalAttackPower;
    }

    public override void Attack()
    {
        base.Attack();
        Debug.Log("ä½¿ç”¨æ­¦å™¨æ”»å‡»ï¼");
    }

    public override int GetAttackPower()
    {
        return base.GetAttackPower() + additionalAttackPower;
    }
}
```



```c#
public class Game
{
    public static void Main()
    {
        // åˆ›å»ºä¸€ä¸ªåŸºæœ¬è§’è‰²
        ICharacter character = new BasicCharacter();
        Debug.Log("åŸºç¡€è§’è‰²æ”»å‡»åŠ›ï¼š" + character.GetAttackPower());
        character.Attack();

        // ç»™è§’è‰²è£…å¤‡æ­¦å™¨
        character = new WeaponDecorator(character, 20); // å¢åŠ  20 æ”»å‡»åŠ›
        Debug.Log("è£…å¤‡æ­¦å™¨åçš„æ”»å‡»åŠ›ï¼š" + character.GetAttackPower());
        character.Attack();
    }

//Weapon armoredWarrior = new Weapon(new Weapon(new BasicCharacter()));
}

```

è£…é¥°å™¨æ¨¡å¼å¯ä»¥æ— é™åµŒå¥—ï¼Œå› ä¸ºæ‰€æœ‰è£…é¥°å™¨éƒ½ä¼šè¿”å›å®ç°çš„æ¥å£ï¼Œè€Œå®ƒè‡ªå·±æœ‰éœ€è¦ä¼ å…¥è¿™ä¸ªæ¥å£ã€‚


## å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰


**å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰** æ˜¯ **ç»“æ„å‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯**å¯¹å¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ç®€åŒ–æ¥å£**ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥æ›´æ–¹ä¾¿åœ°è®¿é—®ç³»ç»Ÿï¼Œè€Œæ— éœ€å…³å¿ƒå†…éƒ¨çš„å¤æ‚é€»è¾‘ã€‚

> **ç®€å•æ¥è¯´ï¼š**
> 
> - **éšè—ç³»ç»Ÿçš„å¤æ‚æ€§**ï¼Œæä¾›ä¸€ä¸ª**ç®€åŒ–çš„ API** ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚
> - **é™ä½è€¦åˆåº¦**ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ç›´æ¥æ“ä½œå¤æ‚çš„å­ç³»ç»Ÿï¼Œè€Œæ˜¯é€šè¿‡å¤–è§‚ç±»è¿›è¡Œäº¤äº’ã€‚


è¿åäº†å¼€é—­åŸåˆ™ï¼Œå› ä¸ºå­ç³»ç»Ÿå˜æ›´ä¼šå¯¼è‡´å¤–è§‚ç±»ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚



å¦‚æœä¸ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š


```c#
public class Game
{
    public void Start()
    {
        AudioManager audio = new AudioManager();
        audio.LoadSounds();
        audio.PlayBackgroundMusic();

        GraphicsManager graphics = new GraphicsManager();
        graphics.LoadTextures();
        graphics.RenderScene();

        InputManager input = new InputManager();
        input.Initialize();
    }
}

```



å¦‚æœä½¿ç”¨äº†å¤–è§‚æ¨¡å¼çš„è¯ï¼ˆ
```c#
// å­ç³»ç»Ÿ1ï¼šéŸ³é¢‘ç®¡ç†
public class AudioManager
{
    public void LoadSounds() { Console.WriteLine("åŠ è½½éŸ³æ•ˆ..."); }
    public void PlayBackgroundMusic() { Console.WriteLine("æ’­æ”¾èƒŒæ™¯éŸ³ä¹..."); }
}

// å­ç³»ç»Ÿ2ï¼šå›¾å½¢ç®¡ç†
public class GraphicsManager
{
    public void LoadTextures() { Console.WriteLine("åŠ è½½çº¹ç†..."); }
    public void RenderScene() { Console.WriteLine("æ¸²æŸ“åœºæ™¯..."); }
}

// å­ç³»ç»Ÿ3ï¼šè¾“å…¥ç®¡ç†
public class InputManager
{
    public void Initialize() { Console.WriteLine("åˆå§‹åŒ–è¾“å…¥è®¾å¤‡..."); }
}

// å¤–è§‚ç±»ï¼šæä¾›ç®€å•çš„æ¥å£
public class GameFacade
{
    private AudioManager _audio;
    private GraphicsManager _graphics;
    private InputManager _input;

    public GameFacade()
    {
        _audio = new AudioManager();
        _graphics = new GraphicsManager();
        _input = new InputManager();
    }

    public void InitializeGame()
    {
        Console.WriteLine("åˆå§‹åŒ–æ¸¸æˆ...");
        _audio.LoadSounds();
        _audio.PlayBackgroundMusic();
        _graphics.LoadTextures();
        _graphics.RenderScene();
        _input.Initialize();
        Console.WriteLine("æ¸¸æˆå¯åŠ¨æˆåŠŸï¼");
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class Game
{
    public void Start()
    {
        GameFacade gameFacade = new GameFacade();
        gameFacade.InitializeGame();  // åªéœ€è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œç®€åŒ–äº†é€»è¾‘
    }
}

```



## äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰


**äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰** æ˜¯ä¸€ç§**ç»“æ„å‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯**é€šè¿‡å…±äº«æ•°æ®æ¥å‡å°‘å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œé™ä½å†…å­˜æ¶ˆè€—**ã€‚


**ï¼ï¼ï¼ï¼æ³¨æ„ï¼Œäº«å…ƒæ¨¡å¼å’Œå¯¹è±¡æ± æ¨¡å¼æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼**

- äº«å…ƒæ¨¡å¼æ˜¯ä¸ºäº†è§£å†³å†…å­˜é—®é¢˜ï¼Œé€šè¿‡ä¸åŒå¯¹è±¡å…±äº«åŒä¸€ä¸ªæ•°æ®å‡å°‘å†…å­˜å ç”¨ï¼
- è€Œå¯¹è±¡æ± æ¨¡å¼æ˜¯ä¸ºäº†å‡å°‘åå¤ç”Ÿæˆå’Œé”€æ¯å¯¹è±¡å¸¦æ¥çš„ç®—åŠ›å¼€é”€ã€‚
- äº«å…ƒæ¨¡å¼è¿˜æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡çš„ï¼Œåªä¸è¿‡å¯¹è±¡ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®æ˜¯å…±äº«çš„ï¼ˆä¾‹å¦‚è´´å›¾ï¼Œæ¨¡å‹ç­‰ï¼‰ï¼Œè€Œå¯¹è±¡æ± æ˜¯å®Œå®Œå…¨å…¨å¤ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚


äº«å…ƒæ¨¡å¼ä¸€èˆ¬åŒ…å«ï¼š

1. **Flyweightï¼ˆäº«å…ƒç±»ï¼‰**ï¼šè¡¨ç¤º**å¯å…±äº«çš„éƒ¨åˆ†**ï¼Œé€šå¸¸æ˜¯**ä¸å¯å˜æ•°æ®**ã€‚
2. **ConcreteFlyweightï¼ˆä½¿ç”¨äº«å…ƒå¯¹è±¡çš„å…·ä½“ç±»ï¼‰**ï¼šå®ç°å…±äº«é€»è¾‘ï¼Œå­˜å‚¨ä¸å¯å˜æ•°æ®ã€‚
3. **FlyweightFactoryï¼ˆäº«å…ƒå·¥å‚ç±»ï¼‰**ï¼šç”¨äº**ç®¡ç†å’Œå¤ç”¨äº«å…ƒå¯¹è±¡**ï¼Œä¿è¯ç›¸åŒæ•°æ®çš„å¯¹è±¡ä¸ä¼šé‡å¤åˆ›å»ºã€‚
4. **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šä½¿ç”¨äº«å…ƒå¯¹è±¡ï¼Œå­˜å‚¨å¯å˜æ•°æ®ã€‚



äº«å…ƒç±»ï¼Œå®šä¹‰å¯ä»¥è¢«äº«å…ƒçš„æ•°æ®
```c#
using System;

public class EnemyFlyweight
{
    public string Name { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šåå­—
    public string ImagePath { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šå›¾ç‰‡è·¯å¾„
    public string[] SoundEffects { get; private set; }  // ç»Ÿä¸€çš„éŸ³æ•ˆ
    public string Color { get; private set; }  // ç»Ÿä¸€çš„é¢œè‰²
    public int MaxHealth { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šè¡€é‡ä¸Šé™
    public double Speed { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šé€Ÿåº¦

    public EnemyFlyweight(string name, string imagePath, string[] soundEffects, string color, int maxHealth, double speed)
    {
        Name = name;
        ImagePath = imagePath;
        SoundEffects = soundEffects;
        Color = color;
        MaxHealth = maxHealth;
        Speed = speed;
    }
}

```


æ­£å¸¸çš„æ•Œäººç±»ï¼Œå¹¶ä¸”æŒæœ‰EnemyFlyweightè¿™ä¸ªå¼•ç”¨ï¼Œå¹¶åŒ…å«ä¸å¯å…±äº«çš„å±æ€§ï¼šhpå’Œheightã€‚


```c#
public class Enemy
{
    private EnemyFlyweight _flyweight;  // äº«å…ƒå¯¹è±¡
    public int CurrentHealth { get; set; }  // å½“å‰è¡€é‡
    public double Height { get; set; }  // èº«é«˜

    public Enemy(string rank, int currentHealth, double height)
    {
        _flyweight = FlyweightFactory.Instance.GetFlyweight(rank);
        CurrentHealth = currentHealth;
        Height = height;
    }

    public void DisplayEnemyInfo()
    {
        Console.WriteLine($"Name: {_flyweight.Name}");
        Console.WriteLine($"Health: {CurrentHealth}/{_flyweight.MaxHealth}");
        Console.WriteLine($"Height: {Height}m");
        Console.WriteLine($"Image: {_flyweight.ImagePath}");
        Console.WriteLine($"Sound Effects: {string.Join(", ", _flyweight.SoundEffects)}");
        Console.WriteLine($"Color: {_flyweight.Color}");
        Console.WriteLine($"Speed: {_flyweight.Speed}m/s");
    }
}

```


äº«å…ƒå·¥å‚ï¼Œåˆ›å»ºäº«å…ƒç±»ï¼Œå¹¶ä¸”ç¼“å­˜äº«å…ƒå¯¹è±¡
```c#
using System.Collections.Generic;

public class FlyweightFactory
{
    private Dictionary<string, EnemyFlyweight> _flyweights = new Dictionary<string, EnemyFlyweight>();

    public EnemyFlyweight GetFlyweight(string rank)
    {
        if (!_flyweights.ContainsKey(rank))
        {
            EnemyFlyweight flyweight;
            switch (rank)
            {
                case "æ–°å…µ":
                    flyweight = new EnemyFlyweight("æ–°å…µ", "b.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 100, 1.0);
                    break;
                case "ä¸­å£«":
                    flyweight = new EnemyFlyweight("ä¸­å£«", "b.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 200, 2.0);
                    break;
                case "ä¸Šå£«":
                    flyweight = new EnemyFlyweight("ä¸Šå£«", "b.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 500, 3.0);
                    break;
                case "ä¸Šå°‰":
                    flyweight = new EnemyFlyweight("ä¸Šå°‰", "a.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 1000, 4.0);
                    break;
                default:
                    throw new ArgumentException("æœªçŸ¥èŒçº§");
            }
            _flyweights[rank] = flyweight;
        }
        return _flyweights[rank];
    }
}

```

å®¢æˆ·ç«¯ä»£ç 
```c#
public class Game
{
    public static void Main()
    {
        FlyweightFactory factory = new FlyweightFactory();

        // åˆ›å»º10000ä¸ªæ•Œäººï¼ˆæ¨¡æ‹Ÿï¼‰
        var enemies = new List<Enemy>();
        for (int i = 0; i < 10000; i++)
        {
            // å‡è®¾æ•ŒäººèŒçº§éšæœº
            string rank = i % 4 == 0 ? "æ–°å…µ" :
                          i % 4 == 1 ? "ä¸­å£«" :
                          i % 4 == 2 ? "ä¸Šå£«" : "ä¸Šå°‰";
            
            var enemy = new Enemy(rank, 100, 1.75);  // æ¯ä¸ªæ•Œäººæœ‰ç‹¬ç«‹çš„è¡€é‡å’Œèº«é«˜
            enemies.Add(enemy);
        }

        // æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ•Œäººçš„ä¿¡æ¯ï¼ˆä»…æ¼”ç¤ºï¼‰
        enemies[0].DisplayEnemyInfo();
    }
}

```







## ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰


ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ä¸ºæŸä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œä»¥**æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®**ã€‚ä»£ç†é€šå¸¸ç”¨äº**å»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ã€è¿œç¨‹è®¿é—®ç­‰**åœºæ™¯ã€‚

ä»£ç†æ¨¡å¼ = **ç»™å¯¹è±¡åŠ ä¸€å±‚â€œä¸­ä»‹â€**


**ä»€ä¹ˆæ—¶å€™ç”¨ä»£ç†æ¨¡å¼ï¼Ÿ**

âœ… **ä½¿ç”¨ä»£ç†æ¨¡å¼**

- ä½ éœ€è¦**æ§åˆ¶æŸä¸ªå¯¹è±¡çš„è®¿é—®**ï¼ˆå¦‚æƒé™ã€è¿œç¨‹è°ƒç”¨ï¼‰ã€‚
- ä½ éœ€è¦**å»¶è¿ŸåŠ è½½**ï¼ˆå¦‚ `GameMapProxy` å…ˆä¸åŠ è½½æ•°æ®ï¼‰ã€‚
- ä½ æƒ³åœ¨è®¿é—®å¯¹è±¡å‰**å¢åŠ é¢å¤–è¡Œä¸º**ï¼ˆå¦‚æ—¥å¿—ã€ç¼“å­˜ï¼‰ã€‚

âœ… **ä¸è¦ä½¿ç”¨ä»£ç†æ¨¡å¼**

- å¦‚æœä¸éœ€è¦**æ‹¦æˆª/æ§åˆ¶**è®¿é—®ï¼Œç›´æ¥ä½¿ç”¨å¯¹è±¡å³å¯ã€‚
- å¦‚æœåªæ˜¯**å¢å¼ºåŠŸèƒ½**ï¼Œå¯ä»¥ç”¨**è£…é¥°å™¨æ¨¡å¼**ã€‚


åœ¨ RPG æ¸¸æˆä¸­ï¼Œè§’è‰²æ‹¥æœ‰æ™®é€šæŠ€èƒ½å’Œç‰¹æ®ŠæŠ€èƒ½ã€‚ç‰¹æ®ŠæŠ€èƒ½é€šå¸¸éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼ˆæ¯”å¦‚è¾¾åˆ°ç‰¹å®šç­‰çº§ã€æ‹¥æœ‰ç‰¹å®šé“å…·ç­‰ï¼‰æ‰èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†æ¨¡å¼æ¥å®ç°è¿™ç§æƒé™æ§åˆ¶ï¼Œç¡®ä¿åªæœ‰æ»¡è¶³æ¡ä»¶çš„è§’è‰²æ‰èƒ½ä½¿ç”¨ç‰¹æ®ŠæŠ€èƒ½ã€‚

**ä¹Ÿå°±æ˜¯è¯´ä¸ºäº†ä¿è¯å•ä¸€èŒè´£åŸåˆ™ï¼ŒSpecialSkillç±»ä¸åº”è¯¥è´Ÿè´£éªŒè¯æŠ€èƒ½çš„é‡Šæ”¾æ¡ä»¶ã€‚è€Œæ˜¯ç”±ä¸€ä¸ªä»£ç†ç±»æ¥æ§åˆ¶æŠ€èƒ½çš„é‡Šæ”¾æ¡ä»¶ã€‚**

```c#
using UnityEngine;

// æŠ½è±¡ä¸»é¢˜ï¼šå®šä¹‰æŠ€èƒ½ä½¿ç”¨çš„æ¥å£
public interface ISkill
{
    void UseSkill();
}

// çœŸå®ä¸»é¢˜ï¼šä»£è¡¨è§’è‰²çš„ç‰¹æ®ŠæŠ€èƒ½
public class SpecialSkill : ISkill
{
    public void UseSkill()
    {
        Debug.Log("ä½¿ç”¨ç‰¹æ®ŠæŠ€èƒ½ï¼Œé‡Šæ”¾å¼ºå¤§çš„é­”æ³•æ”»å‡»ï¼");
    }
}

// ä»£ç†ï¼šä¿æŠ¤ä»£ç†ï¼Œç”¨äºæ§åˆ¶ç‰¹æ®ŠæŠ€èƒ½çš„ä½¿ç”¨æƒé™
public class SkillProxy : ISkill
{
    private SpecialSkill specialSkill;
    private int requiredLevel;
    private int currentLevel;

    public SkillProxy(int requiredLevel, int currentLevel)
    {
        this.requiredLevel = requiredLevel;
        this.currentLevel = currentLevel;
        specialSkill = new SpecialSkill();
    }

    public void UseSkill()
    {
        if (currentLevel >= requiredLevel)
        {
            // æ»¡è¶³ç­‰çº§è¦æ±‚ï¼Œè°ƒç”¨çœŸå®æŠ€èƒ½çš„ä½¿ç”¨æ–¹æ³•
            specialSkill.UseSkill();
        }
        else
        {
            Debug.Log("ç­‰çº§ä¸è¶³ï¼Œæ— æ³•ä½¿ç”¨ç‰¹æ®ŠæŠ€èƒ½ã€‚");
        }
    }
}

// è§’è‰²ç±»ï¼ŒåŒ…å«æŠ€èƒ½ä½¿ç”¨çš„é€»è¾‘
public class Character : MonoBehaviour
{
    public int characterLevel;
    private ISkill skillProxy;

    private void Start()
    {
        // åˆ›å»ºæŠ€èƒ½ä»£ç†ï¼Œè¦æ±‚ç­‰çº§ä¸º 10
        skillProxy = new SkillProxy(10, characterLevel);
    }

    private void Update()
    {
        if (Input.GetKeyDown(KeyCode.S))
        {
            // å°è¯•ä½¿ç”¨æŠ€èƒ½
            skillProxy.UseSkill();
        }
    }
}

```



# è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰

è¡Œä¸ºå‹æ¨¡å¼ä¸»è¦å…³æ³¨**å¯¹è±¡ä¹‹é—´çš„é€šä¿¡**å’Œ**èŒè´£åˆ†é…**ï¼Œä»¥åŠå¦‚ä½•è®©ç³»ç»Ÿä¸­çš„å¯¹è±¡è¿›è¡Œæœ‰æ•ˆçš„åä½œã€‚è¿™ç±»æ¨¡å¼é€šå¸¸ç”¨äºå®šä¹‰**å¯¹è±¡ä¹‹é—´å¦‚ä½•äº’ç›¸é…åˆ**ï¼Œä»è€Œå®ç°æŸä¸€åŠŸèƒ½ã€‚



## è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰

## å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰

## è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰

## è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰

## ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰

## å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰

## è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰


å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè¿™å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚

åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œåªæœ‰ä¸¤ç§ä¸»ä½“ï¼šç›®æ ‡å¯¹è±¡ (**Object**) å’Œ è§‚å¯Ÿè€… (**Observer**)ã€‚



```c#
using System.Collections;
using System.Collections.Generic; 
using UnityEngine;
using System;

public class ObserveMode : MonoBehaviour
{
    //ç©å®¶æ­»äº¡ä¹‹åçš„äº‹ä»¶ï¼Œéœ€è¦è¢«è§‚å¯Ÿ
    public static event Action playerDeadEvent;

    private void OnDestroy()
    {
        playerDeadEvent?.Invoke();
    }
}

```





```c#
//æ•Œäºº
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Enemy : MonoBehaviour
{

    //åœ¨å¼€å§‹å°±è§‚å¯Ÿç©å®¶çš„æ­»äº¡äº‹ä»¶
    void Start()
    {
        ObserveMode.playerDeadEvent += () =>
        {
            print("ç©å®¶æ­»äº†ï¼ï¼");
        };
    }

}

```






## çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰
## ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰
## æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰
## è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰








## çŠ¶æ€æ¨¡å¼

çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚çŠ¶æ€æ¨¡å¼å°†ä¸çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ç‹¬ç«‹çš„çŠ¶æ€ç±»ä¸­ï¼Œå¹¶é€šè¿‡åœ¨è¿™äº›çŠ¶æ€ç±»ä¹‹é—´åˆ‡æ¢æ¥æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚

åœ¨Unityä¸­ï¼ŒçŠ¶æ€æ¨¡å¼å¯ä»¥ç”¨äºç®¡ç†æ¸¸æˆå¯¹è±¡çš„ä¸åŒçŠ¶æ€ï¼Œæ¯”å¦‚è§’è‰²çš„è¡Œèµ°ã€è·³è·ƒã€æ”»å‡»ç­‰çŠ¶æ€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨Unityä¸­å®ç°çŠ¶æ€æ¨¡å¼ã€‚

### ç¤ºä¾‹ä»£ç 

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªçŠ¶æ€æ¥å£å’Œå…·ä½“çš„çŠ¶æ€ç±»ï¼š
åŸºç±»å’Œä¸€äº›ä¾‹å­å®ç°

//Â StateÂ interface

publicÂ interfaceÂ ICharacterState

{

Â Â Â Â voidÂ EnterState(CharacterÂ character);

Â Â Â Â voidÂ UpdateState(CharacterÂ character);

}

//Â WalkingÂ state

publicÂ classÂ WalkingStateÂ :Â ICharacterState

{

Â Â Â Â publicÂ voidÂ EnterState(CharacterÂ character)

Â Â Â Â {

Â Â Â Â Â Â Â Â Debug.Log("EnteringÂ WalkingÂ State");

Â Â Â Â }

Â Â Â Â publicÂ voidÂ UpdateState(CharacterÂ character)

Â Â Â Â {

Â Â Â Â Â Â Â Â Debug.Log("CharacterÂ isÂ walking");

Â Â Â Â Â Â Â Â //Â ImplementÂ walkingÂ logicÂ here

Â Â Â Â }

}

//Â JumpingÂ state

publicÂ classÂ JumpingStateÂ :Â ICharacterState

{

Â Â Â Â publicÂ voidÂ EnterState(CharacterÂ character)

Â Â Â Â {

Â Â Â Â Â Â Â Â Debug.Log("EnteringÂ JumpingÂ State");

Â Â Â Â }

Â Â Â Â publicÂ voidÂ UpdateState(CharacterÂ character)

Â Â Â Â {

Â Â Â Â Â Â Â Â Debug.Log("CharacterÂ isÂ jumping");

Â Â Â Â Â Â Â Â //Â ImplementÂ jumpingÂ logicÂ here

Â Â Â Â }

}

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰è§’è‰²ç±»ï¼Œå®ƒåŒ…å«å½“å‰çŠ¶æ€å¹¶èƒ½å¤Ÿåœ¨ä¸åŒçŠ¶æ€ä¹‹é—´åˆ‡æ¢ï¼š
ç›¸å½“äºæ§åˆ¶å™¨

usingÂ UnityEngine;

publicÂ classÂ CharacterÂ :Â MonoBehaviour

{

Â Â Â Â privateÂ ICharacterStateÂ currentState;

Â Â Â Â publicÂ voidÂ SetState(ICharacterStateÂ newState)

Â Â Â Â {

Â Â Â Â Â Â Â Â currentStateÂ =Â newState;

Â Â Â Â Â Â Â Â currentState.EnterState(this);

Â Â Â Â }

Â Â Â Â voidÂ Update()

Â Â Â Â {

Â Â Â Â Â Â Â Â ifÂ (currentStateÂ !=Â null)

Â Â Â Â Â Â Â Â {

Â Â Â Â Â Â Â Â Â Â Â Â currentState.UpdateState(this);

Â Â Â Â Â Â Â Â }

Â Â Â Â }

}



æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Unityçš„è„šæœ¬ä¸­ä½¿ç”¨è¿™äº›çŠ¶æ€ï¼š
ç”¨æ§åˆ¶å™¨åˆ‡æ¢çŠ¶æ€

usingÂ UnityEngine;

publicÂ classÂ GameControllerÂ :Â MonoBehaviour

{

Â Â Â Â privateÂ CharacterÂ character;

Â Â Â Â voidÂ Start()

Â Â Â Â {

Â Â Â Â Â Â Â Â characterÂ =Â newÂ Character();

Â Â Â Â Â Â Â Â character.SetState(newÂ WalkingState());

Â Â Â Â }

Â Â Â Â voidÂ Update()

Â Â Â Â {

Â Â Â Â Â Â Â Â ifÂ (Input.GetKeyDown(KeyCode.Space))

Â Â Â Â Â Â Â Â {

Â Â Â Â Â Â Â Â Â Â Â Â character.SetState(newÂ JumpingState());

Â Â Â Â Â Â Â Â }

Â Â Â Â }

}

### è®¾è®¡åŸå› å’Œé€»è¾‘

- çŠ¶æ€å°è£…ï¼šæ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºè¢«å°è£…åœ¨ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä½¿å¾—çŠ¶æ€é€»è¾‘æ¸…æ™°ä¸”æ˜“äºç®¡ç†ã€‚

- çŠ¶æ€åˆ‡æ¢ï¼šé€šè¿‡SetStateæ–¹æ³•ï¼Œè§’è‰²å¯ä»¥åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´åˆ‡æ¢ï¼Œæ”¹å˜å…¶è¡Œä¸ºã€‚

- æ‰©å±•æ€§ï¼šæ·»åŠ æ–°çŠ¶æ€åªéœ€åˆ›å»ºæ–°çš„çŠ¶æ€ç±»å¹¶å®ç°ICharacterStateæ¥å£ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç ã€‚

- è§£è€¦ï¼šè§’è‰²ç±»ä¸å…·ä½“çš„çŠ¶æ€å®ç°è§£è€¦ï¼Œè§’è‰²ç±»åªéœ€ä¸çŠ¶æ€æ¥å£äº¤äº’ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒçŠ¶æ€æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†å¯¹è±¡çš„ä¸åŒçŠ¶æ€ï¼Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚








## ç»„åˆæ¨¡å¼

## å‘å¸ƒè€…è®¢é˜…è€…æ¨¡å¼

å’Œè§‚å¯Ÿè€…æ¨¡å¼å¾ˆåƒï¼Œä½†æ˜¯è¦æ³¨æ„ï¼ï¼ï¼

è§‚å¯Ÿè€…æ¨¡å¼å®é™…ä¸Šæ˜¯**æ¾è€¦åˆ(loosely coupled)**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç©å®¶æ­»äº¡ä¹‹åä¼šç›´æ¥é€šçŸ¥æ‰€æœ‰çš„æ•Œäººã€‚è¿™ä¸ªå®é™…ä¸Šè¿˜æ˜¯æœ‰å¾ˆå¼ºçš„è€¦åˆæ€§çš„ã€‚

ä½†æ˜¯å‘å¸ƒè€…è®¢é˜…è€…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…å¹¶ä¸ä¼šç›´æ¥é€šä¿¡ï¼è€Œæ˜¯é€šè¿‡ä¸€ä¸ªä¸­é—´å•†è¿›è¡Œé€šä¿¡ã€‚

å‘å¸ƒè€…åªéœ€å‘Šè¯‰ä¸­é—´å•†ï¼Œæˆ‘è¦å‘çš„æ¶ˆæ¯ï¼Œtopicæ˜¯AAAï¼›

è®¢é˜…è€…åªéœ€å‘Šè¯‰ä¸­é—´å•†ï¼Œæˆ‘è¦è®¢é˜…topicæ˜¯AAAçš„æ¶ˆæ¯ï¼›å³å¯ã€‚





```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using System;

public enum äº‹ä»¶ç±»å‹
{
    ç©å®¶æ­»äº¡,
    æ•Œäººæ­»äº¡
}


public class è®¢é˜…è€…å‘å¸ƒè€…æ¨¡å¼ : MonoBehaviour
{
    //ç”¨æ¥ç»´æŠ¤æ‰€æœ‰çš„äº‹ä»¶
    private static Dictionary<äº‹ä»¶ç±»å‹, Delegate> å‘å¸ƒäº‹ä»¶å­—å…¸ = new Dictionary<äº‹ä»¶ç±»å‹, Delegate>();

    private static void  è®¢é˜…å‰çš„æ£€æŸ¥(äº‹ä»¶ç±»å‹ äº‹ä»¶, Delegate å›è°ƒå‡½æ•°)
    {
        if (!å‘å¸ƒäº‹ä»¶å­—å…¸.ContainsKey(äº‹ä»¶))
        {
            å‘å¸ƒäº‹ä»¶å­—å…¸.Add(äº‹ä»¶, null);
        }
        Delegate å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•° = å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶];
        if (å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•° != null && å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•°.GetType() != å›è°ƒå‡½æ•°.GetType())
        {
            throw new Exception(string.Format("å°è¯•ä¸ºäº‹ä»¶{0}æ·»åŠ ä¸åŒç±»å‹çš„å§”æ‰˜ï¼Œå½“å‰äº‹ä»¶æ‰€å¯¹åº”çš„å§”æ‰˜æ˜¯{1}ï¼Œè¦æ·»åŠ çš„å§”æ‰˜ç±»å‹ä¸º{2}", äº‹ä»¶, å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•°.GetType(), å›è°ƒå‡½æ•°.GetType()));
        }
    }

    //æ— å‚æ•°çš„è®¢é˜…ä¸å‘å¸ƒ
    public static void è®¢é˜…(äº‹ä»¶ç±»å‹ äº‹ä»¶, Action å›è°ƒå‡½æ•°)
    {
        è®¢é˜…å‰çš„æ£€æŸ¥(äº‹ä»¶, å›è°ƒå‡½æ•°);
        å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] = (Action)å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] + å›è°ƒå‡½æ•°;//ç”¨å¤šæ’­ç›´æ¥å­˜å‚¨å›è°ƒå‡½æ•°
    }

    public static void å‘å¸ƒ(äº‹ä»¶ç±»å‹ äº‹ä»¶)
    {

        Delegate å›è°ƒå‡½æ•°;
        if (å‘å¸ƒäº‹ä»¶å­—å…¸.TryGetValue(äº‹ä»¶, out å›è°ƒå‡½æ•°))
        {
            ((Action)å›è°ƒå‡½æ•°)();
        }
    }



    //ä¸€ä¸ªå‚æ•°çš„è®¢é˜…ä¸å‘å¸ƒ

    public static void è®¢é˜…<T>(äº‹ä»¶ç±»å‹ äº‹ä»¶, Action<T> å›è°ƒå‡½æ•°)
    {
        è®¢é˜…å‰çš„æ£€æŸ¥( äº‹ä»¶,  å›è°ƒå‡½æ•°);
        å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] = (Action<T>)å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] + å›è°ƒå‡½æ•°;//ç”¨å¤šæ’­ç›´æ¥å­˜å‚¨å›è°ƒå‡½æ•°
    }

    public static void å‘å¸ƒ<T>(äº‹ä»¶ç±»å‹ äº‹ä»¶,T å‚æ•°)
    {

        Delegate å›è°ƒå‡½æ•°;
        if (å‘å¸ƒäº‹ä»¶å­—å…¸.TryGetValue(äº‹ä»¶, out å›è°ƒå‡½æ•°))
        {
            ((Action<T>)å›è°ƒå‡½æ•°)(å‚æ•°);
        }
    }

}

```



```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class è®¢é˜…è€… : MonoBehaviour
{

    void Start()
    {
        è®¢é˜…è€…å‘å¸ƒè€…æ¨¡å¼.è®¢é˜…<string>(äº‹ä»¶ç±»å‹.ç©å®¶æ­»äº¡, (msg) =>{
            print("æ”¶åˆ°äº‹ä»¶é€šçŸ¥ï¼"+msg);
        });
    }

}

```





```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class å‘å¸ƒè€… : MonoBehaviour
{

    private void OnDisable()
    {
        è®¢é˜…è€…å‘å¸ƒè€…æ¨¡å¼.å‘å¸ƒ(äº‹ä»¶ç±»å‹.ç©å®¶æ­»äº¡,"GGGG");

    }
}

```



 ## äº«å…ƒæ¨¡å¼



åœ¨Unityä¸­å®ç°äº«å…ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é‡é‡å¤å¯¹è±¡çš„åœºæ™¯ä¸­ï¼ˆå¦‚ç²’å­ç³»ç»Ÿã€æ•Œäººç®¡ç†ã€æ ‘æœ¨æ¸²æŸ“ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªäº«å…ƒæ¨¡å¼æ¨¡æ¿çš„å®Œæ•´å®ç°ï¼š


äº«å…ƒæ¨¡å¼åŒ…æ‹¬ï¼š

- **äº«å…ƒå·¥å‚ï¼ˆFlyweight Factoryï¼‰ï¼š** ç”¨äºç®¡ç†å’Œå¤ç”¨äº«å…ƒå¯¹è±¡ã€‚
- **äº«å…ƒæ¥å£ï¼ˆFlyweightï¼‰ï¼š** å®šä¹‰å…±äº«å¯¹è±¡çš„é€šç”¨æ¥å£ã€‚
- **å…·ä½“äº«å…ƒç±»ï¼ˆConcrete Flyweightï¼‰ï¼š** å®ç°äº«å…ƒæ¥å£ï¼Œè¡¨ç¤ºå¯å…±äº«çš„å¯¹è±¡ã€‚
- **éå…±äº«å…·ä½“äº«å…ƒï¼ˆUnshared Flyweightï¼‰ï¼š** è¡¨ç¤ºä¸å…±äº«çš„çŠ¶æ€ã€‚


```c#
using System.Collections.Generic;
using UnityEngine;

// Flyweight Interface
public interface IEnemy
{
    void Display(Vector3 position);
}

// Concrete Flyweight
public class EnemyType : IEnemy
{
    private string _name; // äº«å…ƒå†…éƒ¨å…±äº«çš„çŠ¶æ€
    private Color _color;

    public EnemyType(string name, Color color)
    {
        _name = name;
        _color = color;
    }

    public void Display(Vector3 position)
    {
        // åœ¨åœºæ™¯ä¸­å±•ç¤ºæ•Œäºº
        GameObject enemy = GameObject.CreatePrimitive(PrimitiveType.Cube);
        enemy.transform.position = position;
        enemy.name = _name;
        enemy.GetComponent<Renderer>().material.color = _color;

        Debug.Log($"Spawned {_name} at {position}");
    }
}

// Flyweight Factory
public class EnemyFactory
{
    private Dictionary<string, EnemyType> _enemyTypes = new Dictionary<string, EnemyType>();

    public IEnemy GetEnemyType(string name, Color color)
    {
        if (!_enemyTypes.ContainsKey(name))
        {
            _enemyTypes[name] = new EnemyType(name, color);
            Debug.Log($"Created new EnemyType: {name}");
        }

        return _enemyTypes[name];
    }
}

// Client
public class EnemySpawner : MonoBehaviour
{
    private EnemyFactory _factory;

    void Start()
    {
        _factory = new EnemyFactory();

        // Spawning enemies
        SpawnEnemy("Orc", Color.green, new Vector3(0, 0, 0));
        SpawnEnemy("Goblin", Color.red, new Vector3(2, 0, 0));
        SpawnEnemy("Orc", Color.green, new Vector3(4, 0, 0)); // Reuses the "Orc" type
        SpawnEnemy("Goblin", Color.red, new Vector3(6, 0, 0)); // Reuses the "Goblin" type
    }

    private void SpawnEnemy(string name, Color color, Vector3 position)
    {
        IEnemy enemy = _factory.GetEnemyType(name, color);
        enemy.Display(position);
    }
}
```






# å¤–è§‚æ¨¡å¼


å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰åœ¨GoFä¸­çš„è§£é‡Šï¼š**ä¸ºå­ç³»ç»Ÿå®šä¹‰ä¸€ç»„ç»Ÿä¸€çš„æ¥å£ï¼Œè¿™ä¸ªé«˜çº§æ¥å£ä¼šè®©å­ç³»ç»Ÿæ›´å®¹æ˜“è¢«ä½¿ç”¨ã€‚**  
æ‰€ä»¥ï¼Œå¤–è§‚æ¨¡å¼çš„é‡ç‚¹åœ¨äºï¼Œå®ƒèƒ½å¤Ÿå°†ç³»ç»Ÿå†…éƒ¨çš„äº’åŠ¨ç»†èŠ‚éšè—èµ·æ¥ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•æ–¹ä¾¿çš„æ¥å£ã€‚




### ç¤ºä¾‹ä»£ç 

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰å‡ ä¸ªå­ç³»ç»Ÿï¼š


```c#
//Â AnimationÂ system
publicÂ classÂ AnimationSystem
{
Â Â Â Â publicÂ voidÂ PlayAnimation(stringÂ animationName)
Â Â Â Â {
Â Â Â Â Â Â Â Â Debug.Log($"PlayingÂ animation:Â {animationName}");
Â Â Â Â }
}

//Â SoundÂ system

publicÂ classÂ SoundSystem

{

Â Â Â Â publicÂ voidÂ PlaySound(stringÂ soundName)

Â Â Â Â {

Â Â Â Â Â Â Â Â Debug.Log($"PlayingÂ sound:Â {soundName}");

Â Â Â Â }

}

//Â PhysicsÂ system

publicÂ classÂ PhysicsSystem

{

Â Â Â Â publicÂ voidÂ ApplyForce(Vector3Â force)

Â Â Â Â {

Â Â Â Â Â Â Â Â Debug.Log($"ApplyingÂ force:Â {force}");

Â Â Â Â }

}

```


æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤–è§‚ç±»æ¥ç®€åŒ–å¯¹è¿™äº›å­ç³»ç»Ÿçš„æ“ä½œï¼š

```c#
//Â FacadeÂ class

publicÂ classÂ CharacterFacade

{

Â Â Â Â privateÂ AnimationSystemÂ animationSystem;

Â Â Â Â privateÂ SoundSystemÂ soundSystem;

Â Â Â Â privateÂ PhysicsSystemÂ physicsSystem;

Â Â Â Â publicÂ CharacterFacade()

Â Â Â Â {

Â Â Â Â Â Â Â Â animationSystemÂ =Â newÂ AnimationSystem();

Â Â Â Â Â Â Â Â soundSystemÂ =Â newÂ SoundSystem();

Â Â Â Â Â Â Â Â physicsSystemÂ =Â newÂ PhysicsSystem();

Â Â Â Â }

Â Â Â Â publicÂ voidÂ PerformAction(stringÂ animationName,Â stringÂ soundName,Â Vector3Â force)

Â Â Â Â {

Â Â Â Â Â Â Â Â animationSystem.PlayAnimation(animationName);

Â Â Â Â Â Â Â Â soundSystem.PlaySound(soundName);

Â Â Â Â Â Â Â Â physicsSystem.ApplyForce(force);

Â Â Â Â }

}
```



æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Unityçš„è„šæœ¬ä¸­ä½¿ç”¨è¿™ä¸ªå¤–è§‚ç±»ï¼š

```c#
usingÂ UnityEngine;

publicÂ classÂ GameControllerÂ :Â MonoBehaviour

{

Â Â Â Â privateÂ CharacterFacadeÂ characterFacade;

Â Â Â Â voidÂ Start()

Â Â Â Â {

Â Â Â Â Â Â Â Â characterFacadeÂ =Â newÂ CharacterFacade();

Â Â Â Â Â Â Â Â characterFacade.PerformAction("Jump",Â "JumpSound",Â newÂ Vector3(0,Â 10,Â 0));

Â Â Â Â }

}
```



### è®¾è®¡åŸå› å’Œé€»è¾‘

1.Â ç®€åŒ–æ¥å£ï¼šå¤–è§‚ç±»CharacterFacadeæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•PerformActionï¼Œå°†å¤šä¸ªå­ç³»ç»Ÿçš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç çš„ä½¿ç”¨ã€‚

- è§£è€¦ï¼šå®¢æˆ·ç«¯ä»£ç ä¸éœ€è¦ç›´æ¥ä¸å¤šä¸ªå­ç³»ç»Ÿäº¤äº’ï¼Œåªéœ€ä¸å¤–è§‚ç±»äº¤äº’å³å¯ã€‚è¿™å‡å°‘äº†å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„è€¦åˆã€‚

- å¯ç»´æŠ¤æ€§ï¼šå¦‚æœå­ç³»ç»Ÿçš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œåªéœ€ä¿®æ”¹å¤–è§‚ç±»ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¤–è§‚æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç»„ç»‡ä»£ç ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¸Œæœ›è¿™ä¸ªç¤ºä¾‹èƒ½å¸®åŠ©ä½ ç†è§£å¤–è§‚æ¨¡å¼åœ¨Unityä¸­çš„åº”ç”¨ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚