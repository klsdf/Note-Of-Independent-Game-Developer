# 关系代数

## 1

现有关系数据库如下：

学生(学号，姓名，性别，专业、奖学金)

课程(课程号，名称，学分)

学习(学号，课程号，分数)

1.检索“国际贸易”专业中获得奖学金的学生信息，包括学号、姓名、课程名和分数；

2.检索学生成绩得过满分(100分)的课程的课程号、名称和学分；

3.检索没有获得奖学金、同时至少有一门课程成绩在95分以上的学生信息，包括学号、姓名和专业；

4.检索没有任何一门课程成绩在80分以下的学生的信息，包括学号、姓名和专业；

![image-20220305134657693](img/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220305134657693.png)

## 2

现有关系数据库如下：

学生(学号，姓名，性别，专业，奖学金)

课程(课程号，名称，学分)

学习(学号，课程号，分数)

1.检索“英语”专业学生所学课程的信息，包括学号、姓名、课程名和分数。

2.检索“数据库原理”课程成绩高于90分的所有学生的学号、姓名、专业和分数；

3.检索不学课程号为“C135”课程的学生信息，包括学号，姓名和专业；

4.检索没有任何一门课程成绩不及格的所有学生的信息，包括学号、姓名和专业；

![image-20220305142210326](img/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220305142210326.png)



## 3

假设教学数据库中已建立三个关系：

学生关系 student(sno, sname, sex, birth, height, class, address)

课程关系course(cno, cname, credit)

选修关系elective(sno, cno, grade)

试用关系代数和SQL语言分别写出下列查询：

（1）检索至少选修课程号为C02和C06的学生学号。（4分）

（2）检索没有选修C06课程的学生姓名及其所在班级。（4分）

（3）检索学 习全部课程的学生姓名。（4分）

（4）检索学习课程中包含了S08学生所学课程的学生学号。（4分）



![image-20220309100453798](img/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220309100453798.png)

![image-20220309100503474](img/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220309100503474.png)

# E-R图

## 知识点



这个玩意的关键点就是

比如说 **一个教员可讲授多门课程，一门课程只能被一个教员讲授**，那么多门课程就是n，n写到课程那边。**一门课程只能被一个教员讲授**，这个1写到教员那边。也就是说关键点就是看后半句话，后半句是几，对面就是几。

## 1

某教学管理系统涉及教员、学生、课程、教室四个实体，它们分别具有下列属性：

- 教员：职工号、姓名、年龄、职称    
- 学生：学号、姓名、年龄、性别
- 课程：课程号、课程名、课时数     
- 教室：教室编号、地址、容量

这些实体间的联系如下：一个教员可讲授多门课程，一门课程只能被一个教员讲授；一个学生选修多门课程，每门课程有多个学生选修，学生学习有成绩，一门课只在一个教室上，一个教室可上多门课。

请画出教员、学生、课程、教室的E—R图。

![image-20220304155238816](img/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20220304155238816.png)









## 2

设某数据库中有三个实体集。一是工厂实体集，其属性有工厂名称、厂址、联系电话等；二是产品实体集，其属性有产品号、产品名、规格、单价等；三是工人实体集，其属性有工人编号、姓名、性别、职称等。

工厂与产品之间存在生产联系，每个工厂可以生产多种产品，每种产品可由多个工厂加工生产，要记录每个工厂生产每种产品的月产量；工厂与工人之间存在雇用关系，每个工人只能在一个工厂工作，工厂雇用工人有雇用期并议定月薪。

1. 试画出E-R图，注明属性和联系类型。（4分）

   ![img](file:///C:\Users\闫辰祥\AppData\Local\Temp\ksohtml\wpsF403.tmp.png)

2. 将E-R图转换成关系模型数据结构，并标明主码和外码。（6分）

工厂（工厂名称，厂址，联系电话）-----1分

产品（产品号，产品名，规格，单价）------1分

工人（工人编号，姓名，性别，职称，工厂名称，雇用期，月薪）-----1分

 其中，工厂名称为外码  -----1分

生产（工厂名称，产品号，月产量）-----1分

 其中，工厂名称和产品号都是外码  -----1分



**n对1关系的，只需要写n这边的，而且需要写1对应的外码**

**n对m关系的需要单独写出来，并且写两个外码**

# 最小依赖集、候选码、范式判断

## 知识点

第二范式就是说看看主属性能不能单独推出来非主属性，要是推出来了，说明是部份依赖，就不是

第三范式就是说看看有没有传递关系

BCNF就是说，左边的式子每一项必须都包含候选码



## 1

设F={C→A, CG→D, CG→B, CE→A, ACD→B}， 求最小函数依赖集。

答案：

（1）函数依赖集F满足右部最小化；

（2）对F进行规则最小化：CE→A可去掉，CG→B可去掉，所以可得F1={C→A, CG→D, ACD→B}；

（3）对F进行左部最小化：可将ACD→B用CD→B取代。

所以F的最小函数依赖集为{C→A, CG→D, CD→B}

## 2

F={BC→E, DC→B, D→A, B→G, D→E, E→G, B→C}

①求最小依赖集

{B→E, DC→B, D→A, D→E, E→G, B→C}



②求候选码

DB DC



③求第几范式

第一范式





## 3

假设某商业集团数据库中有一关系模式R如下：

R (商店编号，商品编号，数量，部门编号，负责人)

如果规定：(1) 每个商店的每种商品只在一个部门销售；

​     (2) 每个商店的每个部门只有一个负责人；

​     (3) 每个商店的每种商品只有一个库存数量。

试回答下列问题：

(1) 根据上述规定，写出关系模式R的基本函数依赖；

(2) 找出关系模式R的候选码；

(3) 试问关系模式R最高已经达到第几范式？为什么？

(4) 如果R不属于3NF，请将R分解成3NF模式集。

 

 答案：

(1) 有三个函数依赖：(商店编号，商品编号) →部门编号

​          (商店编号，部门编号) →负责人

​          (商店编号，商品编号) →数量     （3分）

(2) R的候选码是 (商店编号，商品编号)    （2分）

(3) 因为R中存在着非主属性“负责人”对候选码 (商店编号、商品编号)的传递函数依赖，所以R属于2NF，R不属于3NF。（2分）

(4) 将R分解成：R1 (商店编号，商品编号，数量，部门编号)

​        R2 (商店编号，部门编号，负责人)      （3分）

##  4

1. 设有函数依赖集F={AB→CE, A→C, GP→B, EP→A, CDE→P, HB→P, D→HG, ABC→PG}，求属性D关于F的闭包D+。

   令X={D} , 

   X(0)=D -----1分

   X(1)=DHG -----1分

   X(2)=DHG -----1分

   故D+=DHG。-----1分

2. 设有函数依赖集F={AC→PE, PG→A, B→CE, A→P, GA→B, GC→A, PAB→G, AE→GB, ABCP→H}，求属性集BG关于F的闭包(BG)+。

 X(0)=BG, -----1分

X(1)=BGCE, -----1分

X(2)=BGCEA, -----1分

X(3)=BGCEAP, -----1分

X(4)=BGCEAPH=U, -----1分

故(BG)+= BGCEAPH。-----1分

 

## 5

设有关系模式R(A, B, C, D, E)，R中的属性均不可再分解，若只基于函数依赖进行讨论，试根据给定的函数依赖集F，分析R最高属于第几范式，并说明原因。

(1) F={AB→C, AB→E, CDE→AB}；  ABD  CDE

(2) F={CD→A, CD→B, AB→E}。  CD

 



**答案：**

(1) R最高属于BCNF(3分)。因为候选码为CDE，即主属性为C、D、E，且不存在任何属性对码的部分和传递函数依赖（2分）；

(2) R最高属于2NF（3分）。因为候选码为CD，即主属性为C、D，且存在非主属性E对码的传递函数依赖（2分）。



# SQL

## 1

用SQL语句完成下列功能（每小题4分，共20分）

设学生---社团数据库有三个基本表：

学生（学号，姓名，年龄，性别）；

社团（编号，名称，负责人，办公地点）；

参加（学号，编号，参加日期）；

其中：

学生表的主码为学号；社团表的主码为编号；外码为负责人，被参照表为学生表，对应属性为学号；参加表的学号和编号为主码；学号为外码，其被参照表为学生表，对应属性为学号；编号为外码，其被参照表为社团表，对应属性为编号。

1）定义社团表，说明其主码和参照关系。



```sql
create table 社团(
	编号 int primary key,
	名称 varchar(20),
	负责人 int,
	办公地点 varchar(20),
	constraint fk foreign key(负责人) references 学生(学号)
);
```

2）建立视图：社团负责人（社团编号，名称，负责人学号，负责人姓名，负责人性别）；

```sql
create view 社团负责人(社团编号,名称,负责人学号,负责人姓名,负责人性别) AS
select 社团.编号,社团.名称，学生.学号，学生.姓名，学生.性别
from 学生,社团,参加
where 学生.学号= 参加.学号 and 社团.编号= 参加.编号;
```

3）查询参加科协的学生学号、姓名和性别。

```sql
select 学号,姓名,性别
from 学生,参加,社团
where 学生.学号=参加.学号 and社团.编号=参加.编号 and 名称='科协';
```



4）求每个社团的参加人数。

```sql
select count() as '人数'
from 参加
group by 编号;
```



5）把对社团表的插入和删除数据的权力赋给用户李平，并允许他将此权力授予其他用户。

```sql
grant insert,delete 
on 社团
to 李平
with grant option;
```

## 2

现有如下关系：

  职工（职工号，姓名，性别，职务，家庭地址，部门编号）

  部门（部门编号，部门名称，地址，电话）

  保健（保健卡编号，职工号，检查身体日期，健康状况）

1．查找所有女科长的元组：

```sql
select *
from 职工
where 职务='科长' and 性别='女';
```

2．查找“办公室”的科长姓名和家庭地址：

```sql
select 姓名,家庭住址
from 职工,部门
where 职工.部门编号=部门.部门编号 and 部门名称='办公室' and 职务='科长';

```

3．查找“财务科”中健康状况为“良好”的职工姓名和家庭地址：

```sql
select 姓名,家庭地址
from 职工,部门,保健
where 职工.部门编号= 部门.部门编号 and 职工.职工号 = 保健.职工号 and 部门名称='财务科' and 健康状况= '良好';

```

4．将职工号为“3016”的职工的健康状况改为“一般”

```sql
update 保健 
set 健康状况='一般'
where 职工.职工号= 3016;
```

5．删除职工关系表中职工号为“3016”的记录：

```sql
delete 
from 职工
where 职工.职工号= 3016;

```

6．建立健康状况为“差”的职工的视图：

```sql
create view 健康状况差(职工号，姓名) as
select 职工号，姓名
from 职工,保健
where 职工.职工号 = 保健.职工号 and 健康程度= '差' ;
```



7．向保健表中增加一个“备注”列，其数据类型为字符型，长度为20。



```sql
alter table 保健
add 备注 varchar(20) ;

```



# ACID特性 

- 原子性（Atomicity）

  事务执行的时候要么全部执行，要么全部不执行。

- 一致性（Consistency）

  如果事务中的代码有任何一句出错，那么所有的代码都会被回滚。

- 隔离性（Isolation）

  不同事物直接互相不可见。即使事务向某个表添加了新的记录，在没有提交前，其他事务是无法看到新记录的。

- 持久性（Durability）

  DBMS需要保证，无论是提交还是回滚结束后，该时间点的数据状态能够被保存。即使数据丢失，也能通过一定方式回复。

