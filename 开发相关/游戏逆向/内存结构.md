


# c#内存结构
### **托管堆（Managed Heap）：**

- 专门存放**引用类型的实例**（比如类对象、数组、字符串等）。
    
- 由CLR的**垃圾回收（GC）**自动管理，程序员不用自己释放。
    
- 内存按**代（Generation）**划分：
    
    - **Gen 0（第0代）：** 刚分配的新对象放这里，回收最快。
        
    - **Gen 1（第1代）：** 从Gen 0晋升过来的，生命周期中等。
        
    - **Gen 2（第2代）：** 活得最久的对象，比如大型对象。
        
- **LOH（Large Object Heap）：**  
    大对象（>85KB）会被直接放到这里，比如大数组，GC不经常回收它们喵。
    

---

### 2️⃣ **栈（Stack）：**

- 存放**值类型的局部变量**（如`int`, `double`, `struct`），还有：
    
    - 方法参数
        
    - 返回地址、临时变量
        
- 当函数调用时，栈会**压入栈帧**，方法返回时栈帧释放，内存自动管理。
    
- 注意：
    
    - 如果值类型是**嵌套在引用类型中**（比如一个class里包含struct成员），它还是会存到托管堆上喵~
        

---

### 3️⃣ **方法区 / 元数据区（Method Table / Metadata）：**

- 存放**类型信息**（类、接口、方法签名、字段信息等），是CLR用于管理类型的核心区域。
    
- 类的**静态变量**、**vtable（虚方法表）**也存在这里。
    
- 这个区域跟Java的“方法区”类似，是支持反射的基础喵。
    

---

### 4️⃣ **代码区（JIT Code Cache）：**

- C#代码先被编译成**IL中间语言**，运行时由JIT（即时编译器）转换为机器码。
    
- 这些机器码被放到**代码段**，属于内存的**只读执行区域**，不同实例共享一份代码喵。
    

---

### 5️⃣ **常量池 / 字符串池（String Intern Pool）：**

- 字符串字面量会被放进**字符串驻留池（intern pool）**，整个程序运行时只会有一份副本。
    
- 类似的，还有**静态常量（const）**，它们会被编译时直接嵌入IL代码，不单独占用空间喵。




# 特征码

## ✨什么是AOB的“特征码”喵？

AOB = Array of Bytes（字节数组）喵。

在程序的**内存中**，所有代码和数据最终都会以“字节”的形式存在，比如某一段汇编指令会被编译成一串机器码，也就是一串字节（16进制的形式）喵～

比如这段汇编代码：

```asm
mov eax, [0045F3A0]
mov [ebp-4], eax
```

```asm
A1 A0 F3 45 00 89 45 FC

```


这个就是所谓的**字节数组（AOB）**，它就是那段汇编代码在内存中的真实形态喵！

---

## 🧠为什么叫“特征码”喵？

这个字节数组，有时候我们称它为**特征码（signature）**，因为它代表了一段代码的“特征”喵。

有的字节是**固定的**，比如操作码、寄存器之类的；  
有的字节是**不固定的**，比如涉及地址、偏移等动态数据。

所以我们可以写成“带通配符”的特征码，比如：

```asm
A1 ?? ?? ?? ?? 89 45 FC
```
`??`表示“任意字节”，这种写法就更灵活了喵～


- CE 会在整个内存空间中去找那段特征码；
    
- 即使地址变了，只要**字节模式**还在，就能找到！