

# å‚è€ƒé“¾æ¥




[åœ¨Unityä¸­ä½¿ç”¨æ¸¸æˆç¼–ç¨‹æ¨¡å¼æ¥æå‡ä½ çš„ä»£ç ](https://zhuanlan.zhihu.com/p/717871981)








# SOLIDè®¾è®¡åŸåˆ™

## å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principle, SRPï¼‰


ä¸€ä¸ªç±»åº”è¯¥**åªæœ‰ä¸€ä¸ªåŸå› å¯ä»¥å¼•èµ·å®ƒçš„å˜åŒ–**ã€‚

**âŒ è¿å SRP çš„ä¾‹å­**ï¼ˆä¸€ä¸ª `Report` ç±»è´Ÿè´£**æ•°æ®å¤„ç†å’Œæ–‡ä»¶å†™å…¥**ï¼‰ï¼š

```c#
public class Report
{
    public void GenerateReport() { Console.WriteLine("ç”ŸæˆæŠ¥å‘Š"); }
    public void SaveToFile() { Console.WriteLine("ä¿å­˜åˆ°æ–‡ä»¶"); }
}
```


```c#
public class ReportGenerator
{
    public void Generate() { Console.WriteLine("ç”ŸæˆæŠ¥å‘Š"); }
}

public class ReportSaver
{
    public void Save(string filePath) { Console.WriteLine($"ä¿å­˜åˆ° {filePath}"); }
}

```





## å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOpen/Closed Principle, OCPï¼‰

**åŸåˆ™**ï¼š**å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­**ã€‚å³**å¯ä»¥æ‰©å±•åŠŸèƒ½ï¼Œä½†ä¸è¦ä¿®æ”¹å·²æœ‰ä»£ç **ã€‚


âŒ è¿å OCPï¼ˆæ¯æ¬¡å¢åŠ æ–°å½¢çŠ¶ï¼Œéƒ½è¦ä¿®æ”¹ `AreaCalculator`ï¼‰
```c#
public class AreaCalculator
{
    public double CalculateArea(object shape)
    {
        if (shape is Circle circle) return Math.PI * circle.Radius * circle.Radius;
        if (shape is Rectangle rect) return rect.Width * rect.Height;
        return 0;
    }
}

```



ğŸ‘‰ **æ–°å½¢çŠ¶åªéœ€å®ç° `IShape`ï¼Œæ— éœ€ä¿®æ”¹ `AreaCalculator`ï¼Œç¬¦åˆ OCP**ã€‚
```c#
public interface IShape { double GetArea(); }

public class Circle : IShape
{
    public double Radius { get; set; }
    public double GetArea() => Math.PI * Radius * Radius;
}

public class Rectangle : IShape
{
    public double Width { get; set; }
    public double Height { get; set; }
    public double GetArea() => Width * Height;
}

public class AreaCalculator
{
    public double CalculateArea(IShape shape) => shape.GetArea();
}

```





## é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principle, LSPï¼‰

**åŸåˆ™**ï¼šå­ç±»å¿…é¡»**å®Œå…¨å’Œå®‰å…¨**æ›¿æ¢çˆ¶ç±»ï¼Œè€Œä¸å‘ç”Ÿæ„æ–™ä¹‹å¤–çš„æƒ…å†µã€‚


âŒ è¿å LSPï¼ˆ`Penguin` ä¸èƒ½é£ï¼Œä½†ç»§æ‰¿ `Bird`ï¼Œå¯¼è‡´ `Fly()` æ–¹æ³•æ— æ„ä¹‰ï¼‰

```c#
public class Bird
{
    public virtual void Fly() { Console.WriteLine("é¸Ÿåœ¨é£ç¿”"); }
}

public class Sparrow : Bird { } // å¯ä»¥é£

public class Penguin : Bird
{
    public override void Fly() { throw new Exception("ä¼é¹…ä¸ä¼šé£"); } // âŒ è¿èƒŒ LSP
}

```


âœ… éµå®ˆ LSPï¼ˆæŠ½è±¡å‡º `IFlyingBird` å’Œ `INonFlyingBird`ï¼‰
```c#
public interface IFlyingBird { void Fly(); }
public interface INonFlyingBird { }

public class Sparrow : IFlyingBird
{
    public void Fly() { Console.WriteLine("éº»é›€åœ¨é£ç¿”"); }
}

public class Penguin : INonFlyingBird { } // ä¼é¹…ä¸å®ç° `Fly`

```




## æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principle, ISPï¼‰

**åŸåˆ™**ï¼š**ä¸å¼ºè¿«ç±»å®ç°å®ƒä¸éœ€è¦çš„æ¥å£**ï¼Œå³é¿å…**å¤§è€Œå…¨çš„æ¥å£**ã€‚


âŒ è¿å ISPï¼ˆæ‰€æœ‰åŠ¨ç‰©éƒ½å¿…é¡»å®ç° `Swim`ï¼Œä½†ç‹—ä¸ä¼šæ¸¸æ³³ï¼‰

```c#
public interface IAnimal
{
    void Run();
    void Swim(); // âŒ ç‹—ä¸ä¼šæ¸¸æ³³ï¼Œä½†è¢«å¼ºåˆ¶å®ç°
}

public class Dog : IAnimal
{
    public void Run() { Console.WriteLine("ç‹—åœ¨è·‘"); }
    public void Swim() { throw new Exception("ç‹—ä¸ä¼šæ¸¸æ³³"); } // âŒ è¿èƒŒ ISP
}

```

âœ… éµå®ˆ ISPï¼ˆæ‹†åˆ† `IAnimal` ä¸ºå¤šä¸ªå°æ¥å£ï¼‰

```c#
public interface IRunnable { void Run(); }
public interface ISwimmable { void Swim(); }

public class Dog : IRunnable
{
    public void Run() { Console.WriteLine("ç‹—åœ¨è·‘"); }
}
public class Fish : ISwimmable
{
    public void Swim() { Console.WriteLine("é±¼åœ¨æ¸¸æ³³"); }
}

```
ğŸ‘‰ **æ¥å£æ‹†åˆ†ï¼Œä½¿å¾—ç±»**åªéœ€å®ç°**è‡ªå·±éœ€è¦çš„åŠŸèƒ½ï¼Œé¿å…å†—ä½™ä»£ç ã€‚**





C# å®˜æ–¹çš„ `IList<T>` å°±æ˜¯ä¸€ä¸ª**è¿å ISP çš„å…¸å‹ä¾‹å­**ï¼Œå› ä¸ºå®ƒç»§æ‰¿è‡ª `ICollection<T>` å’Œ `IEnumerable<T>`ï¼Œä½†å…¶ä¸­çš„æ–¹æ³•**å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µ**ï¼Œå¯¼è‡´ä¸€äº›æ•°æ®ç»“æ„å¿…é¡»å®ç°ä¸å¿…è¦çš„æ–¹æ³•ã€‚



```c#
using System;
using System.Collections.Generic;

class Program
{
    private static void AddToList(IList<int> list)
    {
        list.Add(1);  // è¿™é‡Œå‡è®¾ list èƒ½å¤Ÿæ·»åŠ å…ƒç´ 
    }

    static void Main(string[] args)
    {
        var list = new List<int>();
        AddToList(list);  // âœ… List<int> å¯ä»¥ä½œä¸º IList<int> ä¼ é€’

        var array = new int[5]; 
        AddToList(array); // âŒ æŠ›å‡ºå¼‚å¸¸

        Console.ReadKey();
    }
}

```

å› ä¸ºæ•°ç»„æ˜¯ä¸€ä¸ªä¸å¯ä»¥å˜é•¿åº¦çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥è™½ç„¶å®ƒå®ç°äº†IListæ¥å£ï¼Œä½†æ˜¯å†…éƒ¨åœ¨Addä¸­æŠ›å‡ºå¼‚å¸¸äº†ã€‚

```c#
int IList.Add(object value)
{
throw new NotsupportedException(Environment,GetResourcestring("Notsupported Fixedsizecollection")):
}
```


åœ¨ C# ä¸­ï¼Œ`æ•°ç»„ï¼ˆint[]ï¼‰` **ç¡®å®å®ç°äº†** `IList<int>`ï¼Œä½†å®ƒ**ä¸æ”¯æŒæ·»åŠ å’Œåˆ é™¤æ“ä½œ**ï¼Œå› ä¸ºæ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥c#å®˜æ–¹å¼ºè¿«æ•°ç»„å®ç°äº†å®ƒä¸åº”è¯¥å®ç°çš„æ¥å£ï¼Œè¿åäº†æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰



## ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principle, DIPï¼‰


**åŸåˆ™**ï¼š

1. **é«˜å±‚æ¨¡å—ï¼ˆå¦‚ `Game` ç±»ï¼‰ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆå¦‚ `Bow`ã€`Sword`ï¼‰ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡**ã€‚
2. **ç»†èŠ‚ï¼ˆå…·ä½“å®ç°ï¼‰åº”è¯¥ä¾èµ–æŠ½è±¡ï¼ˆæ¥å£ï¼‰ï¼Œè€Œä¸æ˜¯ç›¸å**ã€‚


ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰è¯´ç™½äº†å°±æ˜¯ä¸å»ºè®®è®©ç±»å»è‡ªå·±ç”Ÿæˆå…¶å®ƒç±»çš„å¯¹è±¡ï¼Œå¯¼è‡´äº†é«˜è€¦åˆã€‚è€Œæ˜¯åº”è¯¥ä¼ è¿›æ¥å…¶å®ƒç±»çš„å®ç°äº†æ‰€éœ€æ¥å£çš„å¯¹è±¡ã€‚

- ä¾èµ–æ³¨å…¥å°±æ˜¯æŒ‡ç›´æ¥ç”±å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªå¯¹è±¡åˆ°æ„é€ å‡½æ•°é‡Œé¢ï¼Œé¿å…ç±»å†…éƒ¨åˆ›å»ºæ‰€éœ€çš„å¯¹è±¡ã€‚
- ä¾èµ–æ³¨å…¥æ˜¯å®ç°ä¾èµ–å€’ç½®åŸåˆ™çš„ä¸€ç§æ–¹æ³•ã€‚



âŒ åä¾‹ï¼šè¿å DIP
æ¸¸æˆè§’è‰²ä¾èµ–å…·ä½“æ­¦å™¨ç±»

```c#
public class Sword
{
    public void Attack() { Console.WriteLine("æŒ¥èˆå‰‘æ”»å‡»ï¼"); }
}

public class Archer
{
    private Sword _sword = new Sword(); // âŒ ç›´æ¥ä¾èµ–å…·ä½“å®ç°

    public void Attack()
    {
        _sword.Attack();
    }
}

```



```c#
public interface IWeapon
{
    void Attack();
}

public class Sword : IWeapon
{
    public void Attack() { Console.WriteLine("æŒ¥èˆå‰‘æ”»å‡»ï¼"); }
}

public class Bow : IWeapon
{
    public void Attack() { Console.WriteLine("å°„ç®­æ”»å‡»ï¼"); }
}

public class Archer
{
    private IWeapon _weapon; // âœ… ä¾èµ–æŠ½è±¡ï¼Œä¸ä¾èµ–å…·ä½“å®ç°

    public Archer(IWeapon weapon) // âœ… é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    {
        _weapon = weapon;
    }

    public void Attack()
    {
        _weapon.Attack();
    }
}

```



# å…¶å®ƒè®¾è®¡åŸåˆ™


## DRYåŸåˆ™

DRYï¼ˆDon't Repeat Yourselfï¼‰åŸåˆ™æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘åŸåˆ™ï¼Œæ—¨åœ¨å‡å°‘ä»£ç é‡å¤ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**åŒä¸€éƒ¨åˆ†çš„çŸ¥è¯†æˆ–é€»è¾‘åœ¨ä»£ç ä¸­ä¸åº”è¯¥é‡å¤ï¼Œè€Œåº”è¯¥è¢«æŠ½è±¡æˆä¸€ä¸ªå•ä¸€çš„ã€å¯å¤ç”¨çš„æ¨¡å—**ã€‚


è¿å DRY åŸåˆ™

```c#
Console.WriteLine("User 1: John Doe, Age: 30");
Console.WriteLine("User 2: Jane Doe, Age: 25");
Console.WriteLine("User 3: Alice, Age: 28");
```

éµå¾ª DRY åŸåˆ™
```c#

void PrintUser(string name, int age)
{
    Console.WriteLine($"User: {name}, Age: {age}");
}
PrintUser("John Doe", 30);
PrintUser("Jane Doe", 25);
PrintUser("Alice", 28);
```



 **DRY vs WET**

- **DRYï¼ˆDon't Repeat Yourselfï¼‰**ï¼šé¿å…é‡å¤ï¼Œæå€¡æŠ½è±¡å’Œå°è£…ã€‚
- **WETï¼ˆWrite Everything Twice æˆ– We Enjoy Typingï¼‰**ï¼šä»£ç ä¸­å­˜åœ¨å¤§é‡é‡å¤é€»è¾‘ï¼Œå¯¼è‡´ç»´æŠ¤å›°éš¾ã€‚

## é­”æ³•æ•°å­—ï¼ˆMagic Numberï¼‰åæ¨¡å¼


**é­”æ³•æ•°å­—ï¼ˆMagic Numberï¼‰åæ¨¡å¼** æŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨**æ²¡æœ‰æ˜ç¡®æ„ä¹‰çš„æ•°å€¼å¸¸é‡**ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…·æœ‰æè¿°æ€§çš„å˜é‡æˆ–å¸¸é‡åç§°ã€‚è¿™ç§åšæ³•ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ï¼Œå¹¶å¯èƒ½å¯¼è‡´éš¾ä»¥ç†è§£çš„é€»è¾‘é”™è¯¯ã€‚

âŒ è¿åé­”æ³•æ•°å­—åæ¨¡å¼çš„ä¾‹å­

```c#
double CalculateCircleArea(double radius)
{
    return 3.14159 * radius * radius;  // è¿™é‡Œçš„ 3.14159 æ˜¯é­”æ³•æ•°å­—
}

```


âœ… éµå¾ªæœ€ä½³å®è·µ

```c#
const double PI = 3.14159;

double CalculateCircleArea(double radius)
{
    return PI * radius * radius;  // ç°åœ¨ä»£ç å¯è¯»æ€§æ›´é«˜
}

```



## ä»€ä¹ˆæ˜¯æ„å¤§åˆ©é¢ä»£ç ï¼Ÿï¼ˆSpaghetti Codeï¼‰

**Spaghetti Codeï¼ˆé¢æ¡ä»£ç ï¼‰** æ˜¯ç”¨æ¥å½¢å®¹**æ··ä¹±ã€æ— ç»“æ„çš„ä»£ç **ï¼Œå› ä¸ºè¿™ç§ä»£ç çš„é€»è¾‘åƒæ„å¤§åˆ©é¢æ¡ä¸€æ ·çº ç¼ åœ¨ä¸€èµ·ï¼Œéš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚å› æ­¤ï¼Œç¨‹åºå‘˜ç”¨ **"Spaghetti Code"** æ¥æ¯”å–»â€œæ‚ä¹±æ— ç« çš„ä»£ç ç»“æ„â€ã€‚

### ** é¢æ¡ä»£ç çš„å…¸å‹ç‰¹å¾**

1. **æ²¡æœ‰ç»“æ„åŒ–è®¾è®¡**
    - ä»£ç ç¼ºä¹æ¸…æ™°çš„å±‚æ¬¡ç»“æ„ï¼Œæ²¡æœ‰éµå¾ªè‰¯å¥½çš„è®¾è®¡æ¨¡å¼ã€‚
2. **å¤§é‡å…¨å±€å˜é‡**
    - ä¾èµ–å¤šä¸ªå…¨å±€å˜é‡ï¼Œå¯¼è‡´ä¸åŒå‡½æ•°ä¹‹é—´ç›¸äº’å½±å“ï¼Œéš¾ä»¥è·Ÿè¸ªæ•°æ®å˜åŒ–ã€‚
3. **è¿‡é•¿çš„æ–¹æ³•å’Œç±»**
    - ä¸€ä¸ªæ–¹æ³•å¯èƒ½åŒ…å«æ•°ç™¾è¡Œä»£ç ï¼Œæ²¡æœ‰åˆç†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼Œä½¿å¾—ä»£ç éš¾ä»¥é˜…è¯»å’Œè°ƒè¯•ã€‚
4. **ç¼ºä¹æ³¨é‡Šå’Œæ–‡æ¡£**
    - ä»£ç é€»è¾‘å¤æ‚ä¸”æ²¡æœ‰æ³¨é‡Šï¼Œå³ä½¿æ˜¯åŸä½œè€…ï¼Œè¿‡ä¸€æ®µæ—¶é—´åä¹Ÿå¯èƒ½æ— æ³•ç†è§£ä»£ç çš„æ„å›¾ã€‚
5. **è¿‡å¤šçš„ if/else å’ŒåµŒå¥—å¾ªç¯**
    - é€»è¾‘æ§åˆ¶æ··ä¹±ï¼Œæ·±å±‚åµŒå¥—å¯¼è‡´ä»£ç å¯è¯»æ€§æå·®ã€‚
6. **é‡å¤ä»£ç **
    - æ²¡æœ‰éµå¾ª **DRYï¼ˆDon't Repeat Yourselfï¼‰** åŸåˆ™ï¼Œå¯¼è‡´åŒæ ·çš„é€»è¾‘åœ¨å¤šä¸ªåœ°æ–¹é‡å¤å‡ºç°ï¼Œç»´æŠ¤æ—¶éœ€è¦ä¿®æ”¹å¤šä¸ªåœ°æ–¹ã€‚


âŒ è¿åæœ€ä½³å®è·µçš„é¢æ¡ä»£ç ç¤ºä¾‹
```c#
void ProcessOrder(string orderType, int quantity)
{
    if (orderType == "A")
    {
        if (quantity > 10)
        {
            Console.WriteLine("Large order for type A");
        }
        else
        {
            Console.WriteLine("Small order for type A");
        }
    }
    else if (orderType == "B")
    {
        if (quantity > 10)
        {
            Console.WriteLine("Large order for type B");
        }
        else
        {
            Console.WriteLine("Small order for type B");
        }
    }
    else if (orderType == "C")
    {
        if (quantity > 10)
        {
            Console.WriteLine("Large order for type C");
        }
        else
        {
            Console.WriteLine("Small order for type C");
        }
    }
}

```


âœ… é‡‡ç”¨è‰¯å¥½å®è·µä¼˜åŒ–é¢æ¡ä»£ç 

```c#
void ProcessOrder(string orderType, int quantity)
{
    string size = quantity > 10 ? "Large" : "Small";
    Console.WriteLine($"{size} order for type {orderType}");
}
```








# åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰

åˆ›å»ºå‹æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯**æ§åˆ¶å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹**ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿæ›´åŠ çµæ´»ã€å¯æ‰©å±•ï¼Œé¿å…ç›´æ¥ä½¿ç”¨ `new` å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡ã€‚å®ƒå°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹æŠ½è±¡åŒ–ï¼Œå¹¶å°†å…¶ä¸å®¢æˆ·ç«¯ä»£ç åˆ†ç¦»ã€‚


## å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰

### ç®€å•å·¥å‚æ¨¡å¼ ï¼ˆSimple Factoryï¼‰

ä¸€ä¸ªå·¥å‚è´Ÿè´£ç”Ÿæˆæ‰€æœ‰äº§å“

- **è¿åå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ï¼šæ¯æ¬¡æ–°å¢äº§å“ï¼Œéƒ½è¦ä¿®æ”¹å·¥å‚çš„ `switch` æˆ– `if-else` è¯­å¥ã€‚
- **å•ä¸€å·¥å‚ç±»å¯èƒ½å˜å¾—è‡ƒè‚¿**ï¼Œå¦‚æœäº§å“è¶Šæ¥è¶Šå¤šï¼Œç»´æŠ¤å›°éš¾ã€‚

```c#
public interface IEnemy { void Attack(); }

public class Goblin : IEnemy { public void Attack() => Debug.Log("Goblin Attack!"); }
public class Orc : IEnemy { public void Attack() => Debug.Log("Orc Attack!"); }

public class SimpleEnemyFactory
{
    public static IEnemy CreateEnemy(string type)
    {
        switch (type)
        {
            case "Goblin": return new Goblin();
            case "Orc": return new Orc();
            default: throw new ArgumentException("Invalid type");
        }
    }
}

// å®¢æˆ·ç«¯è°ƒç”¨ï¼š
IEnemy enemy = SimpleEnemyFactory.CreateEnemy("Goblin");
enemy.Attack();

```

### å·¥å‚æ¨¡å¼ï¼ˆFactory Methodï¼‰

æ¯ä¸ªå·¥å‚ç”Ÿäº§è‡ªå·±çš„äº§å“

- æ¯ä¸ªäº§å“æœ‰**è‡ªå·±çš„å·¥å‚**ï¼Œé¿å…äº† `switch` è¯­å¥ã€‚
- **é€‚ç”¨äºå¯¹è±¡ç±»å‹è¾ƒå¤šçš„æƒ…å†µ**ï¼Œç¬¦åˆ**å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ã€‚
- **ä½†ç±»çš„æ•°é‡å¢åŠ **ï¼Œæ¯æ–°å¢ä¸€ä¸ªäº§å“ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥å‚ç±»ã€‚


```c#
// äº§å“æ¥å£
public interface IEnemy { void Attack(); }

// å…·ä½“äº§å“
public class Goblin : IEnemy { public void Attack() => Debug.Log("Goblin Attack!"); }
public class Orc : IEnemy { public void Attack() => Debug.Log("Orc Attack!"); }

// æŠ½è±¡å·¥å‚
public abstract class EnemyFactory { public abstract IEnemy CreateEnemy(); }

// å…·ä½“å·¥å‚ï¼ˆæ¯ä¸ªå·¥å‚åˆ›å»ºä¸€ç§æ•Œäººï¼‰
public class GoblinFactory : EnemyFactory { public override IEnemy CreateEnemy() => new Goblin(); }
public class OrcFactory : EnemyFactory { public override IEnemy CreateEnemy() => new Orc(); }

// å®¢æˆ·ç«¯ä»£ç ï¼š
EnemyFactory factory = new GoblinFactory();
IEnemy enemy = factory.CreateEnemy();
enemy.Attack();
```



## æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰

ä¸€ä¸ªå·¥å‚å¯ä»¥ç”Ÿäº§å¤šä¸ªäº§å“ï¼Œè¿™äº›äº§å“ä¹Ÿæœ‰ä¸€å®šçš„è”ç³»ï¼Œä¹Ÿå°±æ˜¯äº§å“æ—ã€‚


```c#
// äº§å“æ¥å£
public interface IWeapon { void Attack(); }
public interface IArmor { void Defend(); }

// å…·ä½“äº§å“ï¼ˆç²¾çµæ—è£…å¤‡ï¼‰
public class ElfWeapon : IWeapon { public void Attack() => Debug.Log("Elf Weapon Attack!"); }
public class ElfArmor : IArmor { public void Defend() => Debug.Log("Elf Armor Defense!"); }

// å…·ä½“äº§å“ï¼ˆå…½äººæ—è£…å¤‡ï¼‰
public class OrcWeapon : IWeapon { public void Attack() => Debug.Log("Orc Weapon Attack!"); }
public class OrcArmor : IArmor { public void Defend() => Debug.Log("Orc Armor Defense!"); }

// æŠ½è±¡å·¥å‚ï¼ˆå®šä¹‰äº§å“æ—ï¼‰
public abstract class EquipmentFactory
{
    public abstract IWeapon CreateWeapon();
    public abstract IArmor CreateArmor();
}

// å…·ä½“å·¥å‚ï¼ˆç²¾çµæ—å·¥å‚ï¼‰
public class ElfEquipmentFactory : EquipmentFactory
{
    public override IWeapon CreateWeapon() => new ElfWeapon();
    public override IArmor CreateArmor() => new ElfArmor();
}

// å…·ä½“å·¥å‚ï¼ˆå…½äººæ—å·¥å‚ï¼‰
public class OrcEquipmentFactory : EquipmentFactory
{
    public override IWeapon CreateWeapon() => new OrcWeapon();
    public override IArmor CreateArmor() => new OrcArmor();
}

// å®¢æˆ·ç«¯ä»£ç 
EquipmentFactory factory = new ElfEquipmentFactory();
IWeapon weapon = factory.CreateWeapon();
IArmor armor = factory.CreateArmor();
weapon.Attack();
armor.Defend();

```


## å»ºé€ è€…ï¼ˆBuilderï¼‰

å…è®¸**åˆ†æ­¥éª¤åˆ›å»ºå¤æ‚å¯¹è±¡**ï¼Œå¹¶å…è®¸æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹ç”Ÿäº§ä¸åŒçš„å¯¹è±¡ã€‚è¿™ä¸ªåœ¨node drawä¸­ç”¨çš„å¾ˆå¤šï¼Œä¸»è¦ä¸ºäº†è®©æ„é€ å‡½æ•°è¿‡äºå¤æ‚ã€‚æœ‰äº›å¯¹è±¡çš„æŸäº›å±æ€§å¯ä»¥ç¼ºçœï¼Œæœ‰äº›ä¸å¯ä»¥ã€‚è‹¥ç”¨æ„é€ å‡½æ•°é‡è½½å¯èƒ½ä¼šå¤æ‚åº¦çˆ†ç‚¸ã€‚

```c#

//ä¼ ç»Ÿæ¨¡å¼
public class Character
{
    public string Name;
    public int Health;
    public int Attack;
    public int Defense;

    public Character(string name, int health, int attack, int defense)
    {
        Name = name;
        Health = health;
        Attack = attack;
        Defense = defense;
    }
}

// åˆ›å»ºè§’è‰²
Character hero = new Character("Warrior", 100, 50, 30);

```



```c#
public class Character
{
    public string Name;
    public int Health;
    public int Attack;
    public int Defense;

    public Character SetName(string name) { this.Name = name; return this; }
    public Character SetHealth(int health) { this.Health = health; return this; }
    public Character SetAttack(int attack) { this.Attack = attack; return this; }
    public Character SetDefense(int defense) { this.Defense = defense; return this; }

    public void ShowInfo()
    {
        Debug.Log($"è§’è‰²ï¼š{Name} | ç”Ÿå‘½ï¼š{Health} | æ”»å‡»ï¼š{Attack} | é˜²å¾¡ï¼š{Defense}");
    }
}

// è¿™æ ·åˆ›å»ºè§’è‰²æ›´åŠ ç›´è§‚ï¼š
Character warrior = new Character()
    .SetName("Warrior")
    .SetHealth(100)
    .SetAttack(50)
    .SetDefense(30);
    
warrior.ShowInfo();
```



## å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰




ç”¨æ¥å¤„ç†DontDestroyOnLoad

```c#
public class GameManager : MonoBehaviour
{
	private static GameManager _instance;   // å•ä¾‹
	public GameManager GameManagerInstance
    {
        get { return _instance; }
    }
    void Awake()
    {
        if (_instance != null)
        {
        	//è¿™é‡Œä¸€å®šè¦æ˜¯é”€æ¯this.gameObject
            Destroy(this.gameObject);
            return;
        }
        //è¿™å¥è¯åªæ‰§è¡Œä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡ä¸Šé¢returnäº†
        _instance = this;
    }
}

```



ä¸ç»§æ‰¿monoçš„

```c#
public class Test 
{


    private static Test _instance;
    //å•ä¾‹æ¨¡å¼
    public static Test Instance
    {
        get
         {
            if (_instance == null) {
                _instance = new Test();
            }
            return _instance;

        }
    }
}
```



ç»§æ‰¿monoçš„

```c#
public class UIController:MonoBehaviour
{

    public static UIController Instance;
 

    private void Awake()
    {
        Instance = this;
    }

    public void changeRestBalls()
    {

    }
}
```

è™½ç„¶ç›´æ¥åœ¨awakeä¸­å†™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚é‚£å°±æ˜¯awakeçš„è°ƒç”¨é¡ºåºæ˜¯ä¸ä¸€å®šçš„ï¼Œåœ¨è„šæœ¬ä¸­ï¼Œå¦‚æœawakeæ—¶å‡ºç°äº†å•ä¾‹äº’ç›¸è°ƒç”¨çš„æƒ…å†µï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å…¶ä»–çš„å•ä¾‹è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå› æ­¤å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œæ”¹è¿›ã€‚



```c#
static Test instance;
public static Test Instance
{
    get
    {
        if(instance == null)
        {
            instance = FindObjectOfType<Test>();
           
        }
         return instance;
    }
}
```




## åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰

**åŸå‹æ¨¡å¼** æ˜¯ä¸€ç§**åˆ›å»ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**å…‹éš†ï¼ˆå¤åˆ¶ï¼‰å¯¹è±¡**ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½ `new` ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚  
å½“å¯¹è±¡çš„åˆ›å»ºæˆæœ¬è¾ƒé«˜ï¼Œæˆ–è€…éœ€è¦å¤§é‡ç›¸ä¼¼çš„å¯¹è±¡æ—¶ï¼ŒåŸå‹æ¨¡å¼èƒ½æé«˜æ€§èƒ½å¹¶å‡å°‘é‡å¤ä»£ç ã€‚

Unity æä¾›çš„ **`Instantiate`** æ–¹æ³•æœ¬è´¨ä¸Šå°±æ˜¯**åŸå‹æ¨¡å¼**çš„å®ç°ï¼š
 

```c#
using System;
using UnityEngine;

// 1. å®šä¹‰åŸå‹æ¥å£
public interface IPrototype<T>
{
    T Clone(); // å…‹éš†æ–¹æ³•
}

// 2. å…·ä½“åŸå‹ç±»
[Serializable] // è®© Unity èƒ½åºåˆ—åŒ–
public class Enemy : IPrototype<Enemy>
{
    public string Name;
    public int Health;
    public float Speed;

    public Enemy(string name, int health, float speed)
    {
        Name = name;
        Health = health;
        Speed = speed;
    }

    // 3. å®ç°å…‹éš†æ–¹æ³•ï¼ˆæµ…æ‹·è´ï¼‰
    public Enemy Clone()
    {
        return (Enemy)this.MemberwiseClone();
    }

    public void ShowInfo()
    {
        Debug.Log($"Enemy: {Name}, HP: {Health}, Speed: {Speed}");
    }
}

// 4. å®¢æˆ·ç«¯ä»£ç 
public class GameManager : MonoBehaviour
{
    void Start()
    {
        // åˆ›å»ºåŸå‹å¯¹è±¡
        Enemy originalEnemy = new Enemy("Orc", 100, 2.5f);
        originalEnemy.ShowInfo();

        // å…‹éš†æ•Œäºº
        Enemy clonedEnemy = originalEnemy.Clone();
        clonedEnemy.Name = "Goblin"; // ä¿®æ”¹å…‹éš†ä½“çš„å±æ€§
        clonedEnemy.Health = 50;
        clonedEnemy.ShowInfo();
    }
}
```



# ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰

ç»“æ„å‹æ¨¡å¼ä¸»è¦è§£å†³**ç±»æˆ–å¯¹è±¡ä¹‹é—´çš„å…³ç³»**ï¼Œå¦‚ä½•é€šè¿‡ç»„åˆå’Œç»§æ‰¿æ¥æ„å»ºæ›´å¤§çš„ç»“æ„ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†å°çš„æ¨¡å—ç»„åˆæˆæ›´å¤æ‚çš„ç»“æ„ï¼Œä»è€Œè®©ç³»ç»Ÿæ›´åŠ çµæ´»ä¸”æ˜“äºç»´æŠ¤ã€‚






## é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰

å‡è®¾ä½ æ­£åœ¨åˆ¶ä½œä¸€æ¬¾æ¸¸æˆï¼Œè€ç‰ˆæœ¬çš„æ•Œäºº `OldEnemy` ä½¿ç”¨ `AttackOld()`ï¼Œä½†æ–°ç‰ˆç³»ç»Ÿè¦æ±‚æ‰€æœ‰æ•Œäººéƒ½ä½¿ç”¨ `IAttack.Attack()`ã€‚

**ğŸ›‘ é—®é¢˜ï¼š** ä¸èƒ½ä¿®æ”¹ `OldEnemy`ï¼Œä½†ä½ ä»ç„¶å¸Œæœ›å®ƒèƒ½åœ¨æ–°ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚

æˆ–è€…å•çº¯é€‚é…å„ä¸ªapi

- æœ¬è´¨ä¸Šå°±æ˜¯æä¸€ä¸ªæ–°é€šç”¨çš„æ¥å£ï¼Œè®©ä¸€ä¸ªè£…é¥°å™¨ç±»å®ç°è¿™ä¸ªæ¥å£ã€‚ç„¶åï¼ŒæŠŠå…¶å®ƒéœ€è¦é€‚é…çš„å¯¹è±¡ä¼ åˆ°è£…é¥°å™¨ç±»çš„æ„é€ å‡½æ•°é‡Œé¢å°±å®Œäº‹äº†ã€‚
- aiä¸­ç”¨çš„å¾ˆå¤š

æ³¨æ„ï¼Œåœ¨ä½ è‡ªå·±å†™ä»£ç çš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨é€‚é…å™¨ï¼ä¸è¦ä½¿ç”¨é€‚é…å™¨ï¼
æ²¡å¿…è¦è‡ªå·±ç»™è‡ªå·±ä¸Šéš¾åº¦ã€‚åªæœ‰åœ¨è¿«ä¸å¾—å·²å»ç»Ÿä¸€ä¸€ä¸ªæ¥å£çš„æ—¶å€™æ‰éœ€è¦è¿™ä¸ªæ¨¡å¼ã€‚å°±æ¯”å¦‚koishiæ¡†æ¶ï¼Œä¸ºäº†å…¼å®¹qqå’Œé£ä¹¦ç­‰å¹³å°çš„æœºå™¨äººå°±ç”¨äº†é€‚é…å™¨ã€‚ä¸åŒå¹³å°çš„æœºå™¨äººapiå’Œè°ƒç”¨è‚¯å®šä¸ä¸€æ ·ï¼Œä½†æ˜¯å¯¹å¤–çš„è¡¨ç°éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥éœ€è¦åšè£…é¥°å™¨ã€‚


```c#

// å®šä¹‰é€šç”¨çš„ AI æ¥å£
public interface IAIAdapter
{
    string GetResponse(string input);
}


// å‡è®¾ OpenAI çš„ API åªèƒ½é€šè¿‡ SendToOpenAI(string prompt) å‘é€è¯·æ±‚
public class OpenAI
{
    public string SendToOpenAI(string prompt)
    {
        return $"[OpenAI]: {prompt} çš„å›å¤";
    }
}

// OpenAI é€‚é…å™¨ï¼Œå®ç° IAIAdapter æ¥å£
public class OpenAIAdapter : IAIAdapter
{
    private OpenAI openAI;

    public OpenAIAdapter(OpenAI openAI)
    {
        this.openAI = openAI;
    }

    public string GetResponse(string input)
    {
        return openAI.SendToOpenAI(input);
    }
}






// Google AI éœ€è¦è°ƒç”¨ GoogleRequest(string query)
public class GoogleAI
{
    public string GoogleRequest(string query)
    {
        return $"[Google AI]: {query} çš„å›å¤";
    }
}

// Google AI é€‚é…å™¨
public class GoogleAIAdapter : IAIAdapter
{
    private GoogleAI googleAI;

    public GoogleAIAdapter(GoogleAI googleAI)
    {
        this.googleAI = googleAI;
    }

    public string GetResponse(string input)
    {
        return googleAI.GoogleRequest(input);
    }
}


```


å®¢æˆ·ç«¯ä»£ç 

```c#
public class AIManager
{
    private IAIAdapter aiAdapter;

    public AIManager(IAIAdapter aiAdapter)
    {
        this.aiAdapter = aiAdapter;
    }

    public void Chat(string input)
    {
        string response = aiAdapter.GetResponse(input);
        Debug.Log(response);
    }
}

// æµ‹è¯•ä»£ç 
public class Program
{
    public static void Main()
    {
        // ä½¿ç”¨ OpenAI
        IAIAdapter openAI = new OpenAIAdapter(new OpenAI());
        AIManager aiManager1 = new AIManager(openAI);
        aiManager1.Chat("ä½ å¥½");

        // ä½¿ç”¨ Google AI
        IAIAdapter googleAI = new GoogleAIAdapter(new GoogleAI());
        AIManager aiManager2 = new AIManager(googleAI);
        aiManager2.Chat("ä½ å¥½");
    }
}


```




## æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰


- **å°†ä¸åŒç»´åº¦çš„å˜åŒ–åˆ†ç¦»**ï¼Œé¿å…ç±»çš„å±‚çº§çˆ†ç‚¸ã€‚
- **ç”¨ç»„åˆä»£æ›¿ç»§æ‰¿**ï¼Œé™ä½è€¦åˆåº¦ï¼Œæé«˜çµæ´»æ€§ã€‚
- **é€‚ç”¨äºå¤šä¸ªç»´åº¦æ‰©å±•çš„å¯¹è±¡æ¨¡å‹**ã€‚
- æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ„é€ å‡½æ•°é‡Œé¢å¯ä»¥newä¸€äº›ç»„ä»¶è¿‡æ¥ï¼Œåœ¨åˆ›é€ æ—¶æ¥åŠ¨æ€æ„æˆè¿™ä¸ªå¯¹è±¡ã€‚





è¿˜æ˜¯ç»å…¸çš„ã€Šåˆæˆæ”¾ç½®å¤§ä¹±æ–—ã€‹ï¼Œå…ˆå¼€å§‹æä¸€ä¸ªå£«å…µæŠ½è±¡ç±»ï¼Œç„¶åæœ‰äº†å‰‘å£«ï¼Œé­”æ³•å¸ˆå’Œç‰§å¸ˆã€‚å‰‘å£«æ´¾ç”Ÿäº†éª‘å£«ï¼Œä½†æ˜¯ç°åœ¨å†å‡ºä¸€ä¸ªåŒ»é™¢éª‘å£«å°±éº»çƒ¦äº†ã€‚å› ä¸ºä¸èƒ½å¤šç»§æ‰¿ï¼Œåªèƒ½å¤šå†™ä¸€ä¸ªåŒ»é™¢éª‘å£«çš„ç±»ã€‚è€Œéª‘å£«ä¸è¿‡æ˜¯è®©å£«å…µçš„é€Ÿåº¦å˜åŒ–ã€‚é­”æ³•å¸ˆå’Œç‰§å¸ˆæœ¬è´¨ä¸Šæ˜¯è¿œç¨‹æ”»å‡»æ•Œäººæˆ–è‡ªå·±äººï¼ˆåªä¸è¿‡ç‰§å¸ˆçš„æ”»å‡»ä¼¤å®³æ˜¯è´Ÿæ•°ï¼‰



```c#
// å£«å…µåŸºç±»ï¼Œæ¡¥æ¥"ç§»åŠ¨æ–¹å¼"å’Œ"æ”»å‡»æ–¹å¼"
public abstract class Soldier
{
    protected IMovement movement;  // ç§»åŠ¨æ–¹å¼ï¼ˆæ­¥è¡Œã€éª‘é©¬ï¼‰
    protected IAttack attack;      // æ”»å‡»æ–¹å¼ï¼ˆè¿‘æˆ˜ã€è¿œç¨‹ã€æ²»ç–—ï¼‰

    public Soldier(IMovement movement, IAttack attack)
    {
        this.movement = movement;
        this.attack = attack;
    }

    public void Move() => movement.Move();
    public void Attack() => attack.Execute();
}


// ç§»åŠ¨æ–¹å¼æ¥å£ï¼ˆImplementor 1ï¼‰
public interface IMovement
{
    void Move();
}

// æ­¥è¡Œ
public class Walk : IMovement
{
    public void Move() => Debug.Log("æ­¥è¡Œå‰è¿›");
}

// éª‘é©¬
public class HorseRide : IMovement
{
    public void Move() => Debug.Log("éª‘é©¬å†²é”‹");
}




// æ”»å‡»æ–¹å¼æ¥å£ï¼ˆImplementor 2ï¼‰
public interface IAttack
{
    void Execute();
}

// è¿‘æˆ˜æ”»å‡»
public class MeleeAttack : IAttack
{
    public void Execute() => Debug.Log("è¿›è¡Œè¿‘æˆ˜æ”»å‡»ï¼");
}

// è¿œç¨‹é­”æ³•æ”»å‡»
public class MagicAttack : IAttack
{
    public void Execute() => Debug.Log("æ–½æ”¾è¿œç¨‹é­”æ³•ï¼");
}

// æ²»ç–—ï¼ˆè¿œç¨‹æ”»å‡»å·±æ–¹ï¼Œä¼¤å®³æ˜¯è´Ÿæ•°ï¼‰
public class HealAttack : IAttack
{
    public void Execute() => Debug.Log("é‡Šæ”¾æ²»ç–—æœ¯ï¼ï¼ˆæ”»å‡»è‡ªå·±äººï¼Œä¼¤å®³æ˜¯è´Ÿæ•°ï¼‰");
}



// å‰‘å£«ï¼ˆå¯ä»¥é€‰æ‹©ä»»æ„æ”»å‡»æ–¹å¼ï¼‰
public class Swordsman : Soldier
{
    public Swordsman(IMovement movement, IAttack attack) 
        : base(movement, attack) { }
}


```



```c#
public class Game
{
    public static void Main()
    {
        // å‰‘å£«ï¼ˆæ­¥è¡Œ + è¿‘æˆ˜ï¼‰
        Soldier swordsman = new Swordsman(new Walk(), new MeleeAttack());
        swordsman.Move();
        swordsman.Attack();

        // éª‘å£«ï¼ˆå‰‘å£« + éª‘é©¬ + è¿‘æˆ˜ï¼‰
        Soldier knight = new Swordsman(new HorseRide(), new MeleeAttack());
        knight.Move();
        knight.Attack();

        // é­”æ³•å‰‘å£«ï¼ˆå‰‘å£« + éª‘é©¬ + è¿œç¨‹é­”æ³•æ”»å‡»ï¼‰
        Soldier magicKnight = new Swordsman(new HorseRide(), new MagicAttack());
        magicKnight.Move();
        magicKnight.Attack();
    }
}
```





## ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰


- å½“é€»è¾‘çš„ç»“æ„æ˜¯æ ‘å½¢ç»“æ„çš„æ—¶å€™å¾ˆé€‚åˆç”¨ç»„åˆæ¨¡å¼ã€‚æ¯”å¦‚äººå£æ™®æŸ¥ï¼Œé¦–å…ˆéœ€è¦è°ƒç”¨å„ä¸ªä¹¡é•‡çš„ç»Ÿè®¡æ¥å£ï¼Œç„¶åæŠŠä¹¡é•‡ç»„åˆæˆçœå¸‚ï¼Œè°ƒç”¨çœå¸‚çš„æ¥å£ã€‚è€Œè¿™äº›ä¹¡é•‡å’Œçœå¸‚éƒ½æ˜¯å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‘çš„ã€‚æ¯ä¸ªæå¹²çš„æ¥å£éƒ½æ˜¯ä¸€æ ·çš„ã€‚
- å¯ä»¥è®©å•ä¸ªå¯¹è±¡å’Œå®¹å™¨ï¼ˆä¸€å †å¯¹è±¡ï¼‰ä½¿ç”¨ç›¸åŒçš„æ¥å£ï¼Œè®©â€œæ•´ä½“â€å’Œâ€œéƒ¨åˆ†â€å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼æ“ä½œã€‚


åœ¨è¿™é‡Œï¼Œä¸€ä¸ªæ™®é€šæ•Œäººå’Œå†›é˜Ÿï¼Œéƒ½æ‹¥æœ‰ç›¸åŒçš„attackæ¥å£ã€‚åœ¨è®¾è®¡æˆ˜æ–—çš„æ—¶å€™ï¼Œæˆ‘åªç”¨è€ƒè™‘å†›é˜Ÿçš„attackå³å¯ã€‚å†›é˜Ÿè´Ÿè´£å¤„ç†ä¸‹çº§å¶å­èŠ‚ç‚¹çš„attacké€»è¾‘ã€‚
```c#
// ç»„ä»¶åŸºç±»ï¼ˆç»„åˆæ¨¡å¼çš„æ ¸å¿ƒï¼‰
public abstract class Enemy
{
    public abstract void Attack();
}

// å¶å­èŠ‚ç‚¹ï¼ˆå•ä¸ªæ•Œäººï¼‰
public class Soldier : Enemy
{
    public override void Attack()
    {
        Debug.Log("å£«å…µå‘èµ·æ”»å‡»ï¼");
    }
}

// ç»„åˆèŠ‚ç‚¹ï¼ˆå¤šä¸ªæ•Œäººç»„æˆçš„é˜Ÿä¼ï¼‰
public class Army : Enemy
{
    private List<Enemy> enemies = new List<Enemy>();

    public void Add(Enemy enemy)
    {
        enemies.Add(enemy);
    }

    public void Remove(Enemy enemy)
    {
        enemies.Remove(enemy);
    }

    public override void Attack()
    {
        Debug.Log("å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼");
        foreach (var enemy in enemies)
        {
            enemy.Attack();
        }
    }
}

```



```c#
public static void Main()
{
    Soldier soldier1 = new Soldier();
    Soldier soldier2 = new Soldier();
    
    Army smallArmy = new Army();
    smallArmy.Add(soldier1);
    smallArmy.Add(soldier2);

    Army bigArmy = new Army();
    bigArmy.Add(smallArmy);
    bigArmy.Add(new Soldier());

    Debug.Log("å•ä¸ªå£«å…µæ”»å‡»ï¼š");
    soldier1.Attack();

    Debug.Log("å°å‹å†›é˜Ÿæ”»å‡»ï¼š");
    smallArmy.Attack();

    Debug.Log("å¤§å‹å†›å›¢æ”»å‡»ï¼š");
    bigArmy.Attack();
}

/*
å•ä¸ªå£«å…µæ”»å‡»ï¼š
å£«å…µå‘èµ·æ”»å‡»ï¼
å°å‹å†›é˜Ÿæ”»å‡»ï¼š
å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å¤§å‹å†›å›¢æ”»å‡»ï¼š
å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼
å†›é˜Ÿå¼€å§‹æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
å£«å…µå‘èµ·æ”»å‡»ï¼
*/
```







## è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰


- å’Œé€‚é…å™¨æ¨¡å¼æœ‰ç‚¹ç›¸ä¼¼ï¼Œéƒ½æ˜¯å¯¹æ¥å£è¿›è¡Œäº†åŒ…è£…
- ä½†æ˜¯**ç»„åˆå¤šä¸ªè£…é¥°å™¨**æ¥ä¸ºå¯¹è±¡å¢åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚ä¸€ä¸ªé€‚é…å™¨æ˜¯ä¸å¯ä»¥å†å ä¸€ä¸ªä¸€æ ·çš„é€‚é…å™¨çš„


```c#
// è§’è‰²æ¥å£
public interface ICharacter
{
    void Attack();
    int GetAttackPower();
}

// åŸºæœ¬è§’è‰²ç±»ï¼šæ”»å‡»åŠ›ä¸º 10
public class BasicCharacter : ICharacter
{
    private int attackPower = 10;

    public void Attack()
    {
        Debug.Log("è§’è‰²å‘åŠ¨æ”»å‡»ï¼");
    }

    public int GetAttackPower()
    {
        return attackPower;
    }
}

```


è£…é¥°å™¨åŸºç±»ï¼Œè£…é¥°å™¨ä¸€å®šæ˜¯å’Œè£…é¥°çš„ç‰©ä½“å®ç°åŒä¸€å¥—æ¥å£ï¼Œæ‰èƒ½ä¿è¯ç›¸åŒçš„apiã€‚è¦ä¸ç„¶è°ƒç”¨çš„apiä¸ä¸€æ ·å°±ç®—ä¸ä¸Šè£…é¥°å™¨äº†ã€‚


**éœ€è¦è£…é¥°è°å°±æŠŠè°ææˆæ¥å£ï¼Œç„¶åå®ç°è°ï¼Œè£…é¥°å™¨é‡Œé¢ä¼ å…¥è°ï¼ï¼ï¼**


è€Œä¸”è£…é¥°å™¨çš„æ„é€ å‡½æ•°é‡Œé¢ä¸€å®šè¦ä¼ å…¥ä¸€ä¸ªè£…é¥°çš„ç‰©ä½“çš„æ¥å£ï¼Œè¿™æ ·æ‰èƒ½å»è£…é¥°å®ƒã€‚
å½“ç„¶äº†ï¼Œjsçš„è¯ç›´æ¥ç”¨å‡½æ•°æŒ‡é’ˆæ¥èµ‹å€¼å°±å®Œäº‹äº†ã€‚




```c#
// è£…é¥°å™¨åŸºç±»ï¼Œç»§æ‰¿è‡ª ICharacterï¼Œæ‰€æœ‰è£…é¥°å™¨éƒ½ä»è¿™ä¸ªç±»æ´¾ç”Ÿ
public abstract class CharacterDecorator : ICharacter
{
    protected ICharacter _character;

    public CharacterDecorator(ICharacter character)
    {
        _character = character;
    }

    public virtual void Attack()
    {
        _character.Attack();
    }

    public virtual int GetAttackPower()
    {
        return _character.GetAttackPower();
    }
}

```


è£…é¥°å™¨é¦–å…ˆç”¨äº†ä¼ è¿›æ¥çš„å€¼ï¼Œç„¶åå…ˆè°ƒç”¨äº†ä¸€æ³¢ï¼Œä¹‹ååŠ ç‚¹è‡ªå·±çš„ä¸œè¥¿ã€‚è£…é¥°å™¨åŠ åŸºç±»ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸€è‡´æ€§ã€‚ä¹Ÿå¯ä»¥ç›´æ¥å®ç°ICharacterã€‚
è™½ç„¶**è£…é¥°å™¨æ¨¡å¼ä¸å¼ºåˆ¶è¦æ±‚æœ‰åŸºç±»**ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ**å¼•å…¥ä¸€ä¸ªåŸºç±»æˆ–æ¥å£èƒ½å¤Ÿå¸¦æ¥æ›´å¥½çš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§**ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ**å¤§å¤šæ•°è£…é¥°å™¨æ¨¡å¼çš„å®ç°éƒ½ä¼šæœ‰ä¸€ä¸ªåŸºç±»**ã€‚

```c#
// æ­¦å™¨è£…é¥°å™¨ï¼šå¢åŠ æ”»å‡»åŠ›
public class WeaponDecorator : CharacterDecorator
{
    private int additionalAttackPower;

    public WeaponDecorator(ICharacter character, int additionalAttackPower)
        : base(character)
    {
        this.additionalAttackPower = additionalAttackPower;
    }

    public override void Attack()
    {
        base.Attack();
        Debug.Log("ä½¿ç”¨æ­¦å™¨æ”»å‡»ï¼");
    }

    public override int GetAttackPower()
    {
        return base.GetAttackPower() + additionalAttackPower;
    }
}
```



```c#
public class Game
{
    public static void Main()
    {
        // åˆ›å»ºä¸€ä¸ªåŸºæœ¬è§’è‰²
        ICharacter character = new BasicCharacter();
        Debug.Log("åŸºç¡€è§’è‰²æ”»å‡»åŠ›ï¼š" + character.GetAttackPower());
        character.Attack();

        // ç»™è§’è‰²è£…å¤‡æ­¦å™¨
        character = new WeaponDecorator(character, 20); // å¢åŠ  20 æ”»å‡»åŠ›
        Debug.Log("è£…å¤‡æ­¦å™¨åçš„æ”»å‡»åŠ›ï¼š" + character.GetAttackPower());
        character.Attack();
    }

//Weapon armoredWarrior = new Weapon(new Weapon(new BasicCharacter()));
}

```

è£…é¥°å™¨æ¨¡å¼å¯ä»¥æ— é™åµŒå¥—ï¼Œå› ä¸ºæ‰€æœ‰è£…é¥°å™¨éƒ½ä¼šè¿”å›å®ç°çš„æ¥å£ï¼Œè€Œå®ƒè‡ªå·±æœ‰éœ€è¦ä¼ å…¥è¿™ä¸ªæ¥å£ã€‚


## å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰


**å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰** æ˜¯ **ç»“æ„å‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯**å¯¹å¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ç®€åŒ–æ¥å£**ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥æ›´æ–¹ä¾¿åœ°è®¿é—®ç³»ç»Ÿï¼Œè€Œæ— éœ€å…³å¿ƒå†…éƒ¨çš„å¤æ‚é€»è¾‘ã€‚

> **ç®€å•æ¥è¯´ï¼š**
> 
> - **éšè—ç³»ç»Ÿçš„å¤æ‚æ€§**ï¼Œæä¾›ä¸€ä¸ª**ç®€åŒ–çš„ API** ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚
> - **é™ä½è€¦åˆåº¦**ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ç›´æ¥æ“ä½œå¤æ‚çš„å­ç³»ç»Ÿï¼Œè€Œæ˜¯é€šè¿‡å¤–è§‚ç±»è¿›è¡Œäº¤äº’ã€‚


è¿åäº†å¼€é—­åŸåˆ™ï¼Œå› ä¸ºå­ç³»ç»Ÿå˜æ›´ä¼šå¯¼è‡´å¤–è§‚ç±»ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚



å¦‚æœä¸ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š


```c#
public class Game
{
    public void Start()
    {
        AudioManager audio = new AudioManager();
        audio.LoadSounds();
        audio.PlayBackgroundMusic();

        GraphicsManager graphics = new GraphicsManager();
        graphics.LoadTextures();
        graphics.RenderScene();

        InputManager input = new InputManager();
        input.Initialize();
    }
}

```



å¦‚æœä½¿ç”¨äº†å¤–è§‚æ¨¡å¼çš„è¯ï¼ˆ
```c#
// å­ç³»ç»Ÿ1ï¼šéŸ³é¢‘ç®¡ç†
public class AudioManager
{
    public void LoadSounds() { Console.WriteLine("åŠ è½½éŸ³æ•ˆ..."); }
    public void PlayBackgroundMusic() { Console.WriteLine("æ’­æ”¾èƒŒæ™¯éŸ³ä¹..."); }
}

// å­ç³»ç»Ÿ2ï¼šå›¾å½¢ç®¡ç†
public class GraphicsManager
{
    public void LoadTextures() { Console.WriteLine("åŠ è½½çº¹ç†..."); }
    public void RenderScene() { Console.WriteLine("æ¸²æŸ“åœºæ™¯..."); }
}

// å­ç³»ç»Ÿ3ï¼šè¾“å…¥ç®¡ç†
public class InputManager
{
    public void Initialize() { Console.WriteLine("åˆå§‹åŒ–è¾“å…¥è®¾å¤‡..."); }
}

// å¤–è§‚ç±»ï¼šæä¾›ç®€å•çš„æ¥å£
public class GameFacade
{
    private AudioManager _audio;
    private GraphicsManager _graphics;
    private InputManager _input;

    public GameFacade()
    {
        _audio = new AudioManager();
        _graphics = new GraphicsManager();
        _input = new InputManager();
    }

    public void InitializeGame()
    {
        Console.WriteLine("åˆå§‹åŒ–æ¸¸æˆ...");
        _audio.LoadSounds();
        _audio.PlayBackgroundMusic();
        _graphics.LoadTextures();
        _graphics.RenderScene();
        _input.Initialize();
        Console.WriteLine("æ¸¸æˆå¯åŠ¨æˆåŠŸï¼");
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class Game
{
    public void Start()
    {
        GameFacade gameFacade = new GameFacade();
        gameFacade.InitializeGame();  // åªéœ€è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œç®€åŒ–äº†é€»è¾‘
    }
}

```



## äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰


**äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰** æ˜¯ä¸€ç§**ç»“æ„å‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯**é€šè¿‡å…±äº«æ•°æ®æ¥å‡å°‘å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œé™ä½å†…å­˜æ¶ˆè€—**ã€‚


**ï¼ï¼ï¼ï¼æ³¨æ„ï¼Œäº«å…ƒæ¨¡å¼å’Œå¯¹è±¡æ± æ¨¡å¼æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼**

- äº«å…ƒæ¨¡å¼æ˜¯ä¸ºäº†è§£å†³å†…å­˜é—®é¢˜ï¼Œé€šè¿‡ä¸åŒå¯¹è±¡å…±äº«åŒä¸€ä¸ªæ•°æ®å‡å°‘å†…å­˜å ç”¨ï¼
- è€Œå¯¹è±¡æ± æ¨¡å¼æ˜¯ä¸ºäº†å‡å°‘åå¤ç”Ÿæˆå’Œé”€æ¯å¯¹è±¡å¸¦æ¥çš„ç®—åŠ›å¼€é”€ã€‚
- äº«å…ƒæ¨¡å¼è¿˜æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡çš„ï¼Œåªä¸è¿‡å¯¹è±¡ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®æ˜¯å…±äº«çš„ï¼ˆä¾‹å¦‚è´´å›¾ï¼Œæ¨¡å‹ç­‰ï¼‰ï¼Œè€Œå¯¹è±¡æ± æ˜¯å®Œå®Œå…¨å…¨å¤ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚


äº«å…ƒæ¨¡å¼ä¸€èˆ¬åŒ…å«ï¼š

1. **Flyweightï¼ˆäº«å…ƒç±»ï¼‰**ï¼šè¡¨ç¤º**å¯å…±äº«çš„éƒ¨åˆ†**ï¼Œé€šå¸¸æ˜¯**ä¸å¯å˜æ•°æ®**ã€‚
2. **ConcreteFlyweightï¼ˆä½¿ç”¨äº«å…ƒå¯¹è±¡çš„å…·ä½“ç±»ï¼‰**ï¼šå®ç°å…±äº«é€»è¾‘ï¼Œå­˜å‚¨ä¸å¯å˜æ•°æ®ã€‚
3. **FlyweightFactoryï¼ˆäº«å…ƒå·¥å‚ç±»ï¼‰**ï¼šç”¨äº**ç®¡ç†å’Œå¤ç”¨äº«å…ƒå¯¹è±¡**ï¼Œä¿è¯ç›¸åŒæ•°æ®çš„å¯¹è±¡ä¸ä¼šé‡å¤åˆ›å»ºã€‚
4. **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šä½¿ç”¨äº«å…ƒå¯¹è±¡ï¼Œå­˜å‚¨å¯å˜æ•°æ®ã€‚



äº«å…ƒç±»ï¼Œå®šä¹‰å¯ä»¥è¢«äº«å…ƒçš„æ•°æ®
```c#
using System;

public class EnemyFlyweight
{
    public string Name { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šåå­—
    public string ImagePath { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šå›¾ç‰‡è·¯å¾„
    public string[] SoundEffects { get; private set; }  // ç»Ÿä¸€çš„éŸ³æ•ˆ
    public string Color { get; private set; }  // ç»Ÿä¸€çš„é¢œè‰²
    public int MaxHealth { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šè¡€é‡ä¸Šé™
    public double Speed { get; private set; }  // é€šè¿‡èŒçº§ç¡®å®šé€Ÿåº¦

    public EnemyFlyweight(string name, string imagePath, string[] soundEffects, string color, int maxHealth, double speed)
    {
        Name = name;
        ImagePath = imagePath;
        SoundEffects = soundEffects;
        Color = color;
        MaxHealth = maxHealth;
        Speed = speed;
    }
}

```


æ­£å¸¸çš„æ•Œäººç±»ï¼Œå¹¶ä¸”æŒæœ‰EnemyFlyweightè¿™ä¸ªå¼•ç”¨ï¼Œå¹¶åŒ…å«ä¸å¯å…±äº«çš„å±æ€§ï¼šhpå’Œheightã€‚


```c#
public class Enemy
{
    private EnemyFlyweight _flyweight;  // äº«å…ƒå¯¹è±¡
    public int CurrentHealth { get; set; }  // å½“å‰è¡€é‡
    public double Height { get; set; }  // èº«é«˜

    public Enemy(string rank, int currentHealth, double height)
    {
        _flyweight = FlyweightFactory.Instance.GetFlyweight(rank);
        CurrentHealth = currentHealth;
        Height = height;
    }

    public void DisplayEnemyInfo()
    {
        Console.WriteLine($"Name: {_flyweight.Name}");
        Console.WriteLine($"Health: {CurrentHealth}/{_flyweight.MaxHealth}");
        Console.WriteLine($"Height: {Height}m");
        Console.WriteLine($"Image: {_flyweight.ImagePath}");
        Console.WriteLine($"Sound Effects: {string.Join(", ", _flyweight.SoundEffects)}");
        Console.WriteLine($"Color: {_flyweight.Color}");
        Console.WriteLine($"Speed: {_flyweight.Speed}m/s");
    }
}

```


äº«å…ƒå·¥å‚ï¼Œåˆ›å»ºäº«å…ƒç±»ï¼Œå¹¶ä¸”ç¼“å­˜äº«å…ƒå¯¹è±¡
```c#
using System.Collections.Generic;

public class FlyweightFactory
{
    private Dictionary<string, EnemyFlyweight> _flyweights = new Dictionary<string, EnemyFlyweight>();

    public EnemyFlyweight GetFlyweight(string rank)
    {
        if (!_flyweights.ContainsKey(rank))
        {
            EnemyFlyweight flyweight;
            switch (rank)
            {
                case "æ–°å…µ":
                    flyweight = new EnemyFlyweight("æ–°å…µ", "b.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 100, 1.0);
                    break;
                case "ä¸­å£«":
                    flyweight = new EnemyFlyweight("ä¸­å£«", "b.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 200, 2.0);
                    break;
                case "ä¸Šå£«":
                    flyweight = new EnemyFlyweight("ä¸Šå£«", "b.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 500, 3.0);
                    break;
                case "ä¸Šå°‰":
                    flyweight = new EnemyFlyweight("ä¸Šå°‰", "a.png", new string[] { "death.wav", "attack.wav", "hit.wav" }, "Color(128,0,128,255)", 1000, 4.0);
                    break;
                default:
                    throw new ArgumentException("æœªçŸ¥èŒçº§");
            }
            _flyweights[rank] = flyweight;
        }
        return _flyweights[rank];
    }
}

```

å®¢æˆ·ç«¯ä»£ç 
```c#
public class Game
{
    public static void Main()
    {
        FlyweightFactory factory = new FlyweightFactory();

        // åˆ›å»º10000ä¸ªæ•Œäººï¼ˆæ¨¡æ‹Ÿï¼‰
        var enemies = new List<Enemy>();
        for (int i = 0; i < 10000; i++)
        {
            // å‡è®¾æ•ŒäººèŒçº§éšæœº
            string rank = i % 4 == 0 ? "æ–°å…µ" :
                          i % 4 == 1 ? "ä¸­å£«" :
                          i % 4 == 2 ? "ä¸Šå£«" : "ä¸Šå°‰";
            
            var enemy = new Enemy(rank, 100, 1.75);  // æ¯ä¸ªæ•Œäººæœ‰ç‹¬ç«‹çš„è¡€é‡å’Œèº«é«˜
            enemies.Add(enemy);
        }

        // æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ•Œäººçš„ä¿¡æ¯ï¼ˆä»…æ¼”ç¤ºï¼‰
        enemies[0].DisplayEnemyInfo();
    }
}

```







## ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰


ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ä¸ºæŸä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œä»¥**æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®**ã€‚ä»£ç†é€šå¸¸ç”¨äº**å»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ã€è¿œç¨‹è®¿é—®ç­‰**åœºæ™¯ã€‚

ä»£ç†æ¨¡å¼ = **ç»™å¯¹è±¡åŠ ä¸€å±‚â€œä¸­ä»‹â€**


**ä»€ä¹ˆæ—¶å€™ç”¨ä»£ç†æ¨¡å¼ï¼Ÿ**

âœ… **ä½¿ç”¨ä»£ç†æ¨¡å¼**

- ä½ éœ€è¦**æ§åˆ¶æŸä¸ªå¯¹è±¡çš„è®¿é—®**ï¼ˆå¦‚æƒé™ã€è¿œç¨‹è°ƒç”¨ï¼‰ã€‚
- ä½ éœ€è¦**å»¶è¿ŸåŠ è½½**ï¼ˆå¦‚ `GameMapProxy` å…ˆä¸åŠ è½½æ•°æ®ï¼‰ã€‚
- ä½ æƒ³åœ¨è®¿é—®å¯¹è±¡å‰**å¢åŠ é¢å¤–è¡Œä¸º**ï¼ˆå¦‚æ—¥å¿—ã€ç¼“å­˜ï¼‰ã€‚

âœ… **ä¸è¦ä½¿ç”¨ä»£ç†æ¨¡å¼**

- å¦‚æœä¸éœ€è¦**æ‹¦æˆª/æ§åˆ¶**è®¿é—®ï¼Œç›´æ¥ä½¿ç”¨å¯¹è±¡å³å¯ã€‚
- å¦‚æœåªæ˜¯**å¢å¼ºåŠŸèƒ½**ï¼Œå¯ä»¥ç”¨**è£…é¥°å™¨æ¨¡å¼**ã€‚


åœ¨ RPG æ¸¸æˆä¸­ï¼Œè§’è‰²æ‹¥æœ‰æ™®é€šæŠ€èƒ½å’Œç‰¹æ®ŠæŠ€èƒ½ã€‚ç‰¹æ®ŠæŠ€èƒ½é€šå¸¸éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼ˆæ¯”å¦‚è¾¾åˆ°ç‰¹å®šç­‰çº§ã€æ‹¥æœ‰ç‰¹å®šé“å…·ç­‰ï¼‰æ‰èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†æ¨¡å¼æ¥å®ç°è¿™ç§æƒé™æ§åˆ¶ï¼Œç¡®ä¿åªæœ‰æ»¡è¶³æ¡ä»¶çš„è§’è‰²æ‰èƒ½ä½¿ç”¨ç‰¹æ®ŠæŠ€èƒ½ã€‚

**ä¹Ÿå°±æ˜¯è¯´ä¸ºäº†ä¿è¯å•ä¸€èŒè´£åŸåˆ™ï¼ŒSpecialSkillç±»ä¸åº”è¯¥è´Ÿè´£éªŒè¯æŠ€èƒ½çš„é‡Šæ”¾æ¡ä»¶ã€‚è€Œæ˜¯ç”±ä¸€ä¸ªä»£ç†ç±»æ¥æ§åˆ¶æŠ€èƒ½çš„é‡Šæ”¾æ¡ä»¶ã€‚**

```c#
using UnityEngine;

// æŠ½è±¡ä¸»é¢˜ï¼šå®šä¹‰æŠ€èƒ½ä½¿ç”¨çš„æ¥å£
public interface ISkill
{
    void UseSkill();
}

// çœŸå®ä¸»é¢˜ï¼šä»£è¡¨è§’è‰²çš„ç‰¹æ®ŠæŠ€èƒ½
public class SpecialSkill : ISkill
{
    public void UseSkill()
    {
        Debug.Log("ä½¿ç”¨ç‰¹æ®ŠæŠ€èƒ½ï¼Œé‡Šæ”¾å¼ºå¤§çš„é­”æ³•æ”»å‡»ï¼");
    }
}

// ä»£ç†ï¼šä¿æŠ¤ä»£ç†ï¼Œç”¨äºæ§åˆ¶ç‰¹æ®ŠæŠ€èƒ½çš„ä½¿ç”¨æƒé™
public class SkillProxy : ISkill
{
    private SpecialSkill specialSkill;
    private int requiredLevel;
    private int currentLevel;

    public SkillProxy(int requiredLevel, int currentLevel)
    {
        this.requiredLevel = requiredLevel;
        this.currentLevel = currentLevel;
        specialSkill = new SpecialSkill();
    }

    public void UseSkill()
    {
        if (currentLevel >= requiredLevel)
        {
            // æ»¡è¶³ç­‰çº§è¦æ±‚ï¼Œè°ƒç”¨çœŸå®æŠ€èƒ½çš„ä½¿ç”¨æ–¹æ³•
            specialSkill.UseSkill();
        }
        else
        {
            Debug.Log("ç­‰çº§ä¸è¶³ï¼Œæ— æ³•ä½¿ç”¨ç‰¹æ®ŠæŠ€èƒ½ã€‚");
        }
    }
}

// è§’è‰²ç±»ï¼ŒåŒ…å«æŠ€èƒ½ä½¿ç”¨çš„é€»è¾‘
public class Character : MonoBehaviour
{
    public int characterLevel;
    private ISkill skillProxy;

    private void Start()
    {
        // åˆ›å»ºæŠ€èƒ½ä»£ç†ï¼Œè¦æ±‚ç­‰çº§ä¸º 10
        skillProxy = new SkillProxy(10, characterLevel);
    }

    private void Update()
    {
        if (Input.GetKeyDown(KeyCode.S))
        {
            // å°è¯•ä½¿ç”¨æŠ€èƒ½
            skillProxy.UseSkill();
        }
    }
}

```



# è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰

è¡Œä¸ºå‹æ¨¡å¼ä¸»è¦å…³æ³¨**å¯¹è±¡ä¹‹é—´çš„é€šä¿¡**å’Œ**èŒè´£åˆ†é…**ï¼Œä»¥åŠå¦‚ä½•è®©ç³»ç»Ÿä¸­çš„å¯¹è±¡è¿›è¡Œæœ‰æ•ˆçš„åä½œã€‚è¿™ç±»æ¨¡å¼é€šå¸¸ç”¨äºå®šä¹‰**å¯¹è±¡ä¹‹é—´å¦‚ä½•äº’ç›¸é…åˆ**ï¼Œä»è€Œå®ç°æŸä¸€åŠŸèƒ½ã€‚



## è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰

**è´£ä»»é“¾æ¨¡å¼**æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒå…è®¸å¤šä¸ªå¯¹è±¡**æŒ‰é¡ºåºå¤„ç†ä¸€ä¸ªè¯·æ±‚**ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå¯¹è±¡èƒ½å¤Ÿå¤„ç†å®ƒä¸ºæ­¢ã€‚è¿™æ ·å¯ä»¥é¿å…è¯·æ±‚çš„å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„ç´§è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚

- è¯·æ±‚æ²¿ç€ä¸€æ¡**é“¾**ä¼ é€’ï¼Œé“¾ä¸Šçš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰**å¤„ç†è¯·æ±‚çš„æœºä¼š**ã€‚
- **å¦‚æœä¸€ä¸ªå¯¹è±¡æ— æ³•å¤„ç†è¯·æ±‚ï¼Œå®ƒä¼šå°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡**ï¼Œç›´åˆ°é“¾çš„æœ«ç«¯ã€‚
- è´£ä»»é“¾æ¨¡å¼ä½¿**è¯·æ±‚çš„å‘é€è€…**å’Œ**å¤„ç†è€…**è§£è€¦ï¼Œ**å‘é€è€…ä¸éœ€è¦çŸ¥é“æœ€ç»ˆç”±è°å¤„ç†è¯·æ±‚**ã€‚


- å½“é“¾æ¡è¾ƒé•¿çš„æ—¶å€™ï¼Œæ€§èƒ½å¯èƒ½æ¯”è¾ƒå·®


```c#
using System;

// æŠ½è±¡å¤„ç†è€…
public abstract class Logger
{
    protected Logger nextLogger; // ä¸‹ä¸€ä¸ªå¤„ç†è€…

    public void SetNext(Logger nextLogger)
    {
        this.nextLogger = nextLogger;
    }

    public void Log(string message, LogLevel level)
    {
        if (CanHandle(level))
        {
            WriteLog(message);
        }
        else if (nextLogger != null)
        {
            nextLogger.Log(message, level);
        }
    }

    protected abstract bool CanHandle(LogLevel level);
    protected abstract void WriteLog(string message);
}

// æ—¥å¿—çº§åˆ«
public enum LogLevel
{
    Debug,
    Warning,
    Error
}

// å…·ä½“å¤„ç†è€…ï¼šè°ƒè¯•æ—¥å¿—å¤„ç†å™¨
public class DebugLogger : Logger
{
    protected override bool CanHandle(LogLevel level) => level == LogLevel.Debug;

    protected override void WriteLog(string message)
    {
        Console.WriteLine("[DEBUG]: " + message);
    }
}

// å…·ä½“å¤„ç†è€…ï¼šè­¦å‘Šæ—¥å¿—å¤„ç†å™¨
public class WarningLogger : Logger
{
    protected override bool CanHandle(LogLevel level) => level == LogLevel.Warning;

    protected override void WriteLog(string message)
    {
        Console.WriteLine("[WARNING]: " + message);
    }
}

// å…·ä½“å¤„ç†è€…ï¼šé”™è¯¯æ—¥å¿—å¤„ç†å™¨
public class ErrorLogger : Logger
{
    protected override bool CanHandle(LogLevel level) => level == LogLevel.Error;

    protected override void WriteLog(string message)
    {
        Console.WriteLine("[ERROR]: " + message);
    }
}

// æµ‹è¯•ä»£ç 
class Program
{
    static void Main()
    {
        Logger debugLogger = new DebugLogger();
        Logger warningLogger = new WarningLogger();
        Logger errorLogger = new ErrorLogger();

        // è®¾ç½®è´£ä»»é“¾ï¼šDebug -> Warning -> Error
        debugLogger.SetNext(warningLogger);
        warningLogger.SetNext(errorLogger);

        // å‘é€ä¸åŒçº§åˆ«çš„æ—¥å¿—
        debugLogger.Log("This is a debug message.", LogLevel.Debug);
        debugLogger.Log("This is a warning!", LogLevel.Warning);
        debugLogger.Log("Critical error occurred!", LogLevel.Error);
    }
}

```



## å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰

**å‘½ä»¤æ¨¡å¼**æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒå°†**è¯·æ±‚ï¼ˆåŠ¨ä½œï¼‰å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡**ï¼Œä»è€Œä½¿å¾—è¯·æ±‚çš„å‘é€è€…å’Œæ‰§è¡Œè€…**è§£è€¦**ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°**å­˜å‚¨ã€æ’¤é”€æˆ–æ‰©å±•å‘½ä»¤**ã€‚


å’ŒMVCç”¨çš„ä¸€å¥—ä¸œè¥¿ï¼Œå°†ä¸šåŠ¡é€»è¾‘å’Œè¡¨ç°å±‚åˆ†å¼€ï¼Œç”¨commandç®¡ç†å…·ä½“è¡¨ç°ã€‚


å¤–è§‚æ¨¡å¼æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå‘½ä»¤æ¨¡å¼æ˜¯ä¸ºäº†æ–¹ä¾¿å¤ç”¨Command


- æœ¬è´¨ä¸Šå°±æ˜¯æŠŠä¸€ä¸ªå‘½ä»¤åŒ…è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œæ–¹ä¾¿å‘½ä»¤çš„å†…å®¹å˜åŒ–æ—¶å¿«é€Ÿæ›¿æ¢é€»è¾‘ï¼Œè€Œä¸æ˜¯æ›¿æ¢å…¶å®ƒéƒ¨åˆ†ã€‚
- å‘½ä»¤æ¨¡å¼å¾ˆé‡è¦ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å¯ä»¥æ’¤é”€ã€‚
- éœ€è¦ä»€ä¹ˆå‘½ä»¤å°±newä¸€ä¸ªè¿™ä¸ªå‘½ä»¤ï¼Œç„¶åç”¨å‘½ä»¤ç®¡ç†å™¨åŠ å…¥historyå°±å®Œäº‹äº†ã€‚



âŒå‡è®¾ä¸ä½¿ç”¨å‘½ä»¤æ¨¡å¼
```c#
using UnityEngine;
using UnityEngine.UI;

public class UIManager : MonoBehaviour
{
    public Image backgroundImage;

    public Button redButton;
    public Button blueButton;
    public Button greenButton;
    public Button undoButton;

    private Color previousColor;

    void Start()
    {
        redButton.onClick.AddListener(() => ChangeColor(Color.red));
        blueButton.onClick.AddListener(() => ChangeColor(Color.blue));
        greenButton.onClick.AddListener(() => ChangeColor(Color.green));
        undoButton.onClick.AddListener(UndoLastChange);
    }

    void ChangeColor(Color color)
    {
        previousColor = backgroundImage.color; // è®°å½•ä¸Šä¸€ä¸ªé¢œè‰²
        backgroundImage.color = color;
    }

    void UndoLastChange()
    {
        backgroundImage.color = previousColor;
    }
}

```


1. **UIManager ç›´æ¥æ“ä½œ UI**ï¼š
    
    - `ChangeColor(Color color)` ç›´æ¥æ“ä½œ `backgroundImage.color`ï¼Œ**å¼ºä¾èµ– UI ç»„ä»¶**ã€‚
    - å¦‚æœ UI é€»è¾‘éœ€è¦ä¿®æ”¹ï¼Œæ¯”å¦‚æ–°å¢ä¸€ä¸ª **åŠ¨ç”»æ•ˆæœ** æˆ– **æ—¥å¿—è®°å½•**ï¼Œéœ€è¦æ”¹ `UIManager` ä»£ç ã€‚
2. **æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ç›´æ¥è€¦åˆåˆ° `UIManager`**ï¼š
    
    - `onClick.AddListener()` ç›´æ¥ç»‘å®š `ChangeColor()` æ–¹æ³•ï¼Œä½¿å¾— **UI é€»è¾‘ä¸é¢œè‰²å˜åŒ–é€»è¾‘ç´§å¯†ç»‘å®š**ã€‚
    - æœªæ¥å¦‚æœéœ€è¦**æ”¯æŒæ’¤é”€å¤šä¸ªæ­¥éª¤**ï¼Œç°æœ‰ä»£ç ä¸æ”¯æŒï¼Œéœ€è¦**å¤§æ”¹** `UIManager`ã€‚
3. **æ— æ³•æ‰©å±•æ–°åŠŸèƒ½**ï¼š
    - ä¸èƒ½è½»æ¾æ·»åŠ  **æ—¥å¿—ç³»ç»Ÿã€ç½‘ç»œè¯·æ±‚ã€åŠ¨ç”»**ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå¿…é¡»ä¿®æ”¹ `UIManager` çš„ `ChangeColor()` æ–¹æ³•ã€‚






å‘½ä»¤æ¥å£

```c#
// å‘½ä»¤æ¥å£ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½è¦å®ç° Execute() å’Œ Undo()
public interface ICommand
{
    void Execute();  // æ‰§è¡Œæ“ä½œ
    void Undo();     // æ’¤é”€æ“ä½œ
}
```


å…·ä½“å‘½ä»¤ï¼ˆConcreteCommandï¼‰ï¼šæ”¹å˜ UI é¢œè‰²
```c#
using UnityEngine;
using UnityEngine.UI;

public class ChangeColorCommand : ICommand
{
    private Image targetImage; // ç›®æ ‡UI
    private Color newColor;    // è¦æ›´æ”¹çš„é¢œè‰²
    private Color previousColor; // è®°å½•ä¸Šä¸€ä¸ªé¢œè‰²ï¼ˆç”¨äºæ’¤é”€ï¼‰

    public ChangeColorCommand(Image image, Color color)
    {
        targetImage = image;
        newColor = color;
        previousColor = image.color; // è®°å½•æ‰§è¡Œå‰çš„é¢œè‰²
    }

    public void Execute()
    {
        targetImage.color = newColor;
    }

    public void Undo()
    {
        targetImage.color = previousColor;
    }
}

```


å‘½ä»¤æ§åˆ¶å™¨ï¼ˆCommandControllerï¼‰ï¼šç®¡ç†å‘½ä»¤å†å²
```c#
using System.Collections.Generic;
using UnityEngine;

public class CommandController : MonoBehaviour
{
    private Stack<ICommand> commandHistory = new Stack<ICommand>(); // å­˜å‚¨å‘½ä»¤å†å²

    public void ExecuteCommand(ICommand command)
    {
        command.Execute();
        commandHistory.Push(command); // è®°å½•æ‰§è¡Œçš„å‘½ä»¤
    }

    public void UndoLastCommand()
    {
        if (commandHistory.Count > 0)
        {
            ICommand lastCommand = commandHistory.Pop();
            lastCommand.Undo();
        }
    }
}

```


å®¢æˆ·ç«¯
```c#
using UnityEngine;
using UnityEngine.UI;

public class UIManager : MonoBehaviour
{
    public Image backgroundImage; // éœ€è¦æ”¹å˜é¢œè‰²çš„ UI
    public CommandController commandController; // å‘½ä»¤æ§åˆ¶å™¨

    public Button redButton;
    public Button blueButton;
    public Button greenButton;
    public Button undoButton;

    void Start()
    {
        redButton.onClick.AddListener(() => ExecuteCommand(Color.red));
        blueButton.onClick.AddListener(() => ExecuteCommand(Color.blue));
        greenButton.onClick.AddListener(() => ExecuteCommand(Color.green));
        undoButton.onClick.AddListener(() => commandController.UndoLastCommand());
    }

    void ExecuteCommand(Color color)
    {
        ICommand command = new ChangeColorCommand(backgroundImage, color);
        commandController.ExecuteCommand(command);
    }
}

```



- æœ€å¥½æŠŠæ•°æ®ç»“æ„æ”¹ä¸ºåŒå‘é˜Ÿåˆ—ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿å›ºå®šé•¿åº¦ã€‚
- ä¸è¦ç”¨stackï¼Œå› ä¸ºå¦‚æœéœ€è¦redoçš„è¯ï¼Œéœ€è¦ä¸¤ä¸ªstackï¼Œé¢å¤–ä¿å­˜å¼¹å‡ºçš„å‘½ä»¤ã€‚


**ä»£ç å¦‚ä½•è§£è€¦ï¼Ÿ**
ä»£ç è§’è‰²	ä½œç”¨	å˜åŒ–å½±å“

| ä»£ç è§’è‰²                   | ä½œç”¨        | å˜åŒ–å½±å“                       |
| ---------------------- | --------- | -------------------------- |
| **UIManager**          | åªè´Ÿè´£æ‰§è¡Œå‘½ä»¤   | UI é€»è¾‘å˜åŒ–ä¸ä¼šå½±å“é¢œè‰²å˜æ›´é€»è¾‘          |
| **CommandController**  | è´Ÿè´£æ‰§è¡Œå’Œæ’¤é”€å‘½ä»¤ | ä¸å½±å“ UI é€»è¾‘æˆ–å‘½ä»¤é€»è¾‘             |
| **ChangeColorCommand** | å¤„ç†å…·ä½“çš„é¢œè‰²å˜åŒ– | UI å˜åŒ–ä¸å½±å“ CommandController |


âœ… ç»“è®ºï¼šUIManagerã€CommandControllerã€ChangeColorCommand ä¸‰è€…äº’ä¸ä¾èµ–ï¼Œä¿®æ”¹å…¶ä¸­ä¹‹ä¸€ä¸ä¼šå½±å“å…¶ä»–ä»£ç ï¼




## è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰

ä¸»è¦æ˜¯ä¸ºäº†è§£é‡Šè‡ªå·±çš„DSL

æ¯”å¦‚å¯ä»¥å®ç°rpgä¸­çš„å¯Œæ–‡æœ¬æ•ˆæœã€‚





å®šä¹‰è§£é‡Šå™¨æ¥å£
```c#
public interface IExpression
{
    int Interpret();  // è§£é‡Šæ–¹æ³•ï¼Œè¿”å›è®¡ç®—ç»“æœ
}


```


å®šä¹‰ä¸Šä¸‹æ–‡çš„å¯¹è±¡ï¼Œ`Context` è´Ÿè´£å­˜å‚¨å˜é‡çš„å€¼ï¼Œå¹¶æä¾›è·å–æ–¹æ³•
```c#
// ä¸Šä¸‹æ–‡ç±»ï¼Œç”¨äºå­˜å‚¨å˜é‡çš„å€¼
public class Context
{
    private Dictionary<string, int> variables = new Dictionary<string, int>();

    // è®¾ç½®å˜é‡å€¼
    public void SetVariable(string name, int value)
    {
        variables[name] = value;
    }

    // è·å–å˜é‡å€¼
    public int GetVariable(string name)
    {
        return variables.TryGetValue(name, out int value) ? value : 0; // æœªå®šä¹‰å˜é‡é»˜è®¤è¿”å› 0
    }
}

```



ç»ˆç»“ç¬¦è¡¨è¾¾å¼ (æ•°å­—)
```c#
// æ•°å­—ç±»
public class NumberExpression : Expression
{
    private int _number;

    public NumberExpression(int number)
    {
        _number = number;
    }

    public override int Interpret()
    {
        return _number;
    }
}

```


æ“ä½œç¬¦è¡¨è¾¾å¼ (åŠ æ³•å’Œå‡æ³•)
```c#
// åŠ æ³•ç±»
public class AddExpression : Expression
{
    private Expression _left;
    private Expression _right;

    public AddExpression(Expression left, Expression right)
    {
        _left = left;
        _right = right;
    }

    public override int Interpret()
    {
        return _left.Interpret() + _right.Interpret(); // è¿”å›å·¦è¾¹è¡¨è¾¾å¼ä¸å³è¾¹è¡¨è¾¾å¼ä¹‹å’Œ
    }
}

// å‡æ³•ç±»
public class SubtractExpression : Expression
{
    private Expression _left;
    private Expression _right;

    public SubtractExpression(Expression left, Expression right)
    {
        _left = left;
        _right = right;
    }

    public override int Interpret()
    {
        return _left.Interpret() - _right.Interpret(); // è¿”å›å·¦è¾¹è¡¨è¾¾å¼ä¸å³è¾¹è¡¨è¾¾å¼ä¹‹å·®
    }
}

```


è§£æè¡¨è¾¾å¼çš„parserï¼Œç”¨äºçœŸæ­£å¤„ç†è¡¨è¾¾å¼çš„é€»è¾‘

```c#
// è§£æå™¨ï¼Œè§£æè¡¨è¾¾å¼å¹¶ç”Ÿæˆè§£é‡Šå™¨æ ‘
public class ExpressionParser
{
    public static Expression Parse(string expression)
    {
        var tokens = expression.Split(' ');
        Expression currentExpression = null;
        string currentOperator = null;

        foreach (var token in tokens)
        {
            Debug.Log($"å¤„ç†tokenï¼š{token}");
            
            // å¦‚æœæ˜¯è¿ç®—ç¬¦ï¼Œä¿å­˜èµ·æ¥ç­‰å¾…ä¸‹ä¸€ä¸ªæ“ä½œæ•°
            if (token == "+" || token == "-")
            {
                currentOperator = token;
                continue;
            }

  
            Expression newExpression;
            // æ˜¯æ•°å­—
            if (int.TryParse(token, out int number))
            {
                newExpression = new NumberExpression(number);
            }
            else//æ˜¯å˜é‡
            {
                newExpression = new VariableExpression(token);
            }

            // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ“ä½œæ•°
            if (currentExpression == null)
            {
                currentExpression = newExpression;
            }
            // å¦‚æœæœ‰ä¹‹å‰çš„æ“ä½œæ•°å’Œè¿ç®—ç¬¦ï¼Œè¿›è¡Œè¿ç®—
            else if (currentOperator != null)
            {
                currentExpression = currentOperator == "+" 
                    ? new AddExpression(currentExpression, newExpression)
                    : new SubtractExpression(currentExpression, newExpression);
                currentOperator = null;
            }
        }

        if (currentExpression == null)
        {
            throw new System.ArgumentException("Invalid expression");
        }

        return currentExpression;
    }
}


```



å®¢æˆ·ç«¯

```c#
public class Calculator
{
    public static void Main(string[] args)
    {
        string expression = "3 + 5 - 2 + 8"; // è®¡ç®—è¿™ä¸ªè¡¨è¾¾å¼

        // è§£æè¡¨è¾¾å¼
        Expression parsedExpression = ExpressionParser.Parse(expression);

        // è®¡ç®—å¹¶è¾“å‡ºç»“æœ
        int result = parsedExpression.Interpret();
        Console.WriteLine($"ç»“æœæ˜¯ï¼š{result}"); // è¾“å‡ºç»“æœï¼š14
    }
}


///ä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡

public class Calculator
{
    public static void Main(string[] args)
    {
        // åˆ›å»ºä¸Šä¸‹æ–‡å¹¶è®¾ç½®å˜é‡
        Context context = new Context();
        context.SetVariable("x", 10);
        context.SetVariable("y", 3);

        // è¡¨è¾¾å¼
        string expression = "x + 5 - y"; // x=10, y=3ï¼Œè®¡ç®— 10 + 5 - 3

        // è§£æå¹¶è®¡ç®—
        Expression parsedExpression = ExpressionParser.Parse(expression);
        int result = parsedExpression.Interpret(context);

        Console.WriteLine($"ç»“æœæ˜¯ï¼š{result}"); // ç»“æœæ˜¯ï¼š12
    }
}


```







## è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰


**è¿­ä»£å™¨æ¨¡å¼** æ˜¯ä¸€ç§ **è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**æä¾›ä¸€ç§æ–¹æ³•æ¥é¡ºåºè®¿é—®é›†åˆå¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨è¡¨ç¤º**ã€‚


ç®€å•æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š
- **å°è£…éå†é€»è¾‘**ï¼Œè®©ä½ å¯ä»¥åƒä½¿ç”¨ `foreach` ä¸€æ ·éå†é›†åˆï¼Œè€Œä¸å¿…å…³å¿ƒåº•å±‚æ•°æ®ç»“æ„ã€‚
- **è§£è€¦éå†ä¸é›†åˆæœ¬èº«**ï¼Œä½¿å¾—å¯ä»¥ä¸ºä¸åŒçš„é›†åˆæä¾›ä¸åŒçš„éå†æ–¹å¼ã€‚


å¯¹äºè¿­ä»£å™¨æ¨¡å¼æ¥è¯´ï¼Œåªè¦å®ç°äº†è¿­ä»£å™¨æ¥å£å°±å¯ä»¥äº†
è¿­ä»£å™¨æ¥å£ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹çš„æ–¹æ³•ï¼š

    bool HasNext();
    Loli Next();//è·å–æ•°æ®
    void Reset();

è°ƒç”¨è¿­ä»£å™¨å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š

```c#
using UnityEngine;
using System.Collections;
using System.Collections.Generic;

// è¿­ä»£å™¨æ¥å£
public interface ILoliIterator
{
    bool HasNext();
    Loli Next();
    void Reset();
}

// èè‰ç±»
public class Loli
{
    public string Name { get; set; }
    public string Personality { get; set; }

    public Loli(string name, string personality)
    {
        Name = name;
        Personality = personality;
    }
}

// èè‰é›†åˆç±»
public class LoliCollection
{
    private List<Loli> lolis = new List<Loli>();

    public void AddLoli(Loli loli)
    {
        lolis.Add(loli);
    }

    public ILoliIterator CreateIterator()
    {
        return new LoliIterator(lolis);
    }
}

// å…·ä½“è¿­ä»£å™¨å®ç°
public class LoliIterator : ILoliIterator
{
    private List<Loli> lolis;
    private int currentPosition = 0;

    public LoliIterator(List<Loli> lolis)
    {
        this.lolis = lolis;
    }

    public bool HasNext()
    {
        return currentPosition < lolis.Count;
    }

    public Loli Next()
    {
        if (HasNext())
        {
            return lolis[currentPosition++];
        }
        return null;
    }

    public void Reset()
    {
        currentPosition = 0;
    }
}

public class Test : MonoBehaviour
{
    void Start()
    {
        // åˆ›å»ºèè‰é›†åˆ
        LoliCollection loliCollection = new LoliCollection();
        loliCollection.AddLoli(new Loli("å°æ¨±", "æ´»æ³¼å¯çˆ±"));
        loliCollection.AddLoli(new Loli("å°åœ†", "æ¸©æŸ”å–„è‰¯"));
        loliCollection.AddLoli(new Loli("å°çˆ±", "å‚²å¨‡å¯çˆ±"));

        // ä½¿ç”¨è¿­ä»£å™¨éå†èè‰
        ILoliIterator iterator = loliCollection.CreateIterator();
        while (iterator.HasNext())
        {
            Loli loli = iterator.Next();
            Debug.Log($"èè‰å§“å: {loli.Name}, æ€§æ ¼: {loli.Personality}");
        }
    }
}

```





- å› ä¸ºè¿™ä¸ªä¸œè¥¿éå¸¸å¸¸ç”¨ï¼Œæ‰€ä»¥c#åŸç”Ÿæä¾›äº†è¿­ä»£å™¨æ¨¡å¼çš„å®ç°ã€‚**ä¸€ä¸ªcollectionè¦æ”¯æŒForeachè¿›è¡Œéå†ï¼Œå°±å¿…é¡»å®ç°IEnumerable,å¹¶ä»¥æŸç§æ–¹å¼è¿”å›è¿­ä»£å™¨è±¡:IEnumeratorã€‚**
- foreachå®é™…ä¸Šæ˜¯whileçš„ä¸€ç§è¯­æ³•ç³–



```c#
using UnityEngine;
using System.Collections;
using System.Collections.Generic;
using System.Linq;

// èè‰ç±»
public class Loli
{
    public string Name { get; set; }
    public string Personality { get; set; }

    public Loli(string name, string personality)
    {
        Name = name;
        Personality = personality;
    }
}

// æ–¹å¼1ï¼šæ‰‹åŠ¨å®ç°IEnumeratorçš„è¿­ä»£å™¨
public class LoliEnumerator : IEnumerator<Loli>
{
    private List<Loli> lolis;
    private int currentIndex = -1;

    public LoliEnumerator(List<Loli> lolis)
    {
        this.lolis = lolis;
    }

    public Loli Current => lolis[currentIndex];

    object IEnumerator.Current => Current;

    public bool MoveNext()
    {
        currentIndex++;
        return currentIndex < lolis.Count;
    }

    public void Reset()
    {
        currentIndex = -1;
    }

    public void Dispose()
    {
        // æ¸…ç†èµ„æº
    }
}

// èè‰é›†åˆç±» - å®ç°IEnumerableæ¥å£
public class LoliCollection : IEnumerable<Loli>
{
    private List<Loli> lolis = new List<Loli>();

    public void AddLoli(Loli loli)
    {
        lolis.Add(loli);
    }

    public IEnumerator<Loli> GetEnumerator()
    {
        return new LoliEnumerator(lolis);
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }

    

    // æ–¹å¼2ï¼šä½¿ç”¨yield returnå®ç°è¿­ä»£å™¨ï¼Œå¯ä»¥æ›´åŠ ç›´è§‚çš„åšä¸€äº›é€»è¾‘çš„å®šåˆ¶
    public IEnumerable<Loli> GetCuteLolis()
    {
        foreach (var loli in lolis)
        {
            if (loli.Personality.Contains("å¯çˆ±"))
            {
                //yieldä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨
                yield return loli;
            }
        }
    }

}

public class Test : MonoBehaviour
{
    void Start()
    {
        // åˆ›å»ºèè‰é›†åˆ
        LoliCollection loliCollection = new LoliCollection();
        loliCollection.AddLoli(new Loli("å°æ¨±", "æ´»æ³¼å¯çˆ±"));
        loliCollection.AddLoli(new Loli("å°åœ†", "æ¸©æŸ”å–„è‰¯"));
        loliCollection.AddLoli(new Loli("å°çˆ±", "å‚²å¨‡å¯çˆ±"));

        // æ–¹å¼1ï¼šä½¿ç”¨æ‰‹åŠ¨å®ç°çš„è¿­ä»£å™¨
        Debug.Log("=== ä½¿ç”¨æ‰‹åŠ¨å®ç°çš„è¿­ä»£å™¨ ===");
        foreach (var loli in loliCollection)
        {
            Debug.Log($"èè‰å§“å: {loli.Name}, æ€§æ ¼: {loli.Personality}");
        }

        // æ–¹å¼2ï¼šä½¿ç”¨yield returnå®ç°çš„è¿­ä»£å™¨
        Debug.Log("\n=== ä½¿ç”¨yield returnå®ç°çš„è¿­ä»£å™¨ ===");
        foreach (var loli in loliCollection.GetCuteLolis())
        {
            Debug.Log($"å¯çˆ±çš„èè‰: {loli.Name}");
        }
    }
}

```




æˆ‘ä»¬è¦éå† RPG æ¸¸æˆä¸­çš„ä»»åŠ¡åˆ—è¡¨ï¼Œä½†ä¸å¸Œæœ›ç›´æ¥æš´éœ² `List<Task>` ç»“æ„ã€‚



## ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰



**ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰** æ˜¯ä¸€ç§**è¡Œä¸ºè®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**å‡å°‘å¯¹è±¡ä¹‹é—´çš„ç›´æ¥ä¾èµ–å…³ç³»**ï¼Œè®©å¤šä¸ªå¯¹è±¡é€šè¿‡ä¸€ä¸ªä¸­ä»‹è€…ï¼ˆMediatorï¼‰æ¥è¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯ç›¸äº’ç›´æ¥è°ƒç”¨ã€‚





- å½“ä¸€ä¸ªå¯¹è±¡å’Œå…¶å®ƒçš„å¯¹è±¡éœ€è¦äº’ç›¸æ²Ÿé€šæ—¶ï¼Œä¼šå‘ˆç°ç½‘çŠ¶çš„å…³ç³»ã€‚ä¸ºäº†é¿å…è¿™ç§å…³ç³»éœ€è¦ä¸­ä»‹è€…ã€‚ä¾‹å¦‚é£æœºçš„å¡”æ¥¼ï¼Œé£æœºé™è½çš„æ—¶å€™ä¸ä¼šå’Œå½¼æ­¤ä¹‹é—´é€šä¿¡è¦é™è½ï¼Œè€Œæ˜¯å…¨éƒ¨éƒ½é€šè¿‡å¡”æ¥¼æ²Ÿé€šã€‚


ğŸ“Œ **ä¸­ä»‹è€…æ¨¡å¼çš„æ ¸å¿ƒï¼š** âœ” **å»ä¸­å¿ƒåŒ–**çš„ç‚¹å¯¹ç‚¹é€šä¿¡ â†’ **é›†ä¸­å¼åè°ƒ**


å¹¿æ’­å®¤çš„ä¾‹å­
è™½ç„¶è¿™ç©æ„é€‚åˆç”¨å¹¿æ’­æ¨¡å¼åšï¼Œä½†æ˜¯æˆ‘ä¸€æ—¶åŠä¼šæƒ³ä¸åˆ°å…¶å®ƒçš„ä¾‹å­ï¼Œæ‰€ä»¥å¯ä»¥å…ˆç”¨ä¸­ä»‹è€…æ¨¡å¼å»åšã€‚

```c#
using System;
using System.Collections.Generic;

// **1ï¸âƒ£ å®šä¹‰ä¸­ä»‹è€…æ¥å£**
interface IChatMediator
{
    void SendMessage(string message, Player sender);
    void AddPlayer(Player player);
}

// **2ï¸âƒ£ å…·ä½“ä¸­ä»‹è€…ï¼šèŠå¤©æœåŠ¡å™¨**
class ChatMediator : IChatMediator
{
    private List<Player> players = new List<Player>();

    public void AddPlayer(Player player)
    {
        players.Add(player);
    }

    public void SendMessage(string message, Player sender)
    {
        foreach (var player in players)
        {
            if (player != sender)  // ä¸ç»™è‡ªå·±å‘æ¶ˆæ¯
            {
                player.ReceiveMessage(message, sender);
            }
        }
    }
}

// **3ï¸âƒ£ å®šä¹‰åŒäº‹ç±»ï¼ˆç©å®¶ï¼‰**
class Player
{
    public string Name { get; private set; }
    private IChatMediator chatMediator;

    public Player(string name, IChatMediator mediator)
    {
        Name = name;
        chatMediator = mediator;
        chatMediator.AddPlayer(this);
    }

    public void Send(string message)
    {
        Console.WriteLine($"ğŸ“¤ {Name} å‘é€æ¶ˆæ¯ï¼š{message}");
        chatMediator.SendMessage(message, this);
    }

    public void ReceiveMessage(string message, Player sender)
    {
        Console.WriteLine($"ğŸ“© {Name} æ”¶åˆ° {sender.Name} çš„æ¶ˆæ¯ï¼š{message}");
    }
}

// **4ï¸âƒ£ æµ‹è¯•ä»£ç **
class Program
{
    static void Main()
    {
        IChatMediator chatRoom = new ChatMediator();

        Player alice = new Player("Alice", chatRoom);
        Player bob = new Player("Bob", chatRoom);
        Player charlie = new Player("Charlie", chatRoom);

        alice.Send("ä½ å¥½ï¼Œå¤§å®¶ï¼");
        bob.Send("Hi Alice!");
    }
}


/*
ğŸ“¤ Alice å‘é€æ¶ˆæ¯ï¼šä½ å¥½ï¼Œå¤§å®¶ï¼
ğŸ“© Bob æ”¶åˆ° Alice çš„æ¶ˆæ¯ï¼šä½ å¥½ï¼Œå¤§å®¶ï¼
ğŸ“© Charlie æ”¶åˆ° Alice çš„æ¶ˆæ¯ï¼šä½ å¥½ï¼Œå¤§å®¶ï¼

ğŸ“¤ Bob å‘é€æ¶ˆæ¯ï¼šHi Alice!
ğŸ“© Alice æ”¶åˆ° Bob çš„æ¶ˆæ¯ï¼šHi Alice!
ğŸ“© Charlie æ”¶åˆ° Bob çš„æ¶ˆæ¯ï¼šHi Alice!

*/

```


è™½ç„¶å¹¿æ’­æ¨¡å¼æ›´åŠ çš„æ¾è€¦åˆï¼Œä½†æ˜¯å¯¹å•ä¸ªå¯¹è±¡çš„æ§åˆ¶èƒ½åŠ›ä¹Ÿä¼šé™ä½å¾ˆå¤šã€‚è€Œä¸­ä»‹è€…æ¨¡å¼ä¼šæ­£å„¿å…«ç»æ‹¿åˆ°æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨ã€‚æ‰€ä»¥åœ¨å¤æ‚çš„æƒ…æ™¯ä¸‹ï¼Œè¿˜æ˜¯ä¸­ä»‹è€…æ¨¡å¼å§ã€‚








## å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰


**å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰** æ˜¯ä¸€ç§ **è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº **æ•è·å¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€**ï¼Œè€Œä¸ç ´åå¯¹è±¡çš„å°è£…æ€§ã€‚

**é€‚ç”¨äº**ï¼š

- éœ€è¦æ”¯æŒ**æ’¤é”€ï¼ˆUndoï¼‰**å’Œ**æ¢å¤ï¼ˆRedoï¼‰**åŠŸèƒ½çš„ç³»ç»Ÿï¼ˆå¦‚æ–‡æœ¬ç¼–è¾‘å™¨ã€æ¸¸æˆå­˜æ¡£ï¼‰ã€‚
- éœ€è¦**å­˜å‚¨å’Œå›æº¯å¯¹è±¡çš„çŠ¶æ€**ï¼Œä½†ä¸æƒ³æš´éœ²å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚


 **å¤‡å¿˜å½•æ¨¡å¼çš„è§’è‰²**

1. **`Mementoï¼ˆå¤‡å¿˜å½•ï¼‰`**ï¼š
    - å­˜å‚¨å¯¹è±¡çš„**å¿«ç…§ï¼ˆçŠ¶æ€æ•°æ®ï¼‰**ï¼Œä½†ä¸æä¾›ä¿®æ”¹åŠŸèƒ½ã€‚
2. **`Originatorï¼ˆåŸå‘å™¨ï¼‰`**ï¼š
    - è´Ÿè´£åˆ›å»º `Memento` å¤‡å¿˜å½•å¯¹è±¡ï¼Œå¹¶å¯ä»¥æ ¹æ® `Memento` æ¢å¤è‡ªèº«çŠ¶æ€ã€‚
3. **`Caretakerï¼ˆç®¡ç†è€…ï¼‰`**ï¼š
    - è´Ÿè´£**ä¿å­˜å’Œç®¡ç†**å¤šä¸ª `Memento`ï¼Œä½†ä¸ç›´æ¥æ“ä½œå…¶å†…å®¹ï¼ˆé˜²æ­¢ç ´åå°è£…ï¼‰ã€‚



åœ¨ RPG æ¸¸æˆä¸­ï¼Œè§’è‰²æœ‰ `è¡€é‡ï¼ˆHPï¼‰` å’Œ `é­”æ³•ï¼ˆMPï¼‰`ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨æˆ˜æ–—å‰**ä¿å­˜è§’è‰²çŠ¶æ€**ï¼Œå¦‚æœæˆ˜æ–—å¤±è´¥ï¼Œåˆ™**æ¢å¤ä¹‹å‰çš„å­˜æ¡£**ã€‚


å¤‡å¿˜å½•ç±»ï¼ˆMementoï¼‰

ä¿å­˜ç©å®¶çš„å­˜æ¡£å¿«ç…§ã€‚å®é™…ä¸Šå°±æ˜¯å­˜æ¡£çš„ç»“æ„ä½“ï¼Œæ­£å¸¸æ¸¸æˆé‡Œé¢å°±å­˜æ‰€æœ‰çš„ç©å®¶æ•°æ®äº†ï¼ˆ
**åªè¯»ï¼ˆ`readonly`ï¼‰å±æ€§**ï¼Œç¡®ä¿å¤‡å¿˜å½•æ˜¯ä¸å¯å˜çš„ã€‚

```c#
public class PlayerMemento
{
    public int HP { get; }
    public int MP { get; }

    public PlayerMemento(int hp, int mp)
    {
        HP = hp;
        MP = mp;
    }
}
```


ç©å®¶åŸå‘å™¨(Originator)
æ¥è°ƒç”¨ä¿å­˜çš„æ•°æ®ã€‚
è°æ˜¯åŸå‘å™¨(Originator)ï¼Œè°æ¥CreateMementoå’ŒRestoreå¤‡å¿˜å½•
```c#
using System;

public class Player
{
    public int HP { get; private set; }
    public int MP { get; private set; }

    public Player(int hp, int mp)
    {
        HP = hp;
        MP = mp;
    }

    // ç”Ÿæˆå­˜æ¡£ï¼ˆåˆ›å»ºå¤‡å¿˜å½•ï¼‰
    public PlayerMemento SaveState()
    {
        return new PlayerMemento(HP, MP);
    }

    // è¯»å–å­˜æ¡£ï¼ˆä»å¤‡å¿˜å½•æ¢å¤çŠ¶æ€ï¼‰
    public void RestoreState(PlayerMemento memento)
    {
        HP = memento.HP;
        MP = memento.MP;
    }

    public void ShowStatus()
    {
        Console.WriteLine($"[è§’è‰²çŠ¶æ€] HP: {HP}, MP: {MP}");
    }

    // æ¨¡æ‹Ÿæˆ˜æ–—ï¼Œæ¶ˆè€— HP å’Œ MP
    public void Fight()
    {
        HP -= 30;
        MP -= 10;
        Console.WriteLine("âš”ï¸ è§’è‰²è¿›è¡Œæˆ˜æ–—...");
    }
}

```


å­˜æ¡£ç®¡ç†å™¨
ç”¨äºå¢åŠ å’Œä¸€æ¡å¤‡å¿˜å½•ï¼Œä»¥åŠè¯»å–ä¸€ä¸ªå¤‡å¿˜å½•
```c#
using System.Collections.Generic;

public class SaveManager
{
    private Stack<PlayerMemento> _history = new Stack<PlayerMemento>();

    public void Save(PlayerMemento memento)
    {
        _history.Push(memento);
    }

    public PlayerMemento Load()
    {
        return _history.Count > 0 ? _history.Pop() : null;
    }
}

```



å®¢æˆ·ç«¯
```c#
class Program
{
    static void Main()
    {
        Player player = new Player(100, 50);
        SaveManager saveManager = new SaveManager();

        // è§’è‰²åˆå§‹çŠ¶æ€
        player.ShowStatus();

        // ä¿å­˜å­˜æ¡£
        saveManager.Save(player.SaveState());

        // è§’è‰²æˆ˜æ–—
        player.Fight();
        player.ShowStatus();

        // æ¢å¤å­˜æ¡£
        Console.WriteLine("\nğŸ”„ è¯»å–å­˜æ¡£...");
        player.RestoreState(saveManager.Load());
        player.ShowStatus();
    }
}

```



**å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰** å’Œ **å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰** åœ¨**å®ç°æ’¤é”€ï¼ˆUndoï¼‰åŠŸèƒ½**æ—¶ç¡®å®æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬çš„ **æ ¸å¿ƒæ€æƒ³** å’Œ **ä½¿ç”¨åœºæ™¯** **ä¸åŒ**ã€‚ğŸš€

å¯¹äºåŒæ ·æ¢å¤ä¹‹å‰è§’è‰²çš„çŠ¶æ€

**å¤‡å¿˜å½•æ¨¡å¼çš„åšæ³•ï¼š**
- ç›´æ¥å­˜å‚¨ **è§’è‰²çš„è¡€é‡ï¼ˆHPï¼‰**ã€‚
- éœ€è¦æ’¤é”€æ—¶ï¼Œåªéœ€æ¢å¤ä¹‹å‰çš„å¿«ç…§ã€‚
- 
**å‘½ä»¤æ¨¡å¼çš„åšæ³•ï¼š**
- è®°å½• **â€œä¸Šæ¬¡æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œâ€**ï¼ˆæ¯”å¦‚ **å—åˆ° 30 ä¼¤å®³**ï¼‰ã€‚
- éœ€è¦æ’¤é”€æ—¶ï¼Œæ‰§è¡Œ **â€œåå‘æ“ä½œâ€**ï¼ˆæ¢å¤ 30 HPï¼‰ã€‚

è€Œè¿™ç§æˆ˜æ–—çš„å‘½ä»¤ä¸€å±€ä¸­æœ‰éå¸¸å¤šï¼Œä¸€å±€å¤±è´¥çš„æ—¶å€™ï¼Œä¸åº”è¯¥æ’¤é”€è¿™äº›æ“ä½œå›åˆ°æˆ˜æ–—å‰ï¼Œéå¸¸ä¸ä¼˜é›…ã€‚è€Œæ˜¯åº”è¯¥ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼ï¼Œç›´æ¥æ¢å¤åˆ°æˆ˜æ–—å‰ã€‚å› ä¸ºæˆ‘ä¸éœ€è¦å…³æ³¨æˆ˜æ–—ä¸­å‘ç”Ÿçš„å„ç§æŒ‡ä»¤ï¼Œæˆ‘åªåœ¨ä¹æˆ˜æ–—ä¹‹å‰çš„çŠ¶æ€ã€‚

é‡æ–°å¼€å§‹å½“å‰å…³å¡ä¹Ÿå¾ˆé€‚åˆç”¨å¤‡å¿˜å½•æ¨¡å¼

|          | **å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰**                  | **å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰**                |
| -------- | ----------------------------------- | -------------------------------- |
| **æ ¸å¿ƒæ€æƒ³** | ç›´æ¥**å­˜å‚¨å¯¹è±¡çŠ¶æ€ï¼ˆå¿«ç…§ï¼‰**ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ¢å¤            | **å­˜å‚¨æ“ä½œï¼ˆCommandï¼‰ï¼Œå¹¶æä¾›æ’¤é”€é€»è¾‘**        |
| **å­˜å‚¨å†…å®¹** | ä»…å­˜**å¯¹è±¡çš„çŠ¶æ€æ•°æ®**ï¼ˆ`Memento`ï¼‰            | å­˜å‚¨**æ“ä½œï¼ˆCommandï¼‰+ å¯é€‰çš„çŠ¶æ€æ•°æ®**       |
| **é€‚ç”¨äº**  | éœ€è¦**å®Œæ•´æ¢å¤å¯¹è±¡çŠ¶æ€**ï¼ˆå¦‚æ¸¸æˆå­˜æ¡£ï¼‰               | éœ€è¦**æ’¤é”€/é‡åšæ“ä½œ**ï¼ˆå¦‚æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰            |
| **å®ç°æ–¹å¼** | `Memento` è´Ÿè´£ä¿å­˜çŠ¶æ€ï¼Œ`Caretaker` ç»´æŠ¤å­˜æ¡£å†å² | `Command` å°è£…æ“ä½œï¼Œ`Invoker` è´Ÿè´£æ‰§è¡Œå’Œæ’¤é”€ |
|          |                                     |                                  |


## è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰


å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè¿™å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚

åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œåªæœ‰ä¸¤ç§ä¸»ä½“ï¼šç›®æ ‡å¯¹è±¡ (**Object**) å’Œ è§‚å¯Ÿè€… (**Observer**)ã€‚



```c#
using System.Collections;
using System.Collections.Generic; 
using UnityEngine;
using System;

public class ObserveMode : MonoBehaviour
{
    //ç©å®¶æ­»äº¡ä¹‹åçš„äº‹ä»¶ï¼Œéœ€è¦è¢«è§‚å¯Ÿ
    public static event Action playerDeadEvent;

    private void OnDestroy()
    {
        playerDeadEvent?.Invoke();
    }
}

```


```c#
//æ•Œäºº
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Enemy : MonoBehaviour
{

    //åœ¨å¼€å§‹å°±è§‚å¯Ÿç©å®¶çš„æ­»äº¡äº‹ä»¶
    void Start()
    {
        ObserveMode.playerDeadEvent += () =>
        {
            print("ç©å®¶æ­»äº†ï¼ï¼");
        };
    }

}

```




## çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰



çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚çŠ¶æ€æ¨¡å¼å°†ä¸çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ç‹¬ç«‹çš„çŠ¶æ€ç±»ä¸­ï¼Œå¹¶é€šè¿‡åœ¨è¿™äº›çŠ¶æ€ç±»ä¹‹é—´åˆ‡æ¢æ¥æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚

åœ¨Unityä¸­ï¼ŒçŠ¶æ€æ¨¡å¼å¯ä»¥ç”¨äºç®¡ç†æ¸¸æˆå¯¹è±¡çš„ä¸åŒçŠ¶æ€ï¼Œæ¯”å¦‚è§’è‰²çš„è¡Œèµ°ã€è·³è·ƒã€æ”»å‡»ç­‰çŠ¶æ€ã€‚

è¿™ç§ä¸œè¥¿å¯ä»¥å¤§é‡å‡å°‘if elseçš„åµŒå¥—


ä¼ ç»Ÿå†™æ³•ï¼ˆé”™è¯¯ç¤ºèŒƒï¼šif-else å¤ªå¤šï¼‰

```c#
public class Character
{
    private string state = "Idle";

    public void Move()
    {
        if (state == "Idle" || state == "Combat")
            Console.WriteLine("è§’è‰²ç§»åŠ¨");
        else
            Console.WriteLine("æ— æ³•ç§»åŠ¨ï¼");
    }

    public void Attack()
    {
        if (state == "Combat")
            Console.WriteLine("è¿›è¡Œæ”»å‡»ï¼");
        else
            Console.WriteLine("æ— æ³•æ”»å‡»ï¼");
    }

    public void Die()
    {
        state = "Dead";
        Console.WriteLine("è§’è‰²æ­»äº¡ï¼");
    }
}

```


âœ… ä½¿ç”¨çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰
```c#
using System;

// **çŠ¶æ€æ¥å£**
public interface ICharacterState
{
    void Move();
    void Attack();
    void Die();
}

// **å…·ä½“çŠ¶æ€ï¼šæ™®é€šçŠ¶æ€ï¼ˆIdleï¼‰**
public class IdleState : ICharacterState
{
    public void Move() => Console.WriteLine("ğŸš¶ è§’è‰²æ­£åœ¨ç§»åŠ¨...");
    public void Attack() => Console.WriteLine("âš  æ— æ³•æ”»å‡»ï¼Œå½“å‰å¤„äºæ™®é€šçŠ¶æ€ï¼");
    public void Die() => Console.WriteLine("ğŸ’€ è§’è‰²æ­»äº¡ï¼");
}

// **å…·ä½“çŠ¶æ€ï¼šæˆ˜æ–—çŠ¶æ€ï¼ˆCombatï¼‰**
public class CombatState : ICharacterState
{
    public void Move() => Console.WriteLine("ğŸƒ æˆ˜æ–—ä¸­ç§»åŠ¨...");
    public void Attack() => Console.WriteLine("âš” è¿›è¡Œæ”»å‡»ï¼");
    public void Die() => Console.WriteLine("ğŸ’€ è§’è‰²æ­»äº¡ï¼");
}

// **å…·ä½“çŠ¶æ€ï¼šæ­»äº¡çŠ¶æ€ï¼ˆDeadï¼‰**
public class DeadState : ICharacterState
{
    public void Move() => Console.WriteLine("âŒ æ— æ³•ç§»åŠ¨ï¼Œè§’è‰²å·²æ­»äº¡ï¼");
    public void Attack() => Console.WriteLine("âŒ æ— æ³•æ”»å‡»ï¼Œè§’è‰²å·²æ­»äº¡ï¼");
    public void Die() => Console.WriteLine("âŒ è§’è‰²å·²ç»æ­»äº¡ï¼");
}

// **è§’è‰²ç±»**
public class Character
{
    private ICharacterState currentState;

    public Character() => currentState = new IdleState(); // é»˜è®¤æ˜¯ Idle

    public void SetState(ICharacterState newState) => currentState = newState;
    public void Move() => currentState.Move();
    public void Attack() => currentState.Attack();
    public void Die()
    {
        currentState.Die();
        SetState(new DeadState()); // è§’è‰²æ­»äº¡ååˆ‡æ¢åˆ°æ­»äº¡çŠ¶æ€
    }
}

// **æµ‹è¯•**
class Program
{
    static void Main()
    {
        Character player = new Character();
        
        player.Move();   // ğŸš¶ è§’è‰²æ­£åœ¨ç§»åŠ¨...
        player.Attack(); // âš  æ— æ³•æ”»å‡»ï¼Œå½“å‰å¤„äºæ™®é€šçŠ¶æ€ï¼
        
        Console.WriteLine("\nâš” åˆ‡æ¢åˆ°æˆ˜æ–—çŠ¶æ€ï¼");
        player.SetState(new CombatState());

        player.Move();   // ğŸƒ æˆ˜æ–—ä¸­ç§»åŠ¨...
        player.Attack(); // âš” è¿›è¡Œæ”»å‡»ï¼
        
        Console.WriteLine("\nğŸ’€ è§’è‰²æ­»äº¡ï¼");
        player.Die();    // ğŸ’€ è§’è‰²æ­»äº¡ï¼
        
        player.Move();   // âŒ æ— æ³•ç§»åŠ¨ï¼Œè§’è‰²å·²æ­»äº¡ï¼
    }
}
```









## ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰

ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š
1. å®šä¹‰ç®—æ³•æ—ï¼šå°†ä¸€ç³»åˆ—çš„ç®—æ³•åˆ†åˆ«å°è£…æˆç‹¬ç«‹çš„ç±»
2. ä½¿å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ï¼šè¿™äº›ç®—æ³•éƒ½å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥äº’ç›¸æ›¿æ¢
3. ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ï¼šå®¢æˆ·ç«¯ä»£ç ä¸éœ€è¦å› ä¸ºç®—æ³•çš„å˜åŒ–è€Œæ”¹å˜



```c#
// ç­–ç•¥æ¥å£
public interface IAttackStrategy
{
    void Attack();
}

// å…·ä½“ç­–ç•¥ç±»
public class SwordAttack : IAttackStrategy
{
    public void Attack()
    {
        Debug.Log("ä½¿ç”¨å‰‘æ”»å‡»");
    }
}

public class MagicAttack : IAttackStrategy
{
    public void Attack()
    {
        Debug.Log("ä½¿ç”¨é­”æ³•æ”»å‡»");
    }
}

public class BowAttack : IAttackStrategy
{
    public void Attack()
    {
        Debug.Log("ä½¿ç”¨å¼“ç®­æ”»å‡»");
    }
}

// ä¸Šä¸‹æ–‡ç±»
public class Character
{
    private IAttackStrategy attackStrategy;

    public void SetAttackStrategy(IAttackStrategy strategy)
    {
        this.attackStrategy = strategy;
    }

    public void PerformAttack()
    {
        attackStrategy.Attack();
    }
}
```





## æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰
 

**æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰** æ˜¯ä¸€ç§**è¡Œä¸ºè®¾è®¡æ¨¡å¼**ï¼Œç”¨äºåœ¨**çˆ¶ç±»ä¸­å®šä¹‰ç®—æ³•çš„ç»“æ„**ï¼Œè€Œ**è®©å­ç±»æ¥å®ç°å…·ä½“æ­¥éª¤**ã€‚  
å®ƒ**å›ºå®šäº†ç®—æ³•çš„æ•´ä½“æ¡†æ¶**ï¼Œä½†å…è®¸å­ç±»**å¯¹å…¶ä¸­çš„æŸäº›æ­¥éª¤è¿›è¡Œè‡ªå®šä¹‰**ã€‚

**åœºæ™¯ï¼š**  
æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ª RPG æ¸¸æˆä¸­çš„è§’è‰²**æ”»å‡»æµç¨‹**ï¼š

1. **å‡†å¤‡æ”»å‡»**ï¼ˆå›ºå®šæ­¥éª¤ï¼‰
2. **æ‰§è¡Œæ”»å‡»**ï¼ˆæ¯ä¸ªè§’è‰²ä¸åŒï¼‰
3. **æ”¶å°¾åŠ¨ä½œ**ï¼ˆå›ºå®šæ­¥éª¤ï¼‰

ğŸ”¹ **ä¸åŒè§’è‰²ï¼ˆæˆ˜å£« / æ³•å¸ˆï¼‰æ”»å‡»æ–¹å¼ä¸åŒ**ï¼Œä½†æ•´ä½“æµç¨‹ç›¸åŒã€‚  
ğŸ”¹ **å¯ä»¥ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œç»Ÿä¸€æµç¨‹ï¼Œè®©å­ç±»å†³å®šç»†èŠ‚**ã€‚

```c#
using System;

abstract class Character
{
    // **æ¨¡æ¿æ–¹æ³•**ï¼šå®šä¹‰æ”»å‡»æµç¨‹ï¼Œä¸å…è®¸å­ç±»ä¿®æ”¹ç»“æ„
    public void Attack()
    {
        PrepareAttack();
        ExecuteAttack();
        FinishAttack();
    }

    // **å›ºå®šçš„æ­¥éª¤**
    private void PrepareAttack()
    {
        Console.WriteLine("ğŸ›¡ï¸ è§’è‰²å‡†å¤‡æ”»å‡»...");
    }

    // **æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°**
    protected abstract void ExecuteAttack();

    // **å›ºå®šçš„æ­¥éª¤**
    private void FinishAttack()
    {
        Console.WriteLine("âœ… æ”»å‡»å®Œæˆï¼\n");
    }
}

// **å…·ä½“å­ç±»ï¼šæˆ˜å£«**
class Warrior : Character
{
    protected override void ExecuteAttack()
    {
        Console.WriteLine("âš”ï¸ æˆ˜å£«æŒ¥èˆå¤§å‰‘è¿›è¡Œé‡å‡»ï¼");
    }
}

// **å…·ä½“å­ç±»ï¼šæ³•å¸ˆ**
class Mage : Character
{
    protected override void ExecuteAttack()
    {
        Console.WriteLine("ğŸ”¥ æ³•å¸ˆé‡Šæ”¾ç«çƒæœ¯ï¼");
    }
}

// **æµ‹è¯•ä»£ç **
class Program
{
    static void Main()
    {
        Character warrior = new Warrior();
        warrior.Attack();

        Character mage = new Mage();
        mage.Attack();
    }
}



//ğŸ›¡ï¸ è§’è‰²å‡†å¤‡æ”»å‡»... âš”ï¸ æˆ˜å£«æŒ¥èˆå¤§å‰‘è¿›è¡Œé‡å‡»ï¼ âœ… æ”»å‡»å®Œæˆï¼ ğŸ›¡ï¸ è§’è‰²å‡†å¤‡æ”»å‡»... ğŸ”¥ æ³•å¸ˆé‡Šæ”¾ç«çƒæœ¯ï¼ âœ… æ”»å‡»å®Œæˆï¼
```





**æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰** **ä¸€å®šä¼šè§„å®šæ‰§è¡Œé¡ºåº**ï¼å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯**åœ¨åŸºç±»ä¸­å®šä¹‰ç®—æ³•çš„æ•´ä½“æµç¨‹**ï¼Œå¹¶ä¸”**ä¸å…è®¸å­ç±»æ›´æ”¹è¿™ä¸ªé¡ºåº**ï¼Œä½†å…è®¸å­ç±»**å®ç°æˆ–è¦†ç›–æŸäº›æ­¥éª¤**ã€‚




## è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰


è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š  
**å°†ä½œç”¨äºå¯¹è±¡çš„æ•°æ®æ“ä½œä»å¯¹è±¡æœ¬èº«åˆ†ç¦»å‡ºæ¥**ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸ä¿®æ”¹ç±»çš„å‰æä¸‹ï¼Œæ–°å¢å¯¹è¿™äº›å¯¹è±¡çš„æ“ä½œã€‚

ä½ å¯ä»¥ç†è§£ä¸ºï¼š**è®¿é—®è€…æ¨¡å¼è®©ä½ å¯ä»¥åœ¨â€œä¸æ”¹åŠ¨åŸå§‹ç±»â€çš„æƒ…å†µä¸‹ï¼Œç»™å®ƒä»¬æ·»åŠ æ–°åŠŸèƒ½**ã€‚


- è¯´ç™½äº†ï¼Œè®¿é—®è€…æ¨¡å¼å°±æ˜¯åœ¨åªå®šä¹‰äº†ä¸€ä¸ªç±»çš„æƒ…å†µä¸‹ï¼Œä¸ä¿®æ”¹åŸæ¥çš„ç±»ï¼Œç»™å®ƒæ·»åŠ æ–°çš„æ–¹æ³•ã€‚
- ä½†æ˜¯è¿™æ ¹æœ¬æ²¡åŠæ³•éµå®ˆå¼€é—­åŸåˆ™ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ–°çš„elementçš„è¯ï¼Œè¿˜å¾—å†ä¿®æ”¹IVisitor
	- è®¿é—®è€…æ¨¡å¼ç¡®å®å­˜åœ¨ä¸€ä¸ªæ‚–è®ºï¼š
	- å®ƒåœ¨"æ·»åŠ æ–°æ“ä½œ"æ–¹é¢æ”¯æŒå¼€é—­åŸåˆ™ï¼ˆåªéœ€æ·»åŠ æ–°çš„Visitorç±»ï¼‰
	- ä½†åœ¨"æ·»åŠ æ–°å…ƒç´ "æ–¹é¢è¿åå¼€é—­åŸåˆ™ï¼ˆéœ€è¦ä¿®æ”¹æ‰€æœ‰Visitoræ¥å£å’Œå®ç°ï¼‰
	- è¿™ä¸ªé—®é¢˜åœ¨è®¾è®¡æ¨¡å¼ä¸­è¢«ç§°ä¸º"è¡¨è¾¾å¼é—®é¢˜"ï¼ˆExpression Problemï¼‰ï¼š




- æ ¸å¿ƒçš„ç»“æ„åªæœ‰ä¸¤ä¸ª
- æ‰€æœ‰å¯ä»¥è¢«ä¿®æ”¹çš„ç±»éƒ½åº”è¯¥å®ç°IElementæ¥å£ï¼Œè¿™ä¸ªç©æ„é‡Œé¢æœ‰ä¸€ä¸ªAcceptï¼ŒAccepté‡Œé¢æœ‰ä¸€ä¸ªvisitï¼Œå¯ä»¥è®©ç±»æŠŠè‡ªèº«çš„æ•°æ®ä¼ è¿›å»ã€‚
- æ‰€æœ‰çš„æ“ä½œéƒ½éœ€è¦å®ç°IVisitorï¼Œè€ŒIVisitoré‡Œé¢éœ€è¦æ‰‹åŠ¨å¯¹æ¯ä¸€ç§IElementè¿›è¡Œè®¿é—®ã€‚Visitçš„æ–¹æ³•å®é™…ä¸Šæ²¡æœ‰å…·ä½“å«ä¹‰ï¼ŒçœŸæ­£çš„å«ä¹‰åœ¨ç±»åå®šä¹‰çš„ã€‚æ¯”å¦‚SaveGameVisitorï¼Œå…¶å®å°±æ˜¯ç»™æ™®é€šçš„æ¸¸æˆå¯¹è±¡æ·»åŠ äº†ä¿å­˜çš„æ–¹æ³•ã€‚

```c#
// åŸºç¡€æ¥å£
public interface IGameElement
{
    void Accept(IVisitor visitor);
}

public interface IVisitor
{
    void Visit(Player player);
    void Visit(Enemy enemy);
}

// å…·ä½“å…ƒç´ 
public class Player : IGameElement
{
    public string Name { get; set; }
    public int Health { get; set; }

    public Player(string name, int health)
    {
        Name = name;
        Health = health;
    }

    public void Accept(IVisitor visitor)
    {
        visitor.Visit(this);
    }
}

public class Enemy : IGameElement
{
    public string Type { get; set; }
    public int Damage { get; set; }

    public Enemy(string type, int damage)
    {
        Type = type;
        Damage = damage;
    }

    public void Accept(IVisitor visitor)
    {
        visitor.Visit(this);
    }
}

// è®¿é—®è€…å®ç°
public class StatisticsVisitor : IVisitor
{
    public void Visit(Player player)
    {
        Debug.Log($"ç»Ÿè®¡è®¿é—®è€…ï¼šæ”¶é›†ç©å®¶ {player.Name} çš„æ•°æ®");
        Debug.Log($"- è®°å½•ç”Ÿå‘½å€¼ï¼š{player.Health}");
    }

    public void Visit(Enemy enemy)
    {
        Debug.Log($"ç»Ÿè®¡è®¿é—®è€…ï¼šæ”¶é›†æ•Œäºº {enemy.Type} çš„æ•°æ®");
        Debug.Log($"- è®°å½•ä¼¤å®³å€¼ï¼š{enemy.Damage}");
    }
}

public class SaveGameVisitor : IVisitor
{
    public void Visit(Player player)
    {
        Debug.Log($"å­˜æ¡£è®¿é—®è€…ï¼šä¿å­˜ç©å®¶ {player.Name} çš„æ•°æ®");
        Debug.Log($"- ä¿å­˜ç”Ÿå‘½å€¼ï¼š{player.Health}");
    }

    public void Visit(Enemy enemy)
    {
        Debug.Log($"å­˜æ¡£è®¿é—®è€…ï¼šä¿å­˜æ•Œäºº {enemy.Type} çš„æ•°æ®");
        Debug.Log($"- ä¿å­˜ä¼¤å®³å€¼ï¼š{enemy.Damage}");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class GameManager : MonoBehaviour
{
    void Start()
    {
        // åˆ›å»ºæ¸¸æˆå…ƒç´ 
        List<IGameElement> gameElements = new List<IGameElement>
        {
            new Player("å‹‡è€…", 100),
            new Enemy("å²è±å§†", 10),
            new Enemy("é¾™", 50)
        };

        // åˆ›å»ºè®¿é—®è€…
        var statsVisitor = new StatisticsVisitor();
        var saveVisitor = new SaveGameVisitor();

        Debug.Log("=== å¼€å§‹æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ ===");
        foreach (var element in gameElements)
        {
            element.Accept(statsVisitor);
        }

        Debug.Log("\n=== å¼€å§‹ä¿å­˜æ¸¸æˆ ===");
        foreach (var element in gameElements)
        {
            element.Accept(saveVisitor);
        }
    }
}

```







# å…¶å®ƒå¸¸è§çš„è®¾è®¡æ¨¡å¼


## å‘å¸ƒè€…è®¢é˜…è€…æ¨¡å¼ï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰

å’Œè§‚å¯Ÿè€…æ¨¡å¼å¾ˆåƒï¼Œä½†æ˜¯è¦æ³¨æ„ï¼ï¼ï¼

è§‚å¯Ÿè€…æ¨¡å¼å®é™…ä¸Šæ˜¯**æ¾è€¦åˆ(loosely coupled)**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç©å®¶æ­»äº¡ä¹‹åä¼šç›´æ¥é€šçŸ¥æ‰€æœ‰çš„æ•Œäººã€‚è¿™ä¸ªå®é™…ä¸Šè¿˜æ˜¯æœ‰å¾ˆå¼ºçš„è€¦åˆæ€§çš„ã€‚

ä½†æ˜¯å‘å¸ƒè€…è®¢é˜…è€…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…å¹¶ä¸ä¼šç›´æ¥é€šä¿¡ï¼è€Œæ˜¯é€šè¿‡ä¸€ä¸ªä¸­é—´å•†è¿›è¡Œé€šä¿¡ã€‚

å‘å¸ƒè€…åªéœ€å‘Šè¯‰ä¸­é—´å•†ï¼Œæˆ‘è¦å‘çš„æ¶ˆæ¯ï¼Œtopicæ˜¯AAAï¼›

è®¢é˜…è€…åªéœ€å‘Šè¯‰ä¸­é—´å•†ï¼Œæˆ‘è¦è®¢é˜…topicæ˜¯AAAçš„æ¶ˆæ¯ï¼›å³å¯ã€‚





```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using System;

public enum äº‹ä»¶ç±»å‹
{
    ç©å®¶æ­»äº¡,
    æ•Œäººæ­»äº¡
}


public class è®¢é˜…è€…å‘å¸ƒè€…æ¨¡å¼ : MonoBehaviour
{
    //ç”¨æ¥ç»´æŠ¤æ‰€æœ‰çš„äº‹ä»¶
    private static Dictionary<äº‹ä»¶ç±»å‹, Delegate> å‘å¸ƒäº‹ä»¶å­—å…¸ = new Dictionary<äº‹ä»¶ç±»å‹, Delegate>();

    private static void  è®¢é˜…å‰çš„æ£€æŸ¥(äº‹ä»¶ç±»å‹ äº‹ä»¶, Delegate å›è°ƒå‡½æ•°)
    {
        if (!å‘å¸ƒäº‹ä»¶å­—å…¸.ContainsKey(äº‹ä»¶))
        {
            å‘å¸ƒäº‹ä»¶å­—å…¸.Add(äº‹ä»¶, null);
        }
        Delegate å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•° = å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶];
        if (å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•° != null && å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•°.GetType() != å›è°ƒå‡½æ•°.GetType())
        {
            throw new Exception(string.Format("å°è¯•ä¸ºäº‹ä»¶{0}æ·»åŠ ä¸åŒç±»å‹çš„å§”æ‰˜ï¼Œå½“å‰äº‹ä»¶æ‰€å¯¹åº”çš„å§”æ‰˜æ˜¯{1}ï¼Œè¦æ·»åŠ çš„å§”æ‰˜ç±»å‹ä¸º{2}", äº‹ä»¶, å·²ç»å­˜å‚¨çš„å›è°ƒå‡½æ•°.GetType(), å›è°ƒå‡½æ•°.GetType()));
        }
    }

    //æ— å‚æ•°çš„è®¢é˜…ä¸å‘å¸ƒ
    public static void è®¢é˜…(äº‹ä»¶ç±»å‹ äº‹ä»¶, Action å›è°ƒå‡½æ•°)
    {
        è®¢é˜…å‰çš„æ£€æŸ¥(äº‹ä»¶, å›è°ƒå‡½æ•°);
        å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] = (Action)å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] + å›è°ƒå‡½æ•°;//ç”¨å¤šæ’­ç›´æ¥å­˜å‚¨å›è°ƒå‡½æ•°
    }

    public static void å‘å¸ƒ(äº‹ä»¶ç±»å‹ äº‹ä»¶)
    {

        Delegate å›è°ƒå‡½æ•°;
        if (å‘å¸ƒäº‹ä»¶å­—å…¸.TryGetValue(äº‹ä»¶, out å›è°ƒå‡½æ•°))
        {
            ((Action)å›è°ƒå‡½æ•°)();
        }
    }



    //ä¸€ä¸ªå‚æ•°çš„è®¢é˜…ä¸å‘å¸ƒ

    public static void è®¢é˜…<T>(äº‹ä»¶ç±»å‹ äº‹ä»¶, Action<T> å›è°ƒå‡½æ•°)
    {
        è®¢é˜…å‰çš„æ£€æŸ¥( äº‹ä»¶,  å›è°ƒå‡½æ•°);
        å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] = (Action<T>)å‘å¸ƒäº‹ä»¶å­—å…¸[äº‹ä»¶] + å›è°ƒå‡½æ•°;//ç”¨å¤šæ’­ç›´æ¥å­˜å‚¨å›è°ƒå‡½æ•°
    }

    public static void å‘å¸ƒ<T>(äº‹ä»¶ç±»å‹ äº‹ä»¶,T å‚æ•°)
    {

        Delegate å›è°ƒå‡½æ•°;
        if (å‘å¸ƒäº‹ä»¶å­—å…¸.TryGetValue(äº‹ä»¶, out å›è°ƒå‡½æ•°))
        {
            ((Action<T>)å›è°ƒå‡½æ•°)(å‚æ•°);
        }
    }

}

```



```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class è®¢é˜…è€… : MonoBehaviour
{

    void Start()
    {
        è®¢é˜…è€…å‘å¸ƒè€…æ¨¡å¼.è®¢é˜…<string>(äº‹ä»¶ç±»å‹.ç©å®¶æ­»äº¡, (msg) =>{
            print("æ”¶åˆ°äº‹ä»¶é€šçŸ¥ï¼"+msg);
        });
    }

}

```





```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class å‘å¸ƒè€… : MonoBehaviour
{

    private void OnDisable()
    {
        è®¢é˜…è€…å‘å¸ƒè€…æ¨¡å¼.å‘å¸ƒ(äº‹ä»¶ç±»å‹.ç©å®¶æ­»äº¡,"GGGG");

    }
}

```



## MVC


è™½ç„¶modelç”¨äº†äº‹ä»¶ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šè¿˜æ˜¯modelå‘é€æ•°æ®ç»™äº†view


```c#
// 1. Modelï¼šç®¡ç†æ•°æ®
public class HealthModel {
    private int _currentHealth;
    public int CurrentHealth => _currentHealth;

    // æ•°æ®å˜åŒ–äº‹ä»¶
    public event Action<int> OnHealthChanged;

    public HealthModel(int maxHealth) {
        _currentHealth = maxHealth;
    }

    public void TakeDamage(int damage) {
        _currentHealth -= damage;
        OnHealthChanged?.Invoke(_currentHealth); // é€šçŸ¥æ•°æ®å˜åŒ–
    }
}

// 2. Viewï¼šè´Ÿè´£æ˜¾ç¤º
public class HealthView : MonoBehaviour {
    [SerializeField] private Slider healthSlider;

    // å¤–éƒ¨è°ƒç”¨æ­¤æ–¹æ³•æ›´æ–°æ˜¾ç¤º
    public void UpdateHealthDisplay(int health) {
        healthSlider.value = health;
    }
}

// 3. Controllerï¼šå¤„ç†è¾“å…¥å’Œåè°ƒ
public class HealthController : MonoBehaviour {
    private HealthModel _model;
    private HealthView _view;

    private void Start() {
        _model = new HealthModel(100);
        _view = GetComponent<HealthView>();
        _model.OnHealthChanged += _view.UpdateHealthDisplay; // ç»‘å®šäº‹ä»¶
    }

    private void Update() {
        if (Input.GetKeyDown(KeyCode.Space)) {
            _model.TakeDamage(10); // è¾“å…¥è§¦å‘ Model ä¿®æ”¹
        }
    }
}
```



## MVP

è¿™ç©æ„å½»åº•æ–­äº†modelå’Œviewçš„è”ç³»ï¼Œæ‰€ä»¥è¯´OnPlayerTakeDamageçš„æ—¶å€™ï¼Œè¦æ‰‹åŠ¨æ›´æ–°modelå’Œviewçš„æ›´æ–°ï¼Œè€Œmvcåªç”¨æ”¹model

```c#
// 1. Modelï¼šç®¡ç†æ•°æ®
public class HealthModel {
    private int _currentHealth;
    public int CurrentHealth => _currentHealth;

    public HealthModel(int maxHealth) {
        _currentHealth = maxHealth;
    }

    public void TakeDamage(int damage) {
        _currentHealth -= damage;
    }
}

// 2. Viewï¼šè´Ÿè´£æ˜¾ç¤º
public class HealthView : MonoBehaviour {
    [SerializeField] private Slider healthSlider;

    // å¤–éƒ¨è°ƒç”¨æ­¤æ–¹æ³•æ›´æ–°æ˜¾ç¤º
    public void UpdateHealthDisplay(int health) {
        healthSlider.value = health;
    }
}

// 3. Presenterï¼šæ ¸å¿ƒé€»è¾‘åè°ƒè€…
public class HealthPresenter {
    private HealthModel _model;
    private HealthView _view;

    public HealthPresenter(HealthModel model, HealthView view) {
        _model = model;
        _view = view;
    }

    // å¤„ç†é€»è¾‘å¹¶æ›´æ–° View
    public void OnPlayerTakeDamage(int damage) {
        _model.TakeDamage(damage);
        _view.UpdateHealthDisplay(_model.CurrentHealth); // ä¸»åŠ¨æ›´æ–° View
    }
}

// 4. MonoBehaviour é©±åŠ¨è¾“å…¥ï¼ˆå¦‚ Unity çš„è„šæœ¬ï¼‰
public class PlayerInputHandler : MonoBehaviour {
    [SerializeField] private HealthView healthView; // é€šè¿‡ Inspector ç»‘å®š
    private HealthPresenter _presenter;

    private void Start() {
        var model = new HealthModel(100);
        _presenter = new HealthPresenter(model, healthView);
    }

    private void Update() {
        if (Input.GetKeyDown(KeyCode.Space)) {
            _presenter.OnPlayerTakeDamage(10); // è¾“å…¥è§¦å‘ Presenter
        }
    }
}
```





## MVVC


è¯´ç™½äº†æ˜¯åŒå‘ç»‘å®šçš„éœ€æ±‚æ‰€è¡ç”Ÿçš„ã€‚

ä»¥è§’è‰²è¡€é‡ç³»ç»Ÿä¸ºä¾‹ï¼Œç»“åˆ Unity çš„Â `UniRx`ï¼ˆå“åº”å¼ç¼–ç¨‹åº“ï¼‰å®ç°æ•°æ®ç»‘å®šï¼š


```c#
// 1. Modelï¼ˆä¸ MVC/MVP ç›¸åŒï¼‰
public class HealthModel {
    public ReactiveProperty<int> CurrentHealth { get; } = new ReactiveProperty<int>(100);

    public void TakeDamage(int damage) {
        CurrentHealth.Value -= damage;
    }
}

// 2. ViewModelï¼šæš´éœ²å¯ç»‘å®šå±æ€§
public class HealthViewModel {
    public ReactiveProperty<float> HealthNormalized { get; } = new ReactiveProperty<float>(1f);

    public HealthViewModel(HealthModel model) {
        // å°† Model çš„ CurrentHealth è½¬æ¢ä¸ºè¿›åº¦æ¡æ¯”ä¾‹ï¼ˆ0~1ï¼‰
        model.CurrentHealth
            .Subscribe(health => HealthNormalized.Value = health / 100f)
            .AddTo(disposables);
    }

    private CompositeDisposable disposables = new CompositeDisposable();
}

// 3. Viewï¼šç»‘å®šåˆ° ViewModel
public class HealthView : MonoBehaviour {
    [SerializeField] private Slider healthSlider;
    private HealthViewModel _viewModel;

    public void Initialize(HealthViewModel viewModel) {
        _viewModel = viewModel;
        // ç»‘å®š ViewModel çš„ HealthNormalized åˆ° Slider
        _viewModel.HealthNormalized
            .Subscribe(value => healthSlider.value = value)
            .AddTo(this);
    }
}

// 4. åˆå§‹åŒ–åŠé©±åŠ¨
public class GameManager : MonoBehaviour {
    private void Start() {
        var model = new HealthModel();
        var viewModel = new HealthViewModel(model);
        var view = GetComponent<HealthView>();
        view.Initialize(viewModel);
    }

    private void Update() {
        if (Input.GetKeyDown(KeyCode.Space)) {
            model.TakeDamage(10); // ä¿®æ”¹ Modelï¼ŒView è‡ªåŠ¨æ›´æ–°
        }
    }
}
```


## é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰



# Actoræ¨¡å‹
